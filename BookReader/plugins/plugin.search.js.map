{"version":3,"sources":["webpack://@internetarchive/bookreader/./src/js/plugins/search/plugin.search.js","webpack://@internetarchive/bookreader/./src/js/plugins/search/view.js","webpack://@internetarchive/bookreader/./node_modules/core-js/internals/array-for-each.js","webpack://@internetarchive/bookreader/./node_modules/core-js/internals/array-last-index-of.js","webpack://@internetarchive/bookreader/./node_modules/core-js/internals/check-correctness-of-iteration.js","webpack://@internetarchive/bookreader/./node_modules/core-js/internals/engine-is-ios.js","webpack://@internetarchive/bookreader/./node_modules/core-js/internals/host-report-errors.js","webpack://@internetarchive/bookreader/./node_modules/core-js/internals/inherit-if-required.js","webpack://@internetarchive/bookreader/./node_modules/core-js/internals/iterate.js","webpack://@internetarchive/bookreader/./node_modules/core-js/internals/microtask.js","webpack://@internetarchive/bookreader/./node_modules/core-js/internals/native-promise-constructor.js","webpack://@internetarchive/bookreader/./node_modules/core-js/internals/new-promise-capability.js","webpack://@internetarchive/bookreader/./node_modules/core-js/internals/perform.js","webpack://@internetarchive/bookreader/./node_modules/core-js/internals/promise-resolve.js","webpack://@internetarchive/bookreader/./node_modules/core-js/internals/set-species.js","webpack://@internetarchive/bookreader/./node_modules/core-js/internals/task.js","webpack://@internetarchive/bookreader/./node_modules/core-js/modules/es.array.for-each.js","webpack://@internetarchive/bookreader/./node_modules/core-js/modules/es.array.last-index-of.js","webpack://@internetarchive/bookreader/./node_modules/core-js/modules/es.array.some.js","webpack://@internetarchive/bookreader/./node_modules/core-js/modules/es.promise.js","webpack://@internetarchive/bookreader/./node_modules/core-js/modules/es.regexp.constructor.js","webpack://@internetarchive/bookreader/./node_modules/core-js/modules/web.dom-collections.for-each.js"],"names":["super_","params","selector","this","br","matcher","RegExp","matches","cacheDOMElements","bindEvents","console","warn","dom","searchTray","renderSearchTray","results","querySelector","resultsCount","searchField","searchPending","mobileSearch","buildMobileDrawer","toolbarSearch","buildToolbarSearch","bool","classList","contains","toggle","innerText","toggleResultsCount","query","$","val","innerHTML","remove","removeSearchResults","removeResultPins","emptyMatches","setQuery","teardownSearchNavigation","trigger","document","createElement","setAttribute","replace","before","resultsPosition","searchNavigation","positionMessage","length","currentMatchIndex","namespace","on","clearSearchFieldAndResults","bind","showPrevResult","showNextResult","toggleSidebar","mode","constModeThumb","switchMode","constMode1up","getClosestMatchIndex","start","end","comparator","eq","click","updateResultsPosition","updateSearchNavigationButtons","comparisonFn","closestPage","closestTo","pool","slice","map","m","par","page","currentIndex","indexOf","find","text","attr","off","resize","matchingSearchResult","constMode2up","find2upMatchingSearchResult","find1upMatchingSearchResult","_isIndexDisplayed","setCurrentMatchIndex","items","match","leafNumToIndex","join","pinsVisibleState","refs","$BRfooter","css","visibility","imagesBaseURL","appendChild","add","forEach","queryString","pageIndex","pageNumber","getPageNum","percentThrough","constructor","util","cssPercentage","getNumLeafs","queryStringWithB","queryStringWithBTruncated","addClass","left","append","data","appendTo","hover","event","marker","currentTarget","tooltip","tooltipOffset","getBoundingClientRect","targetOffset","boxSizeAdjust","parseInt","getComputedStyle","paddingLeft","x","style","setProperty","removeClass","target","_searchPluginGoToResult","updateSearchHilites","showProgressPopup","removeProgressPopup","renderModalMessage","delayModalRemovalFor","messageHTML","modal","el","timeoutMS","setTimeout","$mmenu","open","close","e","preventDefault","value","search","blur","toggleSearchPending","options","renderSearchNavigation","bindSearchNavigationEvents","renderMatches","renderPins","updateResultsCount","goToFirstResult","one","is_visible","navigationIsVisible","togglePinsFor","toggleSearchTray","removeSearchHilites","searchTerm","renderErrorModal","renderBookNotIndexedModal","renderResultsEmptyModal","handleSearchCallback","handleNavToggledCallback","handleSearchStarted","handleSearchCallbackError","handleSearchCallbackBookNotIndexed","handleSearchCallbackEmpty","updateSearchNavigation","addEventListener","submitHandler","dataset","closeMobileMenu","jQuery","extend","BookReader","defaultOptions","server","bookId","subPrefix","bookPath","enableSearch","searchInsideUrl","initialSearchTerm","prototype","setup","call","searchResults","searchView","SearchView","init","suppressFragmentChange","buildMobileDrawerElement","$el","after","buildToolbarElement","term","overrides","disablePopup","error","success","eventNames","fragmentChange","serverPath","baseUrl","path","subPrefixWithSlash","lastIndexOf","substr","urlParams","item_id","doc","q","paramStr","param","url","processSearchResults","searchInsideResults","responseHasError","hasCustomError","hasCustomSuccess","BRSearchCallbackError","BRSearchCallback","ajax","dataType","then","instance","_BRSearchCallbackError","basePayload","payload","Object","assign","indexed","updateSearchHilites1UP","updateSearchHilites2UP","boxes","box","inArray","displayedIndices","div","prop","highlight","width","r","l","reduce","height","b","t","top","pageIsInView","isViewable","_models","book","getPage","$brTwoPageView","setHilightCss2UP","makeUnviewableAtEnd","fetch","URLSearchParams","id","subprefix","leafNum","json","resp","makeViewable","jumpToIndex","searchHighlightVisible","visiblePages","twoPage","currentIndexL","currentIndexR","some","$forEach","arrayMethodIsStrict","arrayMethodUsesToLength","STRICT_METHOD","USES_TO_LENGTH","module","exports","callbackfn","arguments","undefined","toIndexedObject","toInteger","toLength","min","Math","nativeLastIndexOf","NEGATIVE_ZERO","ACCESSORS","1","FORCED","searchElement","apply","O","index","ITERATOR","wellKnownSymbol","SAFE_CLOSING","called","iteratorWithReturn","next","done","Array","from","exec","SKIP_CLOSING","ITERATION_SUPPORT","object","userAgent","test","global","a","isObject","setPrototypeOf","$this","dummy","Wrapper","NewTarget","NewTargetPrototype","anObject","isArrayIteratorMethod","getIteratorMethod","iteratorClose","Result","stopped","result","iterable","unboundFunction","iterator","iterFn","step","that","AS_ENTRIES","IS_ITERATOR","INTERRUPTED","fn","stop","condition","callFn","TypeError","flush","head","last","notify","node","promise","getOwnPropertyDescriptor","macrotask","IS_IOS","IS_NODE","MutationObserver","WebKitMutationObserver","process","Promise","queueMicrotaskDescriptor","queueMicrotask","parent","domain","exit","enter","createTextNode","observe","characterData","resolve","nextTick","task","aFunction","PromiseCapability","C","reject","$$resolve","$$reject","f","newPromiseCapability","promiseCapability","getBuiltIn","definePropertyModule","DESCRIPTORS","SPECIES","CONSTRUCTOR_NAME","Constructor","defineProperty","configurable","get","defer","channel","port","fails","html","location","set","setImmediate","clear","clearImmediate","MessageChannel","Dispatch","counter","queue","run","hasOwnProperty","runner","listener","post","postMessage","protocol","host","args","i","push","Function","now","port2","port1","onmessage","importScripts","removeChild","proto","forced","$some","Internal","OwnPromiseCapability","PromiseWrapper","nativeThen","IS_PURE","NativePromise","redefine","redefineAll","setToStringTag","setSpecies","anInstance","inspectSource","iterate","checkCorrectnessOfIteration","speciesConstructor","microtask","promiseResolve","hostReportErrors","newPromiseCapabilityModule","perform","InternalStateModule","isForced","V8_VERSION","PROMISE","getInternalState","setInternalState","getInternalPromiseState","getterFor","PromiseConstructor","$fetch","newGenericPromiseCapability","DISPATCH_EVENT","createEvent","dispatchEvent","NATIVE_REJECTION_EVENT","PromiseRejectionEvent","UNHANDLED_REJECTION","String","FakePromise","INCORRECT_ITERATION","all","isThenable","it","state","isReject","notified","chain","reactions","ok","exited","reaction","handler","fail","rejection","onHandleUnhandled","onUnhandled","name","reason","initEvent","facade","isUnhandled","emit","unwrap","internalReject","internalResolve","wrapper","executor","type","onFulfilled","onRejected","unsafe","enumerable","input","wrap","stat","capability","$promiseResolve","values","remaining","alreadyCalled","race","inheritIfRequired","getOwnPropertyNames","isRegExp","getFlags","stickyHelpers","MATCH","NativeRegExp","RegExpPrototype","re1","re2","CORRECT_NEW","UNSUPPORTED_Y","RegExpWrapper","pattern","flags","sticky","thisIsRegExp","patternIsRegExp","flagsAreUndefined","source","proxy","key","keys","DOMIterables","createNonEnumerableProperty","COLLECTION_NAME","Collection","CollectionPrototype"],"mappings":"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","file":"plugins/plugin.search.js","sourcesContent":["/* global BookReader */\n/**\n * Plugin for Archive.org book search\n * NOTE: This script must be loaded AFTER `plugin.mobile_nav.js`\n * as it mutates mobile nav drawer\n *\n * Events fired at various points throughout search processing are published\n * on the document DOM element. These can be subscribed to using jQuery's event\n * binding method `$.fn.on`. All of the events are prefixed with a BookReader\n * namespace. The events are:\n *\n * @event BookReader:SearchStarted - When a search form is submitted, immediately\n *   before an AJAX call is made to request search results\n * @event BookReader:SearchCallback - When the search AJAX call is returned and at\n *   least one result is returned. The event callback receives an object\n *   with the `results`, plugin `options`, and the BookReader `instance`\n * @event BookReader:SearchCallbackError - When the AJAX request returns an error.\n *   Receives the `results` and `instance`\n * @event BookReader:SearchCallbackNotIndexed - When a message is received that\n *   the book has not had OCR text indexed yet. Receives `instance`\n * @event BookReader:SearchCallbackEmpty - When no results found. Receives\n *   `instance`\n */\nimport SearchView from './view.js';\n\njQuery.extend(BookReader.defaultOptions, {\n  server: 'ia600609.us.archive.org',\n  bookId: '',\n  subPrefix: '',\n  bookPath: '',\n  enableSearch: true,\n  searchInsideUrl: '/fulltext/inside.php',\n  initialSearchTerm: null,\n});\n\n/** @override */\nBookReader.prototype.setup = (function (super_) {\n  return function (options) {\n    super_.call(this, options);\n\n    this.searchTerm = '';\n    this.searchResults = null;\n    this.searchInsideUrl = options.searchInsideUrl;\n    this.enableSearch = options.enableSearch;\n    this.goToFirstResult = false;\n\n    // Base server used by some api calls\n    this.bookId = options.bookId;\n    this.server = options.server;\n    this.subPrefix = options.subPrefix;\n    this.bookPath = options.bookPath;\n\n    if (this.searchView) { return; }\n    this.searchView = new SearchView({\n      br: this,\n      selector: '#BRsearch_tray',\n    });\n  };\n})(BookReader.prototype.setup);\n\n/** @override */\nBookReader.prototype.init = (function (super_) {\n  return function () {\n    super_.call(this);\n\n    if (this.options.enableSearch && this.options.initialSearchTerm) {\n      this.search(\n        this.options.initialSearchTerm,\n        { goToFirstResult: this.goToFirstResult, suppressFragmentChange: true }\n      );\n    }\n  };\n})(BookReader.prototype.init);\n\n/** @override */\nBookReader.prototype.buildMobileDrawerElement = (function (super_) {\n  return function () {\n    const $el = super_.call(this);\n    if (!this.enableSearch) { return; }\n    if (this.searchView.dom.mobileSearch) {\n      $el.find('.BRmobileMenu__moreInfoRow').after(this.searchView.dom.mobileSearch);\n    }\n    return $el;\n  };\n})(BookReader.prototype.buildMobileDrawerElement);\n\n/** @override */\nBookReader.prototype.buildToolbarElement = (function (super_) {\n  return function () {\n    const $el = super_.call(this);\n    if (!this.enableSearch) { return; }\n    if (this.searchView.dom.toolbarSearch) {\n      $el.find('.BRtoolbarSectionInfo').after(this.searchView.dom.toolbarSearch);\n    }\n    return $el;\n  };\n})(BookReader.prototype.buildToolbarElement);\n\n/**\n * @typedef {object} SearchOptions\n * @property {boolean} goToFirstResult\n * @property {boolean} disablePopup\n * @property {(null|function)} error - @deprecated at v.5.0\n * @property {(null|function)} success - @deprecated at v.5.0\n */\n\n/**\n * Submits search request\n *\n * @param {string} term\n * @param {SearchOptions} overrides\n */\nBookReader.prototype.search = function(term = '', overrides = {}) {\n  /** @type {SearchOptions} */\n  const defaultOptions = {\n    goToFirstResult: false, /* jump to the first result (default=false) */\n    disablePopup: false,    /* don't show the modal progress (default=false) */\n    suppressFragmentChange: false, /* don't change the URL on initial load */\n    error: null,            /* optional error handler (default=null) */\n    success: null,          /* optional success handler (default=null) */\n\n  };\n  const options = jQuery.extend({}, defaultOptions, overrides);\n  this.suppressFragmentChange = options.suppressFragmentChange;\n\n  // strip slashes, since this goes in the url\n  this.searchTerm = term.replace(/\\//g, ' ');\n\n  if (!options.suppressFragmentChange) {\n    this.trigger(BookReader.eventNames.fragmentChange);\n  }\n\n  // Add quotes to the term. This is to compenstate for the backends default OR query\n  // term = term.replace(/['\"]+/g, '');\n  // term = '\"' + term + '\"';\n\n  // Remove the port and userdir\n  const serverPath = this.server.replace(/:.+/, '');\n  const baseUrl = `https://${serverPath}${this.searchInsideUrl}?`;\n\n  // Remove subPrefix from end of path\n  let path = this.bookPath;\n  const subPrefixWithSlash = `/${this.subPrefix}`;\n  if (this.bookPath.length - this.bookPath.lastIndexOf(subPrefixWithSlash) == subPrefixWithSlash.length) {\n    path = this.bookPath.substr(0, this.bookPath.length - subPrefixWithSlash.length);\n  }\n\n  const urlParams = {\n    item_id: this.bookId,\n    doc: this.subPrefix,\n    path,\n    q: term,\n  };\n\n  // NOTE that the API does not expect / (slashes) to be encoded. (%2F) won't work\n  const paramStr = $.param(urlParams).replace(/%2F/g, '/');\n\n  const url = `${baseUrl}${paramStr}`;\n\n  const processSearchResults = (searchInsideResults) => {\n    const responseHasError = searchInsideResults.error || !searchInsideResults.matches.length;\n    const hasCustomError = typeof options.error === 'function';\n    const hasCustomSuccess = typeof options.success === 'function';\n\n    if (responseHasError) {\n      hasCustomError\n        ? options.error.call(this, searchInsideResults, options)\n        : this.BRSearchCallbackError(searchInsideResults, options);\n    } else {\n      hasCustomSuccess\n        ? options.success.call(this, searchInsideResults, options)\n        : this.BRSearchCallback(searchInsideResults, options);\n    }\n  };\n\n  this.trigger('SearchStarted', { term: this.searchTerm });\n  return $.ajax({\n    url: url,\n    dataType: 'jsonp'\n  }).then(processSearchResults);\n};\n\n/**\n  * @typedef {object} SearchInsideMatchBox\n  * @property {number} page\n  * @property {number} r\n  * @property {number} l\n  * @property {number} b\n  * @property {number} t\n  * @property {HTMLDivElement} [div]\n  */\n\n/**\n * @typedef {object} SearchInsideMatch\n * @property {string} text\n * @property {Array<{ page: number, boxes: SearchInsideMatchBox[] }>} par\n */\n\n/**\n * @typedef {object} SearchInsideResults\n * @property {string} error\n * @property {SearchInsideMatch[]} matches\n * @property {boolean} indexed\n */\n\n/**\n * Search Results return handler\n * @callback\n * @param {SearchInsideResults} results\n * @param {object} options\n * @param {boolean} options.goToFirstResult\n */\nBookReader.prototype.BRSearchCallback = function(results, options) {\n  this.searchResults = results;\n\n  this.updateSearchHilites();\n  this.removeProgressPopup();\n  if (options.goToFirstResult) {\n    this._searchPluginGoToResult(results.matches[0].par[0].page);\n  }\n  this.trigger('SearchCallback', { results, options, instance: this });\n}\n\n/**\n * Main search results error handler\n * @callback\n * @param {SearchInsideResults} results\n */\nBookReader.prototype.BRSearchCallbackError = function(results) {\n  this._BRSearchCallbackError(results);\n};\n\n/**\n * @private draws search results error\n * @callback\n * @param {SearchInsideResults} results\n * @param {jQuery} $el\n * @param {boolean} fade\n */\nBookReader.prototype._BRSearchCallbackError = function(results) {\n  this.searchResults = results;\n  const basePayload = {\n    term: this.searchTerm,\n    instance: this,\n  };\n  if (results.error) {\n    const payload = Object.assign({}, basePayload, { results });\n    this.trigger('SearchCallbackError', payload);\n  } else if (0 == results.matches.length) {\n    if (false === results.indexed) {\n      this.trigger('SearchCallbackBookNotIndexed', basePayload);\n      return;\n    }\n    this.trigger('SearchCallbackEmpty', basePayload);\n  }\n};\n\n/**\n * updates search on-page highlights controller\n */\nBookReader.prototype.updateSearchHilites = function() {\n  if (this.constMode2up == this.mode) {\n    this.updateSearchHilites2UP();\n    return;\n  }\n  this.updateSearchHilites1UP();\n};\n\n/**\n * update search on-page highlights in 1up mode\n */\nBookReader.prototype.updateSearchHilites1UP = function() {\n  const results = this.searchResults;\n  if (null == results) return;\n  results.matches.forEach(match => {\n    match.par[0].boxes.forEach(box => {\n      const pageIndex = this.leafNumToIndex(box.page);\n      const pageIsInView = jQuery.inArray(pageIndex, this.displayedIndices) >= 0;\n      if (pageIsInView) {\n        if (!box.div) {\n          //create a div for the search highlight, and stash it in the box object\n          box.div = document.createElement('div');\n          $(box.div).prop('className', 'BookReaderSearchHilite').appendTo(this.$(`.pagediv${pageIndex}`));\n        }\n        const highlight = {\n          width:  `${(box.r - box.l) / this.reduce}px`,\n          height: `${(box.b - box.t) / this.reduce}px`,\n          left:   `${(box.l) / this.reduce}px`,\n          top:    `${(box.t) / this.reduce}px`\n        };\n        $(box.div).css(highlight);\n      } else {\n        if (box.div) {\n          $(box.div).remove();\n          box.div = null;\n        }\n      }\n    });\n  });\n};\n\n/**\n * update search on-page highlights in 2up mode\n */\nBookReader.prototype.updateSearchHilites2UP = function() {\n  const results = this.searchResults;\n\n  if (results === null) return;\n\n  const { matches } = results;\n  matches.forEach((match) => {\n    match.par[0].boxes.forEach(box => {\n      const pageIndex = this.leafNumToIndex(match.par[0].page);\n      const pageIsInView = jQuery.inArray(pageIndex, this.displayedIndices) >= 0;\n      const { isViewable } = this._models.book.getPage(pageIndex);\n\n      if (pageIsInView && isViewable) {\n        if (!box.div) {\n          //create a div for the search highlight, and stash it in the box object\n          box.div = document.createElement('div');\n          $(box.div).addClass('BookReaderSearchHilite')\n            .appendTo(this.refs.$brTwoPageView);\n        }\n        this.setHilightCss2UP(box.div, pageIndex, box.l, box.r, box.t, box.b);\n      } else {\n        // clear stale reference\n        if (box.div) {\n          $(box.div).remove();\n          box.div = null;\n        }\n      }\n    });\n  });\n};\n\n/**\n * remove search highlights\n */\nBookReader.prototype.removeSearchHilites = function() {\n  const results = this.searchResults;\n  if (null == results || !results.matches) { return; }\n  results.matches.forEach(match => {\n    match.par[0].boxes.forEach(box => {\n      if (null != box.div) {\n        $(box.div).remove();\n        box.div = null;\n      }\n    });\n  });\n};\n\n/**\n * @private\n * Goes to the page specified. If the page is not viewable, tries to load the page\n * FIXME Most of this logic is IA specific, and should be less integrated into here\n * or at least more configurable.\n * @param {PageIndex} pageIndex\n */\nBookReader.prototype._searchPluginGoToResult = async function (pageIndex) {\n  const { book } = this._models;\n  const page = book.getPage(pageIndex);\n  let makeUnviewableAtEnd = false;\n  if (!page.isViewable) {\n    const resp = await fetch('/services/bookreader/request_page?' + new URLSearchParams({\n      id: this.options.bookId,\n      subprefix: this.options.subPrefix,\n      leafNum: page.leafNum,\n    })).then(r => r.json());\n\n    for (const leafNum of resp.value) {\n      book.getPage(book.leafNumToIndex(leafNum)).makeViewable();\n    }\n\n    // not able to show page; make the page viewable anyways so that it can\n    // actually open. On IA, it has a fallback to a special error page.\n    if (!resp.value.length) {\n      book.getPage(pageIndex).makeViewable();\n      makeUnviewableAtEnd = true;\n    }\n  }\n  /* this updates the URL */\n  this.suppressFragmentChange = false;\n  this.jumpToIndex(pageIndex);\n\n  // Reset it to unviewable if it wasn't resolved\n  if (makeUnviewableAtEnd) {\n    book.getPage(pageIndex).makeViewable(false);\n  }\n};\n\n/**\n * Removes all search pins\n */\nBookReader.prototype.removeSearchResults = function(suppressFragmentChange = false) {\n  this.removeSearchHilites(); //be sure to set all box.divs to null\n  this.searchTerm = null;\n  this.searchResults = null;\n  if (!suppressFragmentChange) {\n    this.trigger(BookReader.eventNames.fragmentChange);\n  }\n};\n\n/**\n * Returns true if a search highlight is currently being displayed\n * @returns {boolean}\n */\nBookReader.prototype.searchHighlightVisible = function() {\n  const results = this.searchResults;\n  let visiblePages = [];\n  if (null == results) return false;\n\n  if (this.constMode2up == this.mode) {\n    visiblePages = [this.twoPage.currentIndexL, this.twoPage.currentIndexR];\n  } else if (this.constMode1up == this.mode) {\n    visiblePages = [this.currentIndex()];\n  } else {\n    return false;\n  }\n\n  results.matches.some(match => {\n    return match.par[0].boxes.some(box => {\n      const pageIndex = this.leafNumToIndex(box.page);\n      if (jQuery.inArray(pageIndex, visiblePages) >= 0) {\n        return true;\n      }\n    });\n  });\n\n  return false;\n};\n","class SearchView {\n  /**\n   * @param {object} params\n   *   @param {string} params.selector A selector for the element that the search tray will be rendered in\n   *   @param {string} params.query An existing query string\n   *   @param {object} params.br The BookReader instance\n   *\n   * @event BookReader:SearchResultsCleared - when the search results nav gets cleared\n   * @event BookReader:ToggleSearchMenu - when search results menu should toggle\n   */\n  constructor(params) {\n    if (!params.selector) {\n      console.warn('BookReader::Search - SearchView must be passed a valid CSS selector');\n      return;\n    }\n\n    this.br = params.br;\n\n    // Search results are returned as a text blob with the hits wrapped in\n    // triple mustaches. Hits occasionally include text beyond the search\n    // term, so everything within the staches is captured and wrapped.\n    this.matcher = new RegExp('{{{(.+?)}}}', 'g');\n    this.matches = [];\n    this.cacheDOMElements(params.selector);\n    this.bindEvents();\n  }\n\n  /**\n   * @param {string} selector A selector for the element that the search tray will be rendered in\n   */\n  cacheDOMElements(selector) {\n    this.dom = {};\n\n    // The parent search tray in mobile menu\n    this.dom.searchTray = this.renderSearchTray(selector);\n    // Container for rendered search results\n    this.dom.results = this.dom.searchTray.querySelector('[data-id=\"results\"]');\n    // Element used to display number of results\n    this.dom.resultsCount = this.dom.searchTray.querySelector('[data-id=\"results_count\"]');\n    // Search input within the mobile search tray\n    this.dom.searchField = this.dom.searchTray.querySelector('[name=\"query\"]');\n    // Waiting indicator displayed while waiting for a search request\n    this.dom.searchPending = this.dom.searchTray.querySelector('[data-id=\"searchPending\"]');\n    // The element added to the mobile menu that is animated into view when\n    // the \"search\" nav item is clicked\n    this.dom.mobileSearch = this.buildMobileDrawer();\n    // Search input within the top toolbar. Will be removed once the mobile menu is replaced.\n    this.dom.toolbarSearch = this.buildToolbarSearch();\n  }\n\n  /**\n   * @param {boolean} bool\n   */\n  toggleSearchTray(bool = this.dom.searchTray.classList.contains('hidden')) {\n    this.dom.searchTray.classList.toggle('hidden', !bool);\n  }\n\n  /**\n   * @param {boolean} bool\n   */\n  toggleResultsCount(bool) {\n    this.dom.resultsCount.classList.toggle('visible', bool);\n  }\n\n  /**\n   * @param {SearchInsideResults} results\n   */\n  updateResultsCount(results) {\n    this.dom.resultsCount.innerText = `(${results} result${results != 1 ? 's' : ''})`;\n    this.toggleResultsCount(true);\n  }\n\n  /**\n   * @param {string} query\n   */\n  setQuery(query) {\n    this.br.$('[name=\"query\"]').val(query);\n  }\n\n  emptyMatches() {\n    this.dom.results.innerHTML = '';\n    this.matches = [];\n  }\n\n  removeResultPins() {\n    this.br.$('.BRnavpos .BRsearch').remove();\n  }\n\n  clearSearchFieldAndResults() {\n    this.br.removeSearchResults();\n    this.toggleResultsCount(false);\n    this.removeResultPins();\n    this.emptyMatches();\n    this.setQuery('');\n    this.teardownSearchNavigation();\n    this.br.trigger('SearchResultsCleared');\n  }\n\n  toggleSidebar() {\n    this.br.trigger('ToggleSearchMenu');\n  }\n  /**\n   * @param {string} selector The ID attribute to be used for the search tray\n   */\n  renderSearchTray(selector) {\n    const searchTray = document.createElement('div');\n    searchTray.setAttribute('id', selector.replace(/^#/, ''));\n    searchTray.innerHTML = `\n      <header>\n        <div>\n          <h3>Search inside</h3>\n          <p data-id=\"results_count\"></p>\n        </div>\n        <a href=\"#\" class=\"close\"></a>\n      </header>\n      <form action=\"\" method=\"get\">\n        <fieldset>\n          <input name=\"all_files\" id=\"all_files\" type=\"checkbox\" />\n          <label class=\"checkbox\" for=\"all_files\">Search all files</label>\n          <input type=\"search\" name=\"query\" placeholder=\"Enter a search term\" />\n        </fieldset>\n      </form>\n      <div data-id=\"searchPending\" id=\"search_pending\">\n        <p>Your search results will appear below</p>\n        <div class=\"loader tc mt20\"></div>\n      </div>\n      <ul data-id=\"results\"></ul>\n    `;\n    return searchTray;\n  }\n\n  renderSearchNavigation() {\n    const selector = 'BRsearch-navigation';\n    $('.BRnav').before(`\n      <div class=\"${selector}\">\n        <button class=\"toggle-sidebar\">\n          <h4>\n            <span class=\"icon icon-search\"></span> Results\n          </h4>\n        </button>\n        <div class=\"pagination\">\n          <button class=\"prev\" title=\"Previous result\"><span class=\"icon icon-chevron hflip\"></span></button>\n          <span data-id=\"resultsCount\">${this.resultsPosition()}</span>\n          <button class=\"next\" title=\"Next result\"><span class=\"icon icon-chevron\"></button>\n        </div>\n        <button class=\"clear\" title=\"Clear search results\">\n          <span class=\"icon icon-close\"></span>\n        </button>\n      </div>\n    `);\n    this.dom.searchNavigation = $(`.${selector}`);\n  }\n\n  resultsPosition() {\n    let positionMessage = `${this.matches.length} result${this.matches.length === 1 ? '' : 's'}`;\n    if (~this.currentMatchIndex) {\n      positionMessage = `${this.currentMatchIndex + 1} / ${this.matches.length}`;\n    }\n    return positionMessage;\n  }\n\n  bindSearchNavigationEvents() {\n    if (!this.dom.searchNavigation) { return; }\n    const namespace = 'searchNavigation';\n\n    this.dom.searchNavigation\n      .on(`click.${namespace}`, '.clear', this.clearSearchFieldAndResults.bind(this))\n      .on(`click.${namespace}`, '.prev', this.showPrevResult.bind(this))\n      .on(`click.${namespace}`, '.next', this.showNextResult.bind(this))\n      .on(`click.${namespace}`, '.toggle-sidebar', this.toggleSidebar.bind(this))\n      .on(`click.${namespace}`, false);\n  }\n\n  showPrevResult() {\n    if (this.currentMatchIndex === 0) { return; }\n    if (this.br.mode === this.br.constModeThumb) { this.br.switchMode(this.br.constMode1up); }\n    if (!~this.currentMatchIndex) {\n      this.currentMatchIndex = this.getClosestMatchIndex((start, end, comparator) => end[0] > comparator) + 1;\n    }\n    this.br.$('.BRnavline .BRsearch').eq(--this.currentMatchIndex).click();\n    this.updateResultsPosition();\n    this.updateSearchNavigationButtons();\n  }\n\n  showNextResult() {\n    if (this.currentMatchIndex + 1 === this.matches.length) { return; }\n    if (this.br.mode === this.br.constModeThumb) { this.br.switchMode(this.br.constMode1up); }\n    if (!~this.currentMatchIndex) {\n      this.currentMatchIndex = this.getClosestMatchIndex((start, end, comparator) => start[start.length - 1] > comparator) - 1;\n    }\n    this.br.$('.BRnavline .BRsearch').eq(++this.currentMatchIndex).click();\n    this.updateResultsPosition();\n    this.updateSearchNavigationButtons();\n  }\n\n  /**\n   * Obtains closest match based on the logical comparison function passed in.\n   * When the comparison function returns true, the starting (left) half of the\n   * matches array is used in the binary split, else the ending (right) half is\n   * used. A recursive call is made to perform the same split and comparison\n   * on the winning half of the matches. This is traditionally known as binary\n   * search (https://en.wikipedia.org/wiki/Binary_search_algorithm), and in\n   * most cases (medium to large search result arrays) should outperform\n   * traversing the array from start to finish. In the case of small arrays,\n   * the speed difference is negligible.\n   *\n   * @param {function} comparisonFn\n   * @return {number} matchIndex\n   */\n  getClosestMatchIndex(comparisonFn) {\n    const matchPages = this.matches.map((m) => m.par[0].page);\n    const currentPage = this.br.currentIndex() + 1;\n    const closestTo = (pool, comparator) => {\n      if (pool.length === 1) { return pool[0]; }\n      const start = pool.slice(0, pool.length / 2);\n      const end = pool.slice(pool.length / 2);\n      return closestTo((comparisonFn(start, end, comparator) ? start : end), comparator);\n    }\n\n    const closestPage = closestTo(matchPages, currentPage);\n    return this.matches.indexOf(this.matches.find((m) => m.par[0].page === closestPage));\n  }\n\n  updateResultsPosition() {\n    this.dom.searchNavigation.find('[data-id=resultsCount]').text(this.resultsPosition());\n  }\n\n  updateSearchNavigationButtons() {\n    this.dom.searchNavigation.find('.prev').attr('disabled', !this.currentMatchIndex);\n    this.dom.searchNavigation.find('.next').attr('disabled', this.currentMatchIndex + 1 === this.matches.length);\n  }\n\n  teardownSearchNavigation() {\n    if (!this.dom.searchNavigation) {\n      this.dom.searchNavigation = $('.BRsearch-navigation');\n    }\n    if (!this.dom.searchNavigation.length) { return; }\n\n    this.dom.searchNavigation.off('.searchNavigation').remove();\n    this.dom.searchNavigation = null;\n    this.br.resize();\n  }\n\n  setCurrentMatchIndex() {\n    let matchingSearchResult;\n    if (this.br.mode === this.br.constModeThumb) {\n      this.currentMatchIndex = -1;\n      return;\n    }\n    if (this.br.mode === this.br.constMode2up) {\n      matchingSearchResult = this.find2upMatchingSearchResult();\n    }\n    else {\n      matchingSearchResult = this.find1upMatchingSearchResult();\n    }\n    this.currentMatchIndex = this.matches.indexOf(matchingSearchResult);\n  }\n\n  find1upMatchingSearchResult() {\n    return this.matches.find((m) => this.br.currentIndex() === m.par[0].page - 1);\n  }\n\n  find2upMatchingSearchResult() {\n    return this.matches.find((m) => this.br._isIndexDisplayed(m.par[0].page - 1));\n  }\n\n  updateSearchNavigation() {\n    if (!this.matches.length) { return; }\n\n    this.setCurrentMatchIndex();\n    this.updateResultsPosition();\n    this.updateSearchNavigationButtons();\n  }\n\n  /**\n   * @param {array} matches\n   */\n  renderMatches(matches) {\n    const items = matches.map((match) => `\n      <li data-page=\"${match.par[0].page}\" data-page-index=\"${this.br.leafNumToIndex(match.par[0].page)}\">\n        <h4>Page ${match.par[0].page}</h4>\n        <p>${match.text.replace(this.matcher, '<mark>$1</mark>')}</p>\n      </li>\n    `);\n    this.dom.results.innerHTML = items.join('');\n  }\n\n  /**\n   * @param {boolean} bool\n   */\n  togglePinsFor(bool) {\n    const pinsVisibleState = bool ? 'visible' : 'hidden';\n    this.br.refs.$BRfooter.find('.BRsearch').css({ visibility: pinsVisibleState });\n  }\n\n  buildMobileDrawer() {\n    const mobileSearch = document.createElement('li');\n    mobileSearch.innerHTML = `\n      <span>\n        <span class=\"DrawerIconWrapper\">\n          <img class=\"DrawerIcon\" src=\"${this.br.imagesBaseURL}icon_search_button.svg\" />\n        </span>\n        Search\n      </span>\n      <div data-id=\"search_slot\">\n      </div>\n    `;\n    mobileSearch.querySelector('[data-id=\"search_slot\"]').appendChild(this.dom.searchTray);\n    mobileSearch.classList.add('BRmobileMenu__search');\n    return mobileSearch;\n  }\n\n  buildToolbarSearch() {\n    const toolbarSearch = document.createElement('span');\n    toolbarSearch.classList.add('BRtoolbarSection', 'BRtoolbarSectionSearch');\n    toolbarSearch.innerHTML = `\n      <form class=\"BRbooksearch desktop\">\n        <input type=\"search\" name=\"query\" class=\"BRsearchInput\" value=\"\" placeholder=\"Search inside\"/>\n        <button type=\"submit\" class=\"BRsearchSubmit\">\n          <img src=\"${this.br.imagesBaseURL}icon_search_button.svg\" />\n        </button>\n      </form>\n    `;\n    return toolbarSearch;\n  }\n\n  /**\n   * @param {array} matches\n   */\n  renderPins(matches) {\n    matches.forEach((match) => {\n      const queryString = match.text;\n      const pageIndex = this.br.leafNumToIndex(match.par[0].page);\n      const pageNumber = this.br.getPageNum(pageIndex);\n      const uiStringSearch = \"Search result\"; // i18n\n      const uiStringPage = \"Page\"; // i18n\n\n      const percentThrough = this.br.constructor.util.cssPercentage(pageIndex, this.br.getNumLeafs() - 1);\n\n      const queryStringWithB = queryString.replace(this.matcher, '<b>$1</b>');\n\n      let queryStringWithBTruncated = '';\n\n      if (queryString.length > 100) {\n        queryStringWithBTruncated = queryString\n          .replace(/^(.{100}[^\\s]*).*/, \"$1\")\n          .replace(this.matcher, '<b>$1</b>')\n                + '...';\n      }\n\n      // draw marker\n      $('<div>')\n        .addClass('BRsearch')\n        .css({\n          left: percentThrough,\n        })\n        .attr('title', uiStringSearch)\n        .append(`\n          <div class=\"BRquery\">\n            <div>${queryStringWithBTruncated || queryStringWithB}</div>\n            <div>${uiStringPage} ${pageNumber}</div>\n          </div>\n        `)\n        .data({ pageIndex })\n        .appendTo(this.br.$('.BRnavline'))\n        .hover(\n          (event) => {\n            // remove from other markers then turn on just for this\n            // XXX should be done when nav slider moves\n            const marker = event.currentTarget;\n            const tooltip = marker.querySelector('.BRquery');\n            const tooltipOffset = tooltip.getBoundingClientRect();\n            const targetOffset = marker.getBoundingClientRect();\n            const boxSizeAdjust = parseInt(getComputedStyle(tooltip).paddingLeft) * 2;\n            if (tooltipOffset.x - boxSizeAdjust < 0) {\n              tooltip.style.setProperty('transform', `translateX(-${targetOffset.left - boxSizeAdjust}px)`);\n            }\n            $('.BRsearch,.BRchapter').removeClass('front');\n            $(event.target).addClass('front');\n          },\n          (event) => $(event.target).removeClass('front'))\n        .click(function (event) {\n          // closures are nested and deep, using an arrow function breaks references.\n          // Todo: update to arrow function & clean up closures\n          // to remove `bind` dependency\n          this.br._searchPluginGoToResult(+$(event.target).data('pageIndex'));\n          this.br.updateSearchHilites();\n        }.bind(this));\n    });\n  }\n\n  /**\n   * @param {boolean} bool\n   */\n  toggleSearchPending(bool) {\n    this.dom.searchPending.classList.toggle('visible', bool);\n    if (bool) {\n      this.br.showProgressPopup(\"Search results will appear below...\");\n    }\n    else {\n      this.br.removeProgressPopup();\n    }\n  }\n\n  renderErrorModal() {\n    this.renderModalMessage(`\n      Sorry, there was an error with your search.\n      <br />\n      The text may still be processing.\n    `);\n    this.delayModalRemovalFor(4000);\n  }\n\n  renderBookNotIndexedModal() {\n    this.renderModalMessage(`\n      <p>\n         This book hasn't been indexed for searching yet.\n         We've just started indexing it, so search should be available soon.\n         <br />\n         Please try again later. Thanks!\n      </p>\n    `);\n    this.delayModalRemovalFor(5000);\n  }\n\n  renderResultsEmptyModal() {\n    this.renderModalMessage('No matches were found.');\n    this.delayModalRemovalFor(2000);\n  }\n\n  /**\n   * @param {string} messageHTML The innerHTML string used to popupate the modal contents\n   */\n  renderModalMessage(messageHTML) {\n    const modal = document.createElement('div');\n    modal.classList.add('BRprogresspopup', 'search_modal');\n    modal.innerHTML = messageHTML;\n    document.querySelector(this.br.el).append(modal);\n  }\n\n  /**\n   * @param {number} timeoutMS\n   */\n  delayModalRemovalFor(timeoutMS) {\n    setTimeout(this.br.removeProgressPopup.bind(this.br), timeoutMS);\n  }\n\n  openMobileMenu() {\n    this.br.refs.$mmenu.data('mmenu').open();\n  }\n\n  closeMobileMenu() {\n    this.br.refs.$mmenu.data('mmenu').close();\n  }\n\n  /**\n   * @param {Event} e\n   */\n  submitHandler(e) {\n    e.preventDefault();\n    const query = e.target.querySelector('[name=\"query\"]').value;\n    if (!query.length) { return false; }\n    this.br.search(query);\n    this.dom.searchField.blur();\n    this.emptyMatches();\n    this.toggleSearchPending(true);\n    return false;\n  }\n\n  /**\n   * @param {Event} e\n   * @param {object} properties\n   *   @param {object} properties.results\n   *   @param {object} properties.options\n   */\n  handleSearchCallback(e, { results, options }) {\n    this.matches = results.matches;\n    this.setCurrentMatchIndex();\n    this.teardownSearchNavigation();\n    this.renderSearchNavigation();\n    this.bindSearchNavigationEvents();\n    this.renderMatches(results.matches);\n    this.renderPins(results.matches);\n    this.updateResultsCount(results.matches.length);\n    this.toggleSearchPending(false);\n    if (options.goToFirstResult) {\n      $(document).one('BookReader:pageChanged', () => {\n        this.br.resize();\n      });\n    } else {\n      this.br.resize();\n    }\n  }\n\n  /**\n   * @param {Event} e\n   */\n  handleNavToggledCallback(e) {\n    const is_visible = this.br.navigationIsVisible();\n    this.togglePinsFor(is_visible);\n    this.toggleSearchTray(is_visible ? !!this.dom.results.querySelector('li') : false);\n  }\n\n  handleSearchStarted() {\n    this.emptyMatches();\n    this.br.removeSearchHilites();\n    this.removeResultPins();\n    this.toggleSearchPending(true);\n    this.teardownSearchNavigation();\n    this.setQuery(this.br.searchTerm);\n  }\n\n  handleSearchCallbackError() {\n    this.toggleSearchPending(false);\n    this.renderErrorModal();\n  }\n\n  handleSearchCallbackBookNotIndexed() {\n    this.toggleSearchPending(false);\n    this.renderBookNotIndexedModal();\n  }\n\n  handleSearchCallbackEmpty() {\n    this.toggleSearchPending(false);\n    this.renderResultsEmptyModal();\n  }\n\n  bindEvents() {\n    const namespace = 'BookReader:';\n\n    $(document).on(`${namespace}SearchCallback`, this.handleSearchCallback.bind(this))\n      .on(`${namespace}navToggled`, this.handleNavToggledCallback.bind(this))\n      .on(`${namespace}SearchStarted`, this.handleSearchStarted.bind(this))\n      .on(`${namespace}SearchCallbackError`, this.handleSearchCallbackError.bind(this))\n      .on(`${namespace}SearchCallbackBookNotIndexed`, this.handleSearchCallbackBookNotIndexed.bind(this))\n      .on(`${namespace}SearchCallbackEmpty`, this.handleSearchCallbackEmpty.bind(this))\n      .on(`${namespace}pageChanged`, this.updateSearchNavigation.bind(this));\n\n    this.dom.searchTray.addEventListener('submit', this.submitHandler.bind(this));\n    this.dom.toolbarSearch.querySelector('form').addEventListener('submit', this.submitHandler.bind(this));\n    this.dom.searchField.addEventListener('search', () => {\n      if (this.dom.searchField.value) { return; }\n      this.clearSearchFieldAndResults();\n    });\n\n    $(this.dom.results).on('click', 'li', (e) => {\n      this.br._searchPluginGoToResult(+e.currentTarget.dataset.pageIndex);\n      this.br.updateSearchHilites();\n      this.closeMobileMenu();\n    });\n  }\n}\n\nexport default SearchView;\n","'use strict';\nvar $forEach = require('../internals/array-iteration').forEach;\nvar arrayMethodIsStrict = require('../internals/array-method-is-strict');\nvar arrayMethodUsesToLength = require('../internals/array-method-uses-to-length');\n\nvar STRICT_METHOD = arrayMethodIsStrict('forEach');\nvar USES_TO_LENGTH = arrayMethodUsesToLength('forEach');\n\n// `Array.prototype.forEach` method implementation\n// https://tc39.github.io/ecma262/#sec-array.prototype.foreach\nmodule.exports = (!STRICT_METHOD || !USES_TO_LENGTH) ? function forEach(callbackfn /* , thisArg */) {\n  return $forEach(this, callbackfn, arguments.length > 1 ? arguments[1] : undefined);\n} : [].forEach;\n","'use strict';\nvar toIndexedObject = require('../internals/to-indexed-object');\nvar toInteger = require('../internals/to-integer');\nvar toLength = require('../internals/to-length');\nvar arrayMethodIsStrict = require('../internals/array-method-is-strict');\nvar arrayMethodUsesToLength = require('../internals/array-method-uses-to-length');\n\nvar min = Math.min;\nvar nativeLastIndexOf = [].lastIndexOf;\nvar NEGATIVE_ZERO = !!nativeLastIndexOf && 1 / [1].lastIndexOf(1, -0) < 0;\nvar STRICT_METHOD = arrayMethodIsStrict('lastIndexOf');\n// For preventing possible almost infinite loop in non-standard implementations, test the forward version of the method\nvar USES_TO_LENGTH = arrayMethodUsesToLength('indexOf', { ACCESSORS: true, 1: 0 });\nvar FORCED = NEGATIVE_ZERO || !STRICT_METHOD || !USES_TO_LENGTH;\n\n// `Array.prototype.lastIndexOf` method implementation\n// https://tc39.github.io/ecma262/#sec-array.prototype.lastindexof\nmodule.exports = FORCED ? function lastIndexOf(searchElement /* , fromIndex = @[*-1] */) {\n  // convert -0 to +0\n  if (NEGATIVE_ZERO) return nativeLastIndexOf.apply(this, arguments) || 0;\n  var O = toIndexedObject(this);\n  var length = toLength(O.length);\n  var index = length - 1;\n  if (arguments.length > 1) index = min(index, toInteger(arguments[1]));\n  if (index < 0) index = length + index;\n  for (;index >= 0; index--) if (index in O && O[index] === searchElement) return index || 0;\n  return -1;\n} : nativeLastIndexOf;\n","var wellKnownSymbol = require('../internals/well-known-symbol');\n\nvar ITERATOR = wellKnownSymbol('iterator');\nvar SAFE_CLOSING = false;\n\ntry {\n  var called = 0;\n  var iteratorWithReturn = {\n    next: function () {\n      return { done: !!called++ };\n    },\n    'return': function () {\n      SAFE_CLOSING = true;\n    }\n  };\n  iteratorWithReturn[ITERATOR] = function () {\n    return this;\n  };\n  // eslint-disable-next-line no-throw-literal\n  Array.from(iteratorWithReturn, function () { throw 2; });\n} catch (error) { /* empty */ }\n\nmodule.exports = function (exec, SKIP_CLOSING) {\n  if (!SKIP_CLOSING && !SAFE_CLOSING) return false;\n  var ITERATION_SUPPORT = false;\n  try {\n    var object = {};\n    object[ITERATOR] = function () {\n      return {\n        next: function () {\n          return { done: ITERATION_SUPPORT = true };\n        }\n      };\n    };\n    exec(object);\n  } catch (error) { /* empty */ }\n  return ITERATION_SUPPORT;\n};\n","var userAgent = require('../internals/engine-user-agent');\n\nmodule.exports = /(iphone|ipod|ipad).*applewebkit/i.test(userAgent);\n","var global = require('../internals/global');\n\nmodule.exports = function (a, b) {\n  var console = global.console;\n  if (console && console.error) {\n    arguments.length === 1 ? console.error(a) : console.error(a, b);\n  }\n};\n","var isObject = require('../internals/is-object');\nvar setPrototypeOf = require('../internals/object-set-prototype-of');\n\n// makes subclassing work correct for wrapped built-ins\nmodule.exports = function ($this, dummy, Wrapper) {\n  var NewTarget, NewTargetPrototype;\n  if (\n    // it can work only with native `setPrototypeOf`\n    setPrototypeOf &&\n    // we haven't completely correct pre-ES6 way for getting `new.target`, so use this\n    typeof (NewTarget = dummy.constructor) == 'function' &&\n    NewTarget !== Wrapper &&\n    isObject(NewTargetPrototype = NewTarget.prototype) &&\n    NewTargetPrototype !== Wrapper.prototype\n  ) setPrototypeOf($this, NewTargetPrototype);\n  return $this;\n};\n","var anObject = require('../internals/an-object');\nvar isArrayIteratorMethod = require('../internals/is-array-iterator-method');\nvar toLength = require('../internals/to-length');\nvar bind = require('../internals/function-bind-context');\nvar getIteratorMethod = require('../internals/get-iterator-method');\nvar iteratorClose = require('../internals/iterator-close');\n\nvar Result = function (stopped, result) {\n  this.stopped = stopped;\n  this.result = result;\n};\n\nmodule.exports = function (iterable, unboundFunction, options) {\n  var that = options && options.that;\n  var AS_ENTRIES = !!(options && options.AS_ENTRIES);\n  var IS_ITERATOR = !!(options && options.IS_ITERATOR);\n  var INTERRUPTED = !!(options && options.INTERRUPTED);\n  var fn = bind(unboundFunction, that, 1 + AS_ENTRIES + INTERRUPTED);\n  var iterator, iterFn, index, length, result, next, step;\n\n  var stop = function (condition) {\n    if (iterator) iteratorClose(iterator);\n    return new Result(true, condition);\n  };\n\n  var callFn = function (value) {\n    if (AS_ENTRIES) {\n      anObject(value);\n      return INTERRUPTED ? fn(value[0], value[1], stop) : fn(value[0], value[1]);\n    } return INTERRUPTED ? fn(value, stop) : fn(value);\n  };\n\n  if (IS_ITERATOR) {\n    iterator = iterable;\n  } else {\n    iterFn = getIteratorMethod(iterable);\n    if (typeof iterFn != 'function') throw TypeError('Target is not iterable');\n    // optimisation for array iterators\n    if (isArrayIteratorMethod(iterFn)) {\n      for (index = 0, length = toLength(iterable.length); length > index; index++) {\n        result = callFn(iterable[index]);\n        if (result && result instanceof Result) return result;\n      } return new Result(false);\n    }\n    iterator = iterFn.call(iterable);\n  }\n\n  next = iterator.next;\n  while (!(step = next.call(iterator)).done) {\n    try {\n      result = callFn(step.value);\n    } catch (error) {\n      iteratorClose(iterator);\n      throw error;\n    }\n    if (typeof result == 'object' && result && result instanceof Result) return result;\n  } return new Result(false);\n};\n","var global = require('../internals/global');\nvar getOwnPropertyDescriptor = require('../internals/object-get-own-property-descriptor').f;\nvar macrotask = require('../internals/task').set;\nvar IS_IOS = require('../internals/engine-is-ios');\nvar IS_NODE = require('../internals/engine-is-node');\n\nvar MutationObserver = global.MutationObserver || global.WebKitMutationObserver;\nvar document = global.document;\nvar process = global.process;\nvar Promise = global.Promise;\n// Node.js 11 shows ExperimentalWarning on getting `queueMicrotask`\nvar queueMicrotaskDescriptor = getOwnPropertyDescriptor(global, 'queueMicrotask');\nvar queueMicrotask = queueMicrotaskDescriptor && queueMicrotaskDescriptor.value;\n\nvar flush, head, last, notify, toggle, node, promise, then;\n\n// modern engines have queueMicrotask method\nif (!queueMicrotask) {\n  flush = function () {\n    var parent, fn;\n    if (IS_NODE && (parent = process.domain)) parent.exit();\n    while (head) {\n      fn = head.fn;\n      head = head.next;\n      try {\n        fn();\n      } catch (error) {\n        if (head) notify();\n        else last = undefined;\n        throw error;\n      }\n    } last = undefined;\n    if (parent) parent.enter();\n  };\n\n  // browsers with MutationObserver, except iOS - https://github.com/zloirock/core-js/issues/339\n  if (!IS_IOS && !IS_NODE && MutationObserver && document) {\n    toggle = true;\n    node = document.createTextNode('');\n    new MutationObserver(flush).observe(node, { characterData: true });\n    notify = function () {\n      node.data = toggle = !toggle;\n    };\n  // environments with maybe non-completely correct, but existent Promise\n  } else if (Promise && Promise.resolve) {\n    // Promise.resolve without an argument throws an error in LG WebOS 2\n    promise = Promise.resolve(undefined);\n    then = promise.then;\n    notify = function () {\n      then.call(promise, flush);\n    };\n  // Node.js without promises\n  } else if (IS_NODE) {\n    notify = function () {\n      process.nextTick(flush);\n    };\n  // for other environments - macrotask based on:\n  // - setImmediate\n  // - MessageChannel\n  // - window.postMessag\n  // - onreadystatechange\n  // - setTimeout\n  } else {\n    notify = function () {\n      // strange IE + webpack dev server bug - use .call(global)\n      macrotask.call(global, flush);\n    };\n  }\n}\n\nmodule.exports = queueMicrotask || function (fn) {\n  var task = { fn: fn, next: undefined };\n  if (last) last.next = task;\n  if (!head) {\n    head = task;\n    notify();\n  } last = task;\n};\n","var global = require('../internals/global');\n\nmodule.exports = global.Promise;\n","'use strict';\nvar aFunction = require('../internals/a-function');\n\nvar PromiseCapability = function (C) {\n  var resolve, reject;\n  this.promise = new C(function ($$resolve, $$reject) {\n    if (resolve !== undefined || reject !== undefined) throw TypeError('Bad Promise constructor');\n    resolve = $$resolve;\n    reject = $$reject;\n  });\n  this.resolve = aFunction(resolve);\n  this.reject = aFunction(reject);\n};\n\n// 25.4.1.5 NewPromiseCapability(C)\nmodule.exports.f = function (C) {\n  return new PromiseCapability(C);\n};\n","module.exports = function (exec) {\n  try {\n    return { error: false, value: exec() };\n  } catch (error) {\n    return { error: true, value: error };\n  }\n};\n","var anObject = require('../internals/an-object');\nvar isObject = require('../internals/is-object');\nvar newPromiseCapability = require('../internals/new-promise-capability');\n\nmodule.exports = function (C, x) {\n  anObject(C);\n  if (isObject(x) && x.constructor === C) return x;\n  var promiseCapability = newPromiseCapability.f(C);\n  var resolve = promiseCapability.resolve;\n  resolve(x);\n  return promiseCapability.promise;\n};\n","'use strict';\nvar getBuiltIn = require('../internals/get-built-in');\nvar definePropertyModule = require('../internals/object-define-property');\nvar wellKnownSymbol = require('../internals/well-known-symbol');\nvar DESCRIPTORS = require('../internals/descriptors');\n\nvar SPECIES = wellKnownSymbol('species');\n\nmodule.exports = function (CONSTRUCTOR_NAME) {\n  var Constructor = getBuiltIn(CONSTRUCTOR_NAME);\n  var defineProperty = definePropertyModule.f;\n\n  if (DESCRIPTORS && Constructor && !Constructor[SPECIES]) {\n    defineProperty(Constructor, SPECIES, {\n      configurable: true,\n      get: function () { return this; }\n    });\n  }\n};\n","var global = require('../internals/global');\nvar fails = require('../internals/fails');\nvar bind = require('../internals/function-bind-context');\nvar html = require('../internals/html');\nvar createElement = require('../internals/document-create-element');\nvar IS_IOS = require('../internals/engine-is-ios');\nvar IS_NODE = require('../internals/engine-is-node');\n\nvar location = global.location;\nvar set = global.setImmediate;\nvar clear = global.clearImmediate;\nvar process = global.process;\nvar MessageChannel = global.MessageChannel;\nvar Dispatch = global.Dispatch;\nvar counter = 0;\nvar queue = {};\nvar ONREADYSTATECHANGE = 'onreadystatechange';\nvar defer, channel, port;\n\nvar run = function (id) {\n  // eslint-disable-next-line no-prototype-builtins\n  if (queue.hasOwnProperty(id)) {\n    var fn = queue[id];\n    delete queue[id];\n    fn();\n  }\n};\n\nvar runner = function (id) {\n  return function () {\n    run(id);\n  };\n};\n\nvar listener = function (event) {\n  run(event.data);\n};\n\nvar post = function (id) {\n  // old engines have not location.origin\n  global.postMessage(id + '', location.protocol + '//' + location.host);\n};\n\n// Node.js 0.9+ & IE10+ has setImmediate, otherwise:\nif (!set || !clear) {\n  set = function setImmediate(fn) {\n    var args = [];\n    var i = 1;\n    while (arguments.length > i) args.push(arguments[i++]);\n    queue[++counter] = function () {\n      // eslint-disable-next-line no-new-func\n      (typeof fn == 'function' ? fn : Function(fn)).apply(undefined, args);\n    };\n    defer(counter);\n    return counter;\n  };\n  clear = function clearImmediate(id) {\n    delete queue[id];\n  };\n  // Node.js 0.8-\n  if (IS_NODE) {\n    defer = function (id) {\n      process.nextTick(runner(id));\n    };\n  // Sphere (JS game engine) Dispatch API\n  } else if (Dispatch && Dispatch.now) {\n    defer = function (id) {\n      Dispatch.now(runner(id));\n    };\n  // Browsers with MessageChannel, includes WebWorkers\n  // except iOS - https://github.com/zloirock/core-js/issues/624\n  } else if (MessageChannel && !IS_IOS) {\n    channel = new MessageChannel();\n    port = channel.port2;\n    channel.port1.onmessage = listener;\n    defer = bind(port.postMessage, port, 1);\n  // Browsers with postMessage, skip WebWorkers\n  // IE8 has postMessage, but it's sync & typeof its postMessage is 'object'\n  } else if (\n    global.addEventListener &&\n    typeof postMessage == 'function' &&\n    !global.importScripts &&\n    location && location.protocol !== 'file:' &&\n    !fails(post)\n  ) {\n    defer = post;\n    global.addEventListener('message', listener, false);\n  // IE8-\n  } else if (ONREADYSTATECHANGE in createElement('script')) {\n    defer = function (id) {\n      html.appendChild(createElement('script'))[ONREADYSTATECHANGE] = function () {\n        html.removeChild(this);\n        run(id);\n      };\n    };\n  // Rest old browsers\n  } else {\n    defer = function (id) {\n      setTimeout(runner(id), 0);\n    };\n  }\n}\n\nmodule.exports = {\n  set: set,\n  clear: clear\n};\n","'use strict';\nvar $ = require('../internals/export');\nvar forEach = require('../internals/array-for-each');\n\n// `Array.prototype.forEach` method\n// https://tc39.github.io/ecma262/#sec-array.prototype.foreach\n$({ target: 'Array', proto: true, forced: [].forEach != forEach }, {\n  forEach: forEach\n});\n","var $ = require('../internals/export');\nvar lastIndexOf = require('../internals/array-last-index-of');\n\n// `Array.prototype.lastIndexOf` method\n// https://tc39.github.io/ecma262/#sec-array.prototype.lastindexof\n$({ target: 'Array', proto: true, forced: lastIndexOf !== [].lastIndexOf }, {\n  lastIndexOf: lastIndexOf\n});\n","'use strict';\nvar $ = require('../internals/export');\nvar $some = require('../internals/array-iteration').some;\nvar arrayMethodIsStrict = require('../internals/array-method-is-strict');\nvar arrayMethodUsesToLength = require('../internals/array-method-uses-to-length');\n\nvar STRICT_METHOD = arrayMethodIsStrict('some');\nvar USES_TO_LENGTH = arrayMethodUsesToLength('some');\n\n// `Array.prototype.some` method\n// https://tc39.github.io/ecma262/#sec-array.prototype.some\n$({ target: 'Array', proto: true, forced: !STRICT_METHOD || !USES_TO_LENGTH }, {\n  some: function some(callbackfn /* , thisArg */) {\n    return $some(this, callbackfn, arguments.length > 1 ? arguments[1] : undefined);\n  }\n});\n","'use strict';\nvar $ = require('../internals/export');\nvar IS_PURE = require('../internals/is-pure');\nvar global = require('../internals/global');\nvar getBuiltIn = require('../internals/get-built-in');\nvar NativePromise = require('../internals/native-promise-constructor');\nvar redefine = require('../internals/redefine');\nvar redefineAll = require('../internals/redefine-all');\nvar setToStringTag = require('../internals/set-to-string-tag');\nvar setSpecies = require('../internals/set-species');\nvar isObject = require('../internals/is-object');\nvar aFunction = require('../internals/a-function');\nvar anInstance = require('../internals/an-instance');\nvar inspectSource = require('../internals/inspect-source');\nvar iterate = require('../internals/iterate');\nvar checkCorrectnessOfIteration = require('../internals/check-correctness-of-iteration');\nvar speciesConstructor = require('../internals/species-constructor');\nvar task = require('../internals/task').set;\nvar microtask = require('../internals/microtask');\nvar promiseResolve = require('../internals/promise-resolve');\nvar hostReportErrors = require('../internals/host-report-errors');\nvar newPromiseCapabilityModule = require('../internals/new-promise-capability');\nvar perform = require('../internals/perform');\nvar InternalStateModule = require('../internals/internal-state');\nvar isForced = require('../internals/is-forced');\nvar wellKnownSymbol = require('../internals/well-known-symbol');\nvar IS_NODE = require('../internals/engine-is-node');\nvar V8_VERSION = require('../internals/engine-v8-version');\n\nvar SPECIES = wellKnownSymbol('species');\nvar PROMISE = 'Promise';\nvar getInternalState = InternalStateModule.get;\nvar setInternalState = InternalStateModule.set;\nvar getInternalPromiseState = InternalStateModule.getterFor(PROMISE);\nvar PromiseConstructor = NativePromise;\nvar TypeError = global.TypeError;\nvar document = global.document;\nvar process = global.process;\nvar $fetch = getBuiltIn('fetch');\nvar newPromiseCapability = newPromiseCapabilityModule.f;\nvar newGenericPromiseCapability = newPromiseCapability;\nvar DISPATCH_EVENT = !!(document && document.createEvent && global.dispatchEvent);\nvar NATIVE_REJECTION_EVENT = typeof PromiseRejectionEvent == 'function';\nvar UNHANDLED_REJECTION = 'unhandledrejection';\nvar REJECTION_HANDLED = 'rejectionhandled';\nvar PENDING = 0;\nvar FULFILLED = 1;\nvar REJECTED = 2;\nvar HANDLED = 1;\nvar UNHANDLED = 2;\nvar Internal, OwnPromiseCapability, PromiseWrapper, nativeThen;\n\nvar FORCED = isForced(PROMISE, function () {\n  var GLOBAL_CORE_JS_PROMISE = inspectSource(PromiseConstructor) !== String(PromiseConstructor);\n  if (!GLOBAL_CORE_JS_PROMISE) {\n    // V8 6.6 (Node 10 and Chrome 66) have a bug with resolving custom thenables\n    // https://bugs.chromium.org/p/chromium/issues/detail?id=830565\n    // We can't detect it synchronously, so just check versions\n    if (V8_VERSION === 66) return true;\n    // Unhandled rejections tracking support, NodeJS Promise without it fails @@species test\n    if (!IS_NODE && !NATIVE_REJECTION_EVENT) return true;\n  }\n  // We need Promise#finally in the pure version for preventing prototype pollution\n  if (IS_PURE && !PromiseConstructor.prototype['finally']) return true;\n  // We can't use @@species feature detection in V8 since it causes\n  // deoptimization and performance degradation\n  // https://github.com/zloirock/core-js/issues/679\n  if (V8_VERSION >= 51 && /native code/.test(PromiseConstructor)) return false;\n  // Detect correctness of subclassing with @@species support\n  var promise = PromiseConstructor.resolve(1);\n  var FakePromise = function (exec) {\n    exec(function () { /* empty */ }, function () { /* empty */ });\n  };\n  var constructor = promise.constructor = {};\n  constructor[SPECIES] = FakePromise;\n  return !(promise.then(function () { /* empty */ }) instanceof FakePromise);\n});\n\nvar INCORRECT_ITERATION = FORCED || !checkCorrectnessOfIteration(function (iterable) {\n  PromiseConstructor.all(iterable)['catch'](function () { /* empty */ });\n});\n\n// helpers\nvar isThenable = function (it) {\n  var then;\n  return isObject(it) && typeof (then = it.then) == 'function' ? then : false;\n};\n\nvar notify = function (state, isReject) {\n  if (state.notified) return;\n  state.notified = true;\n  var chain = state.reactions;\n  microtask(function () {\n    var value = state.value;\n    var ok = state.state == FULFILLED;\n    var index = 0;\n    // variable length - can't use forEach\n    while (chain.length > index) {\n      var reaction = chain[index++];\n      var handler = ok ? reaction.ok : reaction.fail;\n      var resolve = reaction.resolve;\n      var reject = reaction.reject;\n      var domain = reaction.domain;\n      var result, then, exited;\n      try {\n        if (handler) {\n          if (!ok) {\n            if (state.rejection === UNHANDLED) onHandleUnhandled(state);\n            state.rejection = HANDLED;\n          }\n          if (handler === true) result = value;\n          else {\n            if (domain) domain.enter();\n            result = handler(value); // can throw\n            if (domain) {\n              domain.exit();\n              exited = true;\n            }\n          }\n          if (result === reaction.promise) {\n            reject(TypeError('Promise-chain cycle'));\n          } else if (then = isThenable(result)) {\n            then.call(result, resolve, reject);\n          } else resolve(result);\n        } else reject(value);\n      } catch (error) {\n        if (domain && !exited) domain.exit();\n        reject(error);\n      }\n    }\n    state.reactions = [];\n    state.notified = false;\n    if (isReject && !state.rejection) onUnhandled(state);\n  });\n};\n\nvar dispatchEvent = function (name, promise, reason) {\n  var event, handler;\n  if (DISPATCH_EVENT) {\n    event = document.createEvent('Event');\n    event.promise = promise;\n    event.reason = reason;\n    event.initEvent(name, false, true);\n    global.dispatchEvent(event);\n  } else event = { promise: promise, reason: reason };\n  if (!NATIVE_REJECTION_EVENT && (handler = global['on' + name])) handler(event);\n  else if (name === UNHANDLED_REJECTION) hostReportErrors('Unhandled promise rejection', reason);\n};\n\nvar onUnhandled = function (state) {\n  task.call(global, function () {\n    var promise = state.facade;\n    var value = state.value;\n    var IS_UNHANDLED = isUnhandled(state);\n    var result;\n    if (IS_UNHANDLED) {\n      result = perform(function () {\n        if (IS_NODE) {\n          process.emit('unhandledRejection', value, promise);\n        } else dispatchEvent(UNHANDLED_REJECTION, promise, value);\n      });\n      // Browsers should not trigger `rejectionHandled` event if it was handled here, NodeJS - should\n      state.rejection = IS_NODE || isUnhandled(state) ? UNHANDLED : HANDLED;\n      if (result.error) throw result.value;\n    }\n  });\n};\n\nvar isUnhandled = function (state) {\n  return state.rejection !== HANDLED && !state.parent;\n};\n\nvar onHandleUnhandled = function (state) {\n  task.call(global, function () {\n    var promise = state.facade;\n    if (IS_NODE) {\n      process.emit('rejectionHandled', promise);\n    } else dispatchEvent(REJECTION_HANDLED, promise, state.value);\n  });\n};\n\nvar bind = function (fn, state, unwrap) {\n  return function (value) {\n    fn(state, value, unwrap);\n  };\n};\n\nvar internalReject = function (state, value, unwrap) {\n  if (state.done) return;\n  state.done = true;\n  if (unwrap) state = unwrap;\n  state.value = value;\n  state.state = REJECTED;\n  notify(state, true);\n};\n\nvar internalResolve = function (state, value, unwrap) {\n  if (state.done) return;\n  state.done = true;\n  if (unwrap) state = unwrap;\n  try {\n    if (state.facade === value) throw TypeError(\"Promise can't be resolved itself\");\n    var then = isThenable(value);\n    if (then) {\n      microtask(function () {\n        var wrapper = { done: false };\n        try {\n          then.call(value,\n            bind(internalResolve, wrapper, state),\n            bind(internalReject, wrapper, state)\n          );\n        } catch (error) {\n          internalReject(wrapper, error, state);\n        }\n      });\n    } else {\n      state.value = value;\n      state.state = FULFILLED;\n      notify(state, false);\n    }\n  } catch (error) {\n    internalReject({ done: false }, error, state);\n  }\n};\n\n// constructor polyfill\nif (FORCED) {\n  // 25.4.3.1 Promise(executor)\n  PromiseConstructor = function Promise(executor) {\n    anInstance(this, PromiseConstructor, PROMISE);\n    aFunction(executor);\n    Internal.call(this);\n    var state = getInternalState(this);\n    try {\n      executor(bind(internalResolve, state), bind(internalReject, state));\n    } catch (error) {\n      internalReject(state, error);\n    }\n  };\n  // eslint-disable-next-line no-unused-vars\n  Internal = function Promise(executor) {\n    setInternalState(this, {\n      type: PROMISE,\n      done: false,\n      notified: false,\n      parent: false,\n      reactions: [],\n      rejection: false,\n      state: PENDING,\n      value: undefined\n    });\n  };\n  Internal.prototype = redefineAll(PromiseConstructor.prototype, {\n    // `Promise.prototype.then` method\n    // https://tc39.github.io/ecma262/#sec-promise.prototype.then\n    then: function then(onFulfilled, onRejected) {\n      var state = getInternalPromiseState(this);\n      var reaction = newPromiseCapability(speciesConstructor(this, PromiseConstructor));\n      reaction.ok = typeof onFulfilled == 'function' ? onFulfilled : true;\n      reaction.fail = typeof onRejected == 'function' && onRejected;\n      reaction.domain = IS_NODE ? process.domain : undefined;\n      state.parent = true;\n      state.reactions.push(reaction);\n      if (state.state != PENDING) notify(state, false);\n      return reaction.promise;\n    },\n    // `Promise.prototype.catch` method\n    // https://tc39.github.io/ecma262/#sec-promise.prototype.catch\n    'catch': function (onRejected) {\n      return this.then(undefined, onRejected);\n    }\n  });\n  OwnPromiseCapability = function () {\n    var promise = new Internal();\n    var state = getInternalState(promise);\n    this.promise = promise;\n    this.resolve = bind(internalResolve, state);\n    this.reject = bind(internalReject, state);\n  };\n  newPromiseCapabilityModule.f = newPromiseCapability = function (C) {\n    return C === PromiseConstructor || C === PromiseWrapper\n      ? new OwnPromiseCapability(C)\n      : newGenericPromiseCapability(C);\n  };\n\n  if (!IS_PURE && typeof NativePromise == 'function') {\n    nativeThen = NativePromise.prototype.then;\n\n    // wrap native Promise#then for native async functions\n    redefine(NativePromise.prototype, 'then', function then(onFulfilled, onRejected) {\n      var that = this;\n      return new PromiseConstructor(function (resolve, reject) {\n        nativeThen.call(that, resolve, reject);\n      }).then(onFulfilled, onRejected);\n    // https://github.com/zloirock/core-js/issues/640\n    }, { unsafe: true });\n\n    // wrap fetch result\n    if (typeof $fetch == 'function') $({ global: true, enumerable: true, forced: true }, {\n      // eslint-disable-next-line no-unused-vars\n      fetch: function fetch(input /* , init */) {\n        return promiseResolve(PromiseConstructor, $fetch.apply(global, arguments));\n      }\n    });\n  }\n}\n\n$({ global: true, wrap: true, forced: FORCED }, {\n  Promise: PromiseConstructor\n});\n\nsetToStringTag(PromiseConstructor, PROMISE, false, true);\nsetSpecies(PROMISE);\n\nPromiseWrapper = getBuiltIn(PROMISE);\n\n// statics\n$({ target: PROMISE, stat: true, forced: FORCED }, {\n  // `Promise.reject` method\n  // https://tc39.github.io/ecma262/#sec-promise.reject\n  reject: function reject(r) {\n    var capability = newPromiseCapability(this);\n    capability.reject.call(undefined, r);\n    return capability.promise;\n  }\n});\n\n$({ target: PROMISE, stat: true, forced: IS_PURE || FORCED }, {\n  // `Promise.resolve` method\n  // https://tc39.github.io/ecma262/#sec-promise.resolve\n  resolve: function resolve(x) {\n    return promiseResolve(IS_PURE && this === PromiseWrapper ? PromiseConstructor : this, x);\n  }\n});\n\n$({ target: PROMISE, stat: true, forced: INCORRECT_ITERATION }, {\n  // `Promise.all` method\n  // https://tc39.github.io/ecma262/#sec-promise.all\n  all: function all(iterable) {\n    var C = this;\n    var capability = newPromiseCapability(C);\n    var resolve = capability.resolve;\n    var reject = capability.reject;\n    var result = perform(function () {\n      var $promiseResolve = aFunction(C.resolve);\n      var values = [];\n      var counter = 0;\n      var remaining = 1;\n      iterate(iterable, function (promise) {\n        var index = counter++;\n        var alreadyCalled = false;\n        values.push(undefined);\n        remaining++;\n        $promiseResolve.call(C, promise).then(function (value) {\n          if (alreadyCalled) return;\n          alreadyCalled = true;\n          values[index] = value;\n          --remaining || resolve(values);\n        }, reject);\n      });\n      --remaining || resolve(values);\n    });\n    if (result.error) reject(result.value);\n    return capability.promise;\n  },\n  // `Promise.race` method\n  // https://tc39.github.io/ecma262/#sec-promise.race\n  race: function race(iterable) {\n    var C = this;\n    var capability = newPromiseCapability(C);\n    var reject = capability.reject;\n    var result = perform(function () {\n      var $promiseResolve = aFunction(C.resolve);\n      iterate(iterable, function (promise) {\n        $promiseResolve.call(C, promise).then(capability.resolve, reject);\n      });\n    });\n    if (result.error) reject(result.value);\n    return capability.promise;\n  }\n});\n","var DESCRIPTORS = require('../internals/descriptors');\nvar global = require('../internals/global');\nvar isForced = require('../internals/is-forced');\nvar inheritIfRequired = require('../internals/inherit-if-required');\nvar defineProperty = require('../internals/object-define-property').f;\nvar getOwnPropertyNames = require('../internals/object-get-own-property-names').f;\nvar isRegExp = require('../internals/is-regexp');\nvar getFlags = require('../internals/regexp-flags');\nvar stickyHelpers = require('../internals/regexp-sticky-helpers');\nvar redefine = require('../internals/redefine');\nvar fails = require('../internals/fails');\nvar setInternalState = require('../internals/internal-state').set;\nvar setSpecies = require('../internals/set-species');\nvar wellKnownSymbol = require('../internals/well-known-symbol');\n\nvar MATCH = wellKnownSymbol('match');\nvar NativeRegExp = global.RegExp;\nvar RegExpPrototype = NativeRegExp.prototype;\nvar re1 = /a/g;\nvar re2 = /a/g;\n\n// \"new\" should create a new object, old webkit bug\nvar CORRECT_NEW = new NativeRegExp(re1) !== re1;\n\nvar UNSUPPORTED_Y = stickyHelpers.UNSUPPORTED_Y;\n\nvar FORCED = DESCRIPTORS && isForced('RegExp', (!CORRECT_NEW || UNSUPPORTED_Y || fails(function () {\n  re2[MATCH] = false;\n  // RegExp constructor can alter flags and IsRegExp works correct with @@match\n  return NativeRegExp(re1) != re1 || NativeRegExp(re2) == re2 || NativeRegExp(re1, 'i') != '/a/i';\n})));\n\n// `RegExp` constructor\n// https://tc39.github.io/ecma262/#sec-regexp-constructor\nif (FORCED) {\n  var RegExpWrapper = function RegExp(pattern, flags) {\n    var thisIsRegExp = this instanceof RegExpWrapper;\n    var patternIsRegExp = isRegExp(pattern);\n    var flagsAreUndefined = flags === undefined;\n    var sticky;\n\n    if (!thisIsRegExp && patternIsRegExp && pattern.constructor === RegExpWrapper && flagsAreUndefined) {\n      return pattern;\n    }\n\n    if (CORRECT_NEW) {\n      if (patternIsRegExp && !flagsAreUndefined) pattern = pattern.source;\n    } else if (pattern instanceof RegExpWrapper) {\n      if (flagsAreUndefined) flags = getFlags.call(pattern);\n      pattern = pattern.source;\n    }\n\n    if (UNSUPPORTED_Y) {\n      sticky = !!flags && flags.indexOf('y') > -1;\n      if (sticky) flags = flags.replace(/y/g, '');\n    }\n\n    var result = inheritIfRequired(\n      CORRECT_NEW ? new NativeRegExp(pattern, flags) : NativeRegExp(pattern, flags),\n      thisIsRegExp ? this : RegExpPrototype,\n      RegExpWrapper\n    );\n\n    if (UNSUPPORTED_Y && sticky) setInternalState(result, { sticky: sticky });\n\n    return result;\n  };\n  var proxy = function (key) {\n    key in RegExpWrapper || defineProperty(RegExpWrapper, key, {\n      configurable: true,\n      get: function () { return NativeRegExp[key]; },\n      set: function (it) { NativeRegExp[key] = it; }\n    });\n  };\n  var keys = getOwnPropertyNames(NativeRegExp);\n  var index = 0;\n  while (keys.length > index) proxy(keys[index++]);\n  RegExpPrototype.constructor = RegExpWrapper;\n  RegExpWrapper.prototype = RegExpPrototype;\n  redefine(global, 'RegExp', RegExpWrapper);\n}\n\n// https://tc39.github.io/ecma262/#sec-get-regexp-@@species\nsetSpecies('RegExp');\n","var global = require('../internals/global');\nvar DOMIterables = require('../internals/dom-iterables');\nvar forEach = require('../internals/array-for-each');\nvar createNonEnumerableProperty = require('../internals/create-non-enumerable-property');\n\nfor (var COLLECTION_NAME in DOMIterables) {\n  var Collection = global[COLLECTION_NAME];\n  var CollectionPrototype = Collection && Collection.prototype;\n  // some Chrome versions have non-configurable methods on DOMTokenList\n  if (CollectionPrototype && CollectionPrototype.forEach !== forEach) try {\n    createNonEnumerableProperty(CollectionPrototype, 'forEach', forEach);\n  } catch (error) {\n    CollectionPrototype.forEach = forEach;\n  }\n}\n"],"sourceRoot":""}