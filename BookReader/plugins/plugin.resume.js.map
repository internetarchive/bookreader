{"version":3,"sources":["webpack://@internetarchive/bookreader/./src/js/plugins/plugin.resume.js","webpack://@internetarchive/bookreader/./src/util/docCookies.js","webpack://@internetarchive/bookreader/./node_modules/core-js/internals/inherit-if-required.js","webpack://@internetarchive/bookreader/./node_modules/core-js/internals/set-species.js","webpack://@internetarchive/bookreader/./node_modules/core-js/modules/es.regexp.constructor.js","webpack://@internetarchive/bookreader/./node_modules/core-js/modules/es.string.match.js"],"names":["super_","getItem","sKey","decodeURIComponent","document","cookie","replace","RegExp","encodeURIComponent","setItem","sValue","vEnd","sPath","sDomain","bSecure","toUTCString","removeItem","hasItem","BookReader","docCookies","jQuery","extend","defaultOptions","enablePageResume","resumeCookiePath","prototype","init","call","this","options","bind","eventNames","fragmentChange","params","paramsFromCurrent","updateResumeValue","index","getResumeValue","val","parseInt","getCookiePath","urlPathPart","match","cookieName","ttl","Date","path","window","location","pathname","isObject","setPrototypeOf","module","exports","$this","dummy","Wrapper","NewTarget","NewTargetPrototype","constructor","getBuiltIn","definePropertyModule","wellKnownSymbol","DESCRIPTORS","SPECIES","CONSTRUCTOR_NAME","Constructor","defineProperty","f","configurable","get","global","isForced","inheritIfRequired","getOwnPropertyNames","isRegExp","getFlags","stickyHelpers","redefine","fails","setInternalState","setSpecies","MATCH","NativeRegExp","RegExpPrototype","re1","re2","CORRECT_NEW","UNSUPPORTED_Y","RegExpWrapper","pattern","flags","sticky","thisIsRegExp","patternIsRegExp","flagsAreUndefined","undefined","source","indexOf","result","proxy","key","set","it","keys","length","fixRegExpWellKnownSymbolLogic","anObject","toLength","requireObjectCoercible","advanceStringIndex","regExpExec","nativeMatch","maybeCallNative","regexp","O","matcher","String","res","done","value","rx","S","fullUnicode","unicode","lastIndex","A","n","matchStr"],"mappings":"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","file":"plugins/plugin.resume.js","sourcesContent":["import * as docCookies from '../../util/docCookies.js';\r\n\r\n/* global BookReader */\r\n\r\n/** @deprecated Exposed for backward compatibility */\r\nBookReader.docCookies = docCookies;\r\n\r\n/**\r\n * Plugin to remember the current page number in a cookie\r\n */\r\njQuery.extend(BookReader.defaultOptions, {\r\n  enablePageResume: true,\r\n  /** @type {string|null} eg '/', '/details/id' */\r\n  resumeCookiePath: null,\r\n});\r\n\r\n/** @override */\r\nBookReader.prototype.init = (function(super_) {\r\n  return function() {\r\n    super_.call(this);\r\n    if (this.options.enablePageResume) {\r\n      this.bind(BookReader.eventNames.fragmentChange, () => {\r\n        const params = this.paramsFromCurrent();\r\n        this.updateResumeValue(params.index);\r\n      });\r\n    }\r\n  };\r\n})(BookReader.prototype.init);\r\n\r\n/**\r\n * Gets page resume value, for remembering reader's page\r\n * Can be overriden for different implementation\r\n *\r\n * @return {number|null}\r\n */\r\nBookReader.prototype.getResumeValue = function() {\r\n  const val = BookReader.docCookies.getItem('br-resume');\r\n  if (val !== null) return parseInt(val);\r\n  else return null;\r\n}\r\n\r\n/**\r\n * Return cookie path using pathname up to /page/... or /mode/...\r\n * using window.location.pathname for urlPathPart:\r\n * - matches encoding\r\n * - ignores querystring part\r\n * - ignores fragment part (after #)\r\n * @param {string} urlPathPart - window.location.pathname\r\n */\r\nBookReader.prototype.getCookiePath = function(urlPathPart) {\r\n  return urlPathPart.match('.+?(?=/page/|/mode/|$)')[0];\r\n}\r\n\r\n/**\r\n * Sets page resume value, for remembering reader's page\r\n * Can be overriden for different implementation\r\n *\r\n * @param {Number} index leaf index\r\n * @param {string} [cookieName]\r\n */\r\nBookReader.prototype.updateResumeValue = function(index, cookieName) {\r\n  const ttl = new Date(+new Date + 12096e5); // 2 weeks\r\n  // For multiple files in item, leave resumeCookiePath blank\r\n  // It's likely we can remove resumeCookiePath using getCookiePath()\r\n  const path = this.options.resumeCookiePath\r\n    || this.getCookiePath(window.location.pathname);\r\n  BookReader.docCookies.setItem(cookieName || 'br-resume', index, ttl, path, null, false);\r\n}\r\n","/**\r\n * Helper module use to get, set and remove item from cookie\r\n *\r\n * See more:\r\n *  https://developer.mozilla.org/en-US/docs/Web/API/document.cookie\r\n *  https://developer.mozilla.org/User:fusionchess\r\n *  https://github.com/madmurphy/cookies.js\r\n *  This framework is released under the GNU Public License, version 3 or later.\r\n *  http://www.gnu.org/licenses/gpl-3.0-standalone.html\r\n */\r\n\r\n/**\r\n * Get specific key's value stored in cookie\r\n *\r\n * @param {string} sKey\r\n *\r\n * @returns {string|null}\r\n */\r\nexport function getItem(sKey) {\r\n  if (!sKey) return null;\r\n\r\n  return decodeURIComponent(\r\n    // eslint-disable-next-line no-useless-escape\r\n    document.cookie.replace(new RegExp('(?:(?:^|.*;)\\\\s*' + encodeURIComponent(sKey).replace(/[\\-\\.\\+\\*]/g, '\\\\$&') + '\\\\s*\\\\=\\\\s*([^;]*).*$)|^.*$'), '$1')) || null;\r\n}\r\n\r\n/**\r\n * Set specific key's value in cookie\r\n *\r\n * @param {string} sKey cookie name\r\n * @param {string} sValue cookie value\r\n * @param {string} [vEnd] expire|max-age\r\n * @param {string} [sPath] path of current item\r\n * @param {string} [sDomain] domain name\r\n * @param {boolean} [bSecure]\r\n *\r\n * @returns {true}\r\n */\r\nexport function setItem(sKey, sValue, vEnd, sPath, sDomain, bSecure) {\r\n  document.cookie = encodeURIComponent(sKey) + '=' + encodeURIComponent(sValue) \r\n  + (vEnd ? `; expires=${vEnd.toUTCString()}` : '')\r\n  + (sDomain ? `; domain=${sDomain}`: '')\r\n  + (sPath ? `; path=${sPath}` : '')\r\n  + (bSecure ? `; secure` : '');\r\n\r\n  return true;\r\n}\r\n\r\n/**\r\n * BROKEN Remove specific key's value from cookie\r\n * @fixme hasItem isn't even implemented! This will always error.\r\n * @param {string} sKey cookie name\r\n * @param {string} [sPath] path of current item\r\n * @param {string} [sDomain]\r\n *\r\n * @returns {boolean}\r\n */\r\nexport function removeItem(sKey, sPath, sDomain) {\r\n  if (!hasItem(sKey)) return false;\r\n\r\n  document.cookie = encodeURIComponent(sKey) + `=; expires=Thu, 01 Jan 1970 00:00:00 GMT`\r\n  + (sDomain ? `; domain=${sDomain}` : '')\r\n  + (sPath ? `; path=${sPath}` : '');\r\n\r\n  return true;\r\n}\r\n","var isObject = require('../internals/is-object');\nvar setPrototypeOf = require('../internals/object-set-prototype-of');\n\n// makes subclassing work correct for wrapped built-ins\nmodule.exports = function ($this, dummy, Wrapper) {\n  var NewTarget, NewTargetPrototype;\n  if (\n    // it can work only with native `setPrototypeOf`\n    setPrototypeOf &&\n    // we haven't completely correct pre-ES6 way for getting `new.target`, so use this\n    typeof (NewTarget = dummy.constructor) == 'function' &&\n    NewTarget !== Wrapper &&\n    isObject(NewTargetPrototype = NewTarget.prototype) &&\n    NewTargetPrototype !== Wrapper.prototype\n  ) setPrototypeOf($this, NewTargetPrototype);\n  return $this;\n};\n","'use strict';\nvar getBuiltIn = require('../internals/get-built-in');\nvar definePropertyModule = require('../internals/object-define-property');\nvar wellKnownSymbol = require('../internals/well-known-symbol');\nvar DESCRIPTORS = require('../internals/descriptors');\n\nvar SPECIES = wellKnownSymbol('species');\n\nmodule.exports = function (CONSTRUCTOR_NAME) {\n  var Constructor = getBuiltIn(CONSTRUCTOR_NAME);\n  var defineProperty = definePropertyModule.f;\n\n  if (DESCRIPTORS && Constructor && !Constructor[SPECIES]) {\n    defineProperty(Constructor, SPECIES, {\n      configurable: true,\n      get: function () { return this; }\n    });\n  }\n};\n","var DESCRIPTORS = require('../internals/descriptors');\nvar global = require('../internals/global');\nvar isForced = require('../internals/is-forced');\nvar inheritIfRequired = require('../internals/inherit-if-required');\nvar defineProperty = require('../internals/object-define-property').f;\nvar getOwnPropertyNames = require('../internals/object-get-own-property-names').f;\nvar isRegExp = require('../internals/is-regexp');\nvar getFlags = require('../internals/regexp-flags');\nvar stickyHelpers = require('../internals/regexp-sticky-helpers');\nvar redefine = require('../internals/redefine');\nvar fails = require('../internals/fails');\nvar setInternalState = require('../internals/internal-state').set;\nvar setSpecies = require('../internals/set-species');\nvar wellKnownSymbol = require('../internals/well-known-symbol');\n\nvar MATCH = wellKnownSymbol('match');\nvar NativeRegExp = global.RegExp;\nvar RegExpPrototype = NativeRegExp.prototype;\nvar re1 = /a/g;\nvar re2 = /a/g;\n\n// \"new\" should create a new object, old webkit bug\nvar CORRECT_NEW = new NativeRegExp(re1) !== re1;\n\nvar UNSUPPORTED_Y = stickyHelpers.UNSUPPORTED_Y;\n\nvar FORCED = DESCRIPTORS && isForced('RegExp', (!CORRECT_NEW || UNSUPPORTED_Y || fails(function () {\n  re2[MATCH] = false;\n  // RegExp constructor can alter flags and IsRegExp works correct with @@match\n  return NativeRegExp(re1) != re1 || NativeRegExp(re2) == re2 || NativeRegExp(re1, 'i') != '/a/i';\n})));\n\n// `RegExp` constructor\n// https://tc39.github.io/ecma262/#sec-regexp-constructor\nif (FORCED) {\n  var RegExpWrapper = function RegExp(pattern, flags) {\n    var thisIsRegExp = this instanceof RegExpWrapper;\n    var patternIsRegExp = isRegExp(pattern);\n    var flagsAreUndefined = flags === undefined;\n    var sticky;\n\n    if (!thisIsRegExp && patternIsRegExp && pattern.constructor === RegExpWrapper && flagsAreUndefined) {\n      return pattern;\n    }\n\n    if (CORRECT_NEW) {\n      if (patternIsRegExp && !flagsAreUndefined) pattern = pattern.source;\n    } else if (pattern instanceof RegExpWrapper) {\n      if (flagsAreUndefined) flags = getFlags.call(pattern);\n      pattern = pattern.source;\n    }\n\n    if (UNSUPPORTED_Y) {\n      sticky = !!flags && flags.indexOf('y') > -1;\n      if (sticky) flags = flags.replace(/y/g, '');\n    }\n\n    var result = inheritIfRequired(\n      CORRECT_NEW ? new NativeRegExp(pattern, flags) : NativeRegExp(pattern, flags),\n      thisIsRegExp ? this : RegExpPrototype,\n      RegExpWrapper\n    );\n\n    if (UNSUPPORTED_Y && sticky) setInternalState(result, { sticky: sticky });\n\n    return result;\n  };\n  var proxy = function (key) {\n    key in RegExpWrapper || defineProperty(RegExpWrapper, key, {\n      configurable: true,\n      get: function () { return NativeRegExp[key]; },\n      set: function (it) { NativeRegExp[key] = it; }\n    });\n  };\n  var keys = getOwnPropertyNames(NativeRegExp);\n  var index = 0;\n  while (keys.length > index) proxy(keys[index++]);\n  RegExpPrototype.constructor = RegExpWrapper;\n  RegExpWrapper.prototype = RegExpPrototype;\n  redefine(global, 'RegExp', RegExpWrapper);\n}\n\n// https://tc39.github.io/ecma262/#sec-get-regexp-@@species\nsetSpecies('RegExp');\n","'use strict';\nvar fixRegExpWellKnownSymbolLogic = require('../internals/fix-regexp-well-known-symbol-logic');\nvar anObject = require('../internals/an-object');\nvar toLength = require('../internals/to-length');\nvar requireObjectCoercible = require('../internals/require-object-coercible');\nvar advanceStringIndex = require('../internals/advance-string-index');\nvar regExpExec = require('../internals/regexp-exec-abstract');\n\n// @@match logic\nfixRegExpWellKnownSymbolLogic('match', 1, function (MATCH, nativeMatch, maybeCallNative) {\n  return [\n    // `String.prototype.match` method\n    // https://tc39.github.io/ecma262/#sec-string.prototype.match\n    function match(regexp) {\n      var O = requireObjectCoercible(this);\n      var matcher = regexp == undefined ? undefined : regexp[MATCH];\n      return matcher !== undefined ? matcher.call(regexp, O) : new RegExp(regexp)[MATCH](String(O));\n    },\n    // `RegExp.prototype[@@match]` method\n    // https://tc39.github.io/ecma262/#sec-regexp.prototype-@@match\n    function (regexp) {\n      var res = maybeCallNative(nativeMatch, regexp, this);\n      if (res.done) return res.value;\n\n      var rx = anObject(regexp);\n      var S = String(this);\n\n      if (!rx.global) return regExpExec(rx, S);\n\n      var fullUnicode = rx.unicode;\n      rx.lastIndex = 0;\n      var A = [];\n      var n = 0;\n      var result;\n      while ((result = regExpExec(rx, S)) !== null) {\n        var matchStr = String(result[0]);\n        A[n] = matchStr;\n        if (matchStr === '') rx.lastIndex = advanceStringIndex(S, toLength(rx.lastIndex), fullUnicode);\n        n++;\n      }\n      return n === 0 ? null : A;\n    }\n  ];\n});\n"],"sourceRoot":""}