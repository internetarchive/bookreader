{"version":3,"sources":["webpack://@internetarchive/bookreader/./src/js/plugins/plugin.text_selection.js","webpack://@internetarchive/bookreader/./src/util/browserSniffing.js","webpack://@internetarchive/bookreader/./node_modules/core-js/internals/engine-is-ios.js","webpack://@internetarchive/bookreader/./node_modules/core-js/internals/function-bind.js","webpack://@internetarchive/bookreader/./node_modules/core-js/internals/host-report-errors.js","webpack://@internetarchive/bookreader/./node_modules/core-js/internals/iterate.js","webpack://@internetarchive/bookreader/./node_modules/core-js/internals/microtask.js","webpack://@internetarchive/bookreader/./node_modules/core-js/internals/native-promise-constructor.js","webpack://@internetarchive/bookreader/./node_modules/core-js/internals/new-promise-capability.js","webpack://@internetarchive/bookreader/./node_modules/core-js/internals/perform.js","webpack://@internetarchive/bookreader/./node_modules/core-js/internals/promise-resolve.js","webpack://@internetarchive/bookreader/./node_modules/core-js/internals/set-species.js","webpack://@internetarchive/bookreader/./node_modules/core-js/internals/task.js","webpack://@internetarchive/bookreader/./node_modules/core-js/modules/es.object.get-own-property-descriptor.js","webpack://@internetarchive/bookreader/./node_modules/core-js/modules/es.object.get-prototype-of.js","webpack://@internetarchive/bookreader/./node_modules/core-js/modules/es.promise.js","webpack://@internetarchive/bookreader/./node_modules/core-js/modules/es.reflect.construct.js","webpack://@internetarchive/bookreader/./node_modules/core-js/modules/es.reflect.get.js"],"names":["BookReader","window","TextSelectionPlugin","avoidTspans","isFirefox","pointerEventsOnParagraph","isSafari","this","djvuPagesPromise","svgParagraphElement","svgWordElement","insertNewlines","ocaid","$","ajax","type","url","dataType","error","e","then","xmlMap","find","index","XMLpagesArr","$container","addEventListener","event","selection","document","getSelection","clipboardData","setData","toString","preventDefault","svg","classList","remove","on","target","is","stopPropagation","add","one","off","textSelectingMode","removeAllRanges","defaultMode","$svg","length","each","i","s","interceptCopy","pageIndex","getPageText","XMLpage","XMLwidth","attr","XMLheight","createElementNS","setAttribute","append","css","paragraph","words","paragSvg","style","pointerEvents","wordHeightArr","currWord","split","map","parseFloat","left","bottom","right","wordHeight","push","wordTspan","textContent","appendChild","nextWord","leftNext","spaceTspan","createTextNode","sort","paragWordHeight","Math","floor","stopPageFlip","BookreaderWithTextSelection","enableTextSelection","textSelectionPlugin","init","bookId","styles","mode","constModeThumb","createTextLayer","isChrome","userAgent","navigator","vendor","test","module","exports","aFunction","isObject","slice","factories","construct","C","argsLength","args","list","Function","join","bind","that","fn","partArgs","call","arguments","boundFunction","concat","apply","prototype","global","a","b","console","anObject","isArrayIteratorMethod","toLength","getIteratorMethod","callWithSafeIterationClosing","Result","stopped","result","iterable","AS_ENTRIES","IS_ITERATOR","iterator","iterFn","next","step","TypeError","done","value","stop","flush","head","last","notify","toggle","node","promise","getOwnPropertyDescriptor","classof","macrotask","IS_IOS","MutationObserver","WebKitMutationObserver","process","Promise","IS_NODE","queueMicrotaskDescriptor","queueMicrotask","parent","domain","exit","undefined","enter","nextTick","observe","characterData","data","resolve","task","PromiseCapability","reject","$$resolve","$$reject","f","exec","newPromiseCapability","x","constructor","promiseCapability","getBuiltIn","definePropertyModule","wellKnownSymbol","DESCRIPTORS","SPECIES","CONSTRUCTOR_NAME","Constructor","defineProperty","configurable","get","defer","channel","port","fails","html","createElement","location","set","setImmediate","clear","clearImmediate","MessageChannel","Dispatch","counter","queue","run","id","hasOwnProperty","runner","listener","post","postMessage","protocol","host","now","port2","port1","onmessage","importScripts","removeChild","setTimeout","toIndexedObject","nativeGetOwnPropertyDescriptor","FAILS_ON_PRIMITIVES","stat","forced","sham","it","key","toObject","nativeGetPrototypeOf","CORRECT_PROTOTYPE_GETTER","getPrototypeOf","Internal","OwnPromiseCapability","PromiseWrapper","nativeThen","IS_PURE","NativePromise","redefine","redefineAll","setToStringTag","setSpecies","anInstance","inspectSource","iterate","checkCorrectnessOfIteration","speciesConstructor","microtask","promiseResolve","hostReportErrors","newPromiseCapabilityModule","perform","InternalStateModule","isForced","V8_VERSION","PROMISE","getInternalState","setInternalState","getInternalPromiseState","getterFor","PromiseConstructor","$fetch","newGenericPromiseCapability","DISPATCH_EVENT","createEvent","dispatchEvent","UNHANDLED_REJECTION","FORCED","String","PromiseRejectionEvent","FakePromise","INCORRECT_ITERATION","all","isThenable","state","isReject","notified","chain","reactions","ok","exited","reaction","handler","fail","rejection","onHandleUnhandled","onUnhandled","name","reason","initEvent","isUnhandled","emit","unwrap","internalReject","internalResolve","wrapper","executor","onFulfilled","onRejected","unsafe","enumerable","fetch","input","wrap","r","capability","$promiseResolve","values","remaining","alreadyCalled","race","create","nativeConstruct","NEW_TARGET_BUG","F","ARGS_BUG","Target","newTarget","$args","proto","instance","Object","has","getOwnPropertyDescriptorModule","propertyKey","descriptor","receiver"],"mappings":"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","file":"plugins/plugin.text_selection.js","sourcesContent":["//@ts-check\nimport { isFirefox, isSafari } from '../../util/browserSniffing.js';\n\nconst BookReader = /** @type {typeof import('../BookReader').default} */(window.BookReader);\n\nexport class TextSelectionPlugin {\n\n  constructor(avoidTspans = isFirefox(), pointerEventsOnParagraph = isSafari()) {\n    /**@type {PromiseLike<JQuery<HTMLElement>|undefined>} */\n    this.djvuPagesPromise = null;\n    // Using text elements insted of tspans for words because Firefox does not allow svg tspan strech.\n    // Tspans are necessary on Chrome because they prevent newline character after every word when copying\n    this.svgParagraphElement = \"text\";\n    this.svgWordElement = \"tspan\";\n    this.insertNewlines = avoidTspans\n    // Safari has a bug where `pointer-events` doesn't work on `<tspans>`. So\n    // there we will set `pointer-events: all` on the paragraph element. We don't\n    // do this everywhere, because it's a worse experience. Thanks Safari :/\n    this.pointerEventsOnParagraph = pointerEventsOnParagraph;\n    if(avoidTspans) {\n      this.svgParagraphElement = \"g\";\n      this.svgWordElement = \"text\";\n    }\n  }\n\n  /**\n   * @param {string} ocaid\n   */\n  init(ocaid) {\n    this.djvuPagesPromise = $.ajax({\n      type: \"GET\",\n      url: `https://cors.archive.org/cors/${ocaid}/${ocaid}_djvu.xml`,\n      dataType: \"xml\",\n\n      error: function (e) {\n        return undefined;\n      }\n    }).then(xmlMap  => xmlMap && $(xmlMap).find(\"OBJECT\"));\n  }\n\n  /**\n   * @param {number} index\n   * @returns {Promise<HTMLElement|undefined>}\n   */\n  async getPageText(index) {\n    const XMLpagesArr = await this.djvuPagesPromise;\n    if (XMLpagesArr) return XMLpagesArr[index];\n  }\n\n  /**\n   * Intercept copied text to remove any styling applied to it\n   * @param {JQuery} $container\n   */\n  interceptCopy($container) {\n    $container[0].addEventListener('copy', (event) => {\n      const selection = document.getSelection();\n      event.clipboardData.setData('text/plain', selection.toString());\n      event.preventDefault();\n    });\n  }\n\n  /**\n   * Applies mouse events when in default mode\n   * @param {SVGElement} svg\n   */\n  defaultMode(svg) {\n    svg.classList.remove(\"selectingSVG\");\n    $(svg).on(\"mousedown.textSelectPluginHandler\", (event) => {\n      if (!$(event.target).is(\".BRwordElement\")) return;\n      event.stopPropagation();\n      svg.classList.add(\"selectingSVG\");\n      $(svg).one(\"mouseup.textSelectPluginHandler\", (event) => {\n        if (window.getSelection().toString() != \"\") {\n          event.stopPropagation();\n          $(svg).off(\".textSelectPluginHandler\");\n          this.textSelectingMode(svg);\n        }\n        else svg.classList.remove(\"selectingSVG\");\n      })\n    })\n  }\n\n  /**\n   * Applies mouse events when in textSelecting mode\n   * @param {SVGElement} svg\n   */\n  textSelectingMode(svg) {\n    $(svg).on('mousedown.textSelectPluginHandler', (event) => {\n      if (!$(event.target).is(\".BRwordElement\")) {\n        if(window.getSelection().toString() != \"\") window.getSelection().removeAllRanges();\n      }\n      event.stopPropagation();\n    })\n    $(svg).on('mouseup.textSelectPluginHandler', (event) => {\n      event.stopPropagation();\n      if(window.getSelection().toString() == \"\") {\n        $(svg).off(\".textSelectPluginHandler\");\n        this.defaultMode(svg);      }\n    })\n  }\n\n  /**\n   * Initializes text selection modes if there is an svg on the page\n   * @param {JQuery} $container\n   */\n  stopPageFlip($container) {\n    /** @type {JQuery<SVGElement>} */\n    const $svg = $container.find('svg.textSelectionSVG');\n    if(!$svg.length) return;\n    $svg.each((i, s) => this.defaultMode(s))\n    this.interceptCopy($container);\n  }\n\n  /**\n   * @param {number} pageIndex\n   * @param {JQuery} $container\n   */\n  async createTextLayer(pageIndex, $container) {\n    const $svgLayers = $container.find('.textSelectionSVG');\n    if ($svgLayers.length) return;\n    const XMLpage = await this.getPageText(pageIndex);\n    if(!XMLpage) return;\n    const XMLwidth = $(XMLpage).attr(\"width\");\n    const XMLheight = $(XMLpage).attr(\"height\");\n\n    const svg = document.createElementNS(\"http://www.w3.org/2000/svg\", \"svg\");\n    svg.setAttribute(\"xmlns\", \"http://www.w3.org/2000/svg\");\n    svg.setAttribute(\"viewBox\", `0 0 ${XMLwidth} ${XMLheight}`);\n    $container.append(svg);\n    svg.setAttribute('class', 'textSelectionSVG');\n    svg.setAttribute('preserveAspectRatio', 'none');\n    $(svg).css({\n      \"width\": \"100%\",\n      \"position\": \"absolute\",\n      \"height\": \"100%\",\n      \"top\": \"0\",\n      \"left\": \"0\",\n    });\n\n    $(XMLpage).find(\"PARAGRAPH\").each((i, paragraph) => {\n      // Adding text element for each paragraph in the page\n      const words = $(paragraph).find(\"WORD\");\n      if (!words.length) return;\n      const paragSvg = document.createElementNS(\"http://www.w3.org/2000/svg\", this.svgParagraphElement);\n      paragSvg.setAttribute(\"class\", \"BRparagElement\");\n      if (this.pointerEventsOnParagraph) {\n        paragSvg.style.pointerEvents = \"all\";\n      }\n\n      const wordHeightArr = [];\n\n      for(let i = 0; i < words.length; i++) {\n        // Adding tspan for each word in paragraph\n        const currWord = words[i];\n        // eslint-disable-next-line no-unused-vars\n        const [left, bottom, right, top] = $(currWord).attr(\"coords\").split(',').map(parseFloat);\n        const wordHeight = bottom - top;\n        wordHeightArr.push(wordHeight);\n\n        const wordTspan = document.createElementNS(\"http://www.w3.org/2000/svg\", this.svgWordElement);\n        wordTspan.setAttribute(\"class\", \"BRwordElement\");\n        wordTspan.setAttribute(\"x\", left.toString());\n        wordTspan.setAttribute(\"y\", bottom.toString());\n        wordTspan.setAttribute(\"textLength\", (right - left).toString());\n        wordTspan.setAttribute(\"lengthAdjust\", \"spacingAndGlyphs\");\n        wordTspan.textContent = currWord.textContent;\n        paragSvg.appendChild(wordTspan);\n\n        // Adding spaces after words except at the end of the paragraph\n        // TODO: assumes left-to-right text\n        if(i < words.length - 1){\n          const nextWord = words[i + 1];\n          // eslint-disable-next-line no-unused-vars\n          const [leftNext, bottomNext, rightNext, topNext] = $(nextWord).attr(\"coords\").split(',').map(parseFloat);\n          const spaceTspan = document.createElementNS(\"http://www.w3.org/2000/svg\", this.svgWordElement);\n          spaceTspan.setAttribute(\"class\", \"BRwordElement\");\n          spaceTspan.setAttribute(\"x\", right.toString());\n          spaceTspan.setAttribute(\"y\", bottom.toString());\n          if((leftNext - right) > 0) spaceTspan.setAttribute(\"textLength\", (leftNext - right).toString());\n          spaceTspan.setAttribute(\"lengthAdjust\", \"spacingAndGlyphs\");\n          spaceTspan.textContent = \" \";\n          paragSvg.appendChild(spaceTspan);\n        }\n\n        // Adds newline at the end of paragraph on Firefox\n        if((i ==  words.length - 1 && (this.insertNewlines))) {\n          paragSvg.appendChild(document.createTextNode(\"\\n\"));\n        }\n      }\n\n      wordHeightArr.sort();\n      const paragWordHeight = wordHeightArr[Math.floor(wordHeightArr.length * 0.85)];\n      paragSvg.setAttribute(\"font-size\", paragWordHeight.toString());\n      svg.appendChild(paragSvg);\n    })\n    this.stopPageFlip($container);\n  }\n}\n\nexport class BookreaderWithTextSelection extends BookReader {\n  init() {\n    if(this.enableTextSelection){\n      this.textSelectionPlugin = new TextSelectionPlugin();\n      this.textSelectionPlugin.init(this.bookId);\n    }\n    super.init();\n  }\n\n  /**\n   * @param {number} index\n   */\n  _createPageContainer(index, styles = {}) {\n    const $container = super._createPageContainer(index, styles);\n    // Disable if thumb mode; it's too janky\n    if(this.enableTextSelection && this.mode != this.constModeThumb){\n      this.textSelectionPlugin.createTextLayer(index, $container);\n    }\n    return $container;\n  }\n}\nwindow.BookReader = BookreaderWithTextSelection;\nexport default BookreaderWithTextSelection;\n","\n/**\n * Checks whether the current browser is a Chrome/Chromium browser\n * Code from https://stackoverflow.com/a/4565120/2317712\n * @param {string} [userAgent]\n * @param {string} [vendor]\n * @return {boolean}\n */\nexport function isChrome(userAgent = navigator.userAgent, vendor = navigator.vendor) {\n  return /chrome/i.test(userAgent) && /google inc/i.test(vendor);\n}\n\n/**\n * Checks whether the current browser is firefox\n * @param {string} [userAgent]\n * @return {boolean}\n */\nexport function isFirefox(userAgent = navigator.userAgent) {\n  return /firefox/i.test(userAgent);\n}\n\n/**\n * Checks whether the current browser is safari\n * https://developer.mozilla.org/en-US/docs/Web/HTTP/Browser_detection_using_the_user_agent#Browser_Name\n * @param {string} [userAgent]\n * @return {boolean}\n */\nexport function isSafari(userAgent = navigator.userAgent) {\n  return /safari/i.test(userAgent) && !/chrome|chromium/i.test(userAgent);\n}\n","var userAgent = require('../internals/engine-user-agent');\n\nmodule.exports = /(iphone|ipod|ipad).*applewebkit/i.test(userAgent);\n","'use strict';\nvar aFunction = require('../internals/a-function');\nvar isObject = require('../internals/is-object');\n\nvar slice = [].slice;\nvar factories = {};\n\nvar construct = function (C, argsLength, args) {\n  if (!(argsLength in factories)) {\n    for (var list = [], i = 0; i < argsLength; i++) list[i] = 'a[' + i + ']';\n    // eslint-disable-next-line no-new-func\n    factories[argsLength] = Function('C,a', 'return new C(' + list.join(',') + ')');\n  } return factories[argsLength](C, args);\n};\n\n// `Function.prototype.bind` method implementation\n// https://tc39.github.io/ecma262/#sec-function.prototype.bind\nmodule.exports = Function.bind || function bind(that /* , ...args */) {\n  var fn = aFunction(this);\n  var partArgs = slice.call(arguments, 1);\n  var boundFunction = function bound(/* args... */) {\n    var args = partArgs.concat(slice.call(arguments));\n    return this instanceof boundFunction ? construct(fn, args.length, args) : fn.apply(that, args);\n  };\n  if (isObject(fn.prototype)) boundFunction.prototype = fn.prototype;\n  return boundFunction;\n};\n","var global = require('../internals/global');\n\nmodule.exports = function (a, b) {\n  var console = global.console;\n  if (console && console.error) {\n    arguments.length === 1 ? console.error(a) : console.error(a, b);\n  }\n};\n","var anObject = require('../internals/an-object');\nvar isArrayIteratorMethod = require('../internals/is-array-iterator-method');\nvar toLength = require('../internals/to-length');\nvar bind = require('../internals/function-bind-context');\nvar getIteratorMethod = require('../internals/get-iterator-method');\nvar callWithSafeIterationClosing = require('../internals/call-with-safe-iteration-closing');\n\nvar Result = function (stopped, result) {\n  this.stopped = stopped;\n  this.result = result;\n};\n\nvar iterate = module.exports = function (iterable, fn, that, AS_ENTRIES, IS_ITERATOR) {\n  var boundFunction = bind(fn, that, AS_ENTRIES ? 2 : 1);\n  var iterator, iterFn, index, length, result, next, step;\n\n  if (IS_ITERATOR) {\n    iterator = iterable;\n  } else {\n    iterFn = getIteratorMethod(iterable);\n    if (typeof iterFn != 'function') throw TypeError('Target is not iterable');\n    // optimisation for array iterators\n    if (isArrayIteratorMethod(iterFn)) {\n      for (index = 0, length = toLength(iterable.length); length > index; index++) {\n        result = AS_ENTRIES\n          ? boundFunction(anObject(step = iterable[index])[0], step[1])\n          : boundFunction(iterable[index]);\n        if (result && result instanceof Result) return result;\n      } return new Result(false);\n    }\n    iterator = iterFn.call(iterable);\n  }\n\n  next = iterator.next;\n  while (!(step = next.call(iterator)).done) {\n    result = callWithSafeIterationClosing(iterator, boundFunction, step.value, AS_ENTRIES);\n    if (typeof result == 'object' && result && result instanceof Result) return result;\n  } return new Result(false);\n};\n\niterate.stop = function (result) {\n  return new Result(true, result);\n};\n","var global = require('../internals/global');\nvar getOwnPropertyDescriptor = require('../internals/object-get-own-property-descriptor').f;\nvar classof = require('../internals/classof-raw');\nvar macrotask = require('../internals/task').set;\nvar IS_IOS = require('../internals/engine-is-ios');\n\nvar MutationObserver = global.MutationObserver || global.WebKitMutationObserver;\nvar process = global.process;\nvar Promise = global.Promise;\nvar IS_NODE = classof(process) == 'process';\n// Node.js 11 shows ExperimentalWarning on getting `queueMicrotask`\nvar queueMicrotaskDescriptor = getOwnPropertyDescriptor(global, 'queueMicrotask');\nvar queueMicrotask = queueMicrotaskDescriptor && queueMicrotaskDescriptor.value;\n\nvar flush, head, last, notify, toggle, node, promise, then;\n\n// modern engines have queueMicrotask method\nif (!queueMicrotask) {\n  flush = function () {\n    var parent, fn;\n    if (IS_NODE && (parent = process.domain)) parent.exit();\n    while (head) {\n      fn = head.fn;\n      head = head.next;\n      try {\n        fn();\n      } catch (error) {\n        if (head) notify();\n        else last = undefined;\n        throw error;\n      }\n    } last = undefined;\n    if (parent) parent.enter();\n  };\n\n  // Node.js\n  if (IS_NODE) {\n    notify = function () {\n      process.nextTick(flush);\n    };\n  // browsers with MutationObserver, except iOS - https://github.com/zloirock/core-js/issues/339\n  } else if (MutationObserver && !IS_IOS) {\n    toggle = true;\n    node = document.createTextNode('');\n    new MutationObserver(flush).observe(node, { characterData: true });\n    notify = function () {\n      node.data = toggle = !toggle;\n    };\n  // environments with maybe non-completely correct, but existent Promise\n  } else if (Promise && Promise.resolve) {\n    // Promise.resolve without an argument throws an error in LG WebOS 2\n    promise = Promise.resolve(undefined);\n    then = promise.then;\n    notify = function () {\n      then.call(promise, flush);\n    };\n  // for other environments - macrotask based on:\n  // - setImmediate\n  // - MessageChannel\n  // - window.postMessag\n  // - onreadystatechange\n  // - setTimeout\n  } else {\n    notify = function () {\n      // strange IE + webpack dev server bug - use .call(global)\n      macrotask.call(global, flush);\n    };\n  }\n}\n\nmodule.exports = queueMicrotask || function (fn) {\n  var task = { fn: fn, next: undefined };\n  if (last) last.next = task;\n  if (!head) {\n    head = task;\n    notify();\n  } last = task;\n};\n","var global = require('../internals/global');\n\nmodule.exports = global.Promise;\n","'use strict';\nvar aFunction = require('../internals/a-function');\n\nvar PromiseCapability = function (C) {\n  var resolve, reject;\n  this.promise = new C(function ($$resolve, $$reject) {\n    if (resolve !== undefined || reject !== undefined) throw TypeError('Bad Promise constructor');\n    resolve = $$resolve;\n    reject = $$reject;\n  });\n  this.resolve = aFunction(resolve);\n  this.reject = aFunction(reject);\n};\n\n// 25.4.1.5 NewPromiseCapability(C)\nmodule.exports.f = function (C) {\n  return new PromiseCapability(C);\n};\n","module.exports = function (exec) {\n  try {\n    return { error: false, value: exec() };\n  } catch (error) {\n    return { error: true, value: error };\n  }\n};\n","var anObject = require('../internals/an-object');\nvar isObject = require('../internals/is-object');\nvar newPromiseCapability = require('../internals/new-promise-capability');\n\nmodule.exports = function (C, x) {\n  anObject(C);\n  if (isObject(x) && x.constructor === C) return x;\n  var promiseCapability = newPromiseCapability.f(C);\n  var resolve = promiseCapability.resolve;\n  resolve(x);\n  return promiseCapability.promise;\n};\n","'use strict';\nvar getBuiltIn = require('../internals/get-built-in');\nvar definePropertyModule = require('../internals/object-define-property');\nvar wellKnownSymbol = require('../internals/well-known-symbol');\nvar DESCRIPTORS = require('../internals/descriptors');\n\nvar SPECIES = wellKnownSymbol('species');\n\nmodule.exports = function (CONSTRUCTOR_NAME) {\n  var Constructor = getBuiltIn(CONSTRUCTOR_NAME);\n  var defineProperty = definePropertyModule.f;\n\n  if (DESCRIPTORS && Constructor && !Constructor[SPECIES]) {\n    defineProperty(Constructor, SPECIES, {\n      configurable: true,\n      get: function () { return this; }\n    });\n  }\n};\n","var global = require('../internals/global');\nvar fails = require('../internals/fails');\nvar classof = require('../internals/classof-raw');\nvar bind = require('../internals/function-bind-context');\nvar html = require('../internals/html');\nvar createElement = require('../internals/document-create-element');\nvar IS_IOS = require('../internals/engine-is-ios');\n\nvar location = global.location;\nvar set = global.setImmediate;\nvar clear = global.clearImmediate;\nvar process = global.process;\nvar MessageChannel = global.MessageChannel;\nvar Dispatch = global.Dispatch;\nvar counter = 0;\nvar queue = {};\nvar ONREADYSTATECHANGE = 'onreadystatechange';\nvar defer, channel, port;\n\nvar run = function (id) {\n  // eslint-disable-next-line no-prototype-builtins\n  if (queue.hasOwnProperty(id)) {\n    var fn = queue[id];\n    delete queue[id];\n    fn();\n  }\n};\n\nvar runner = function (id) {\n  return function () {\n    run(id);\n  };\n};\n\nvar listener = function (event) {\n  run(event.data);\n};\n\nvar post = function (id) {\n  // old engines have not location.origin\n  global.postMessage(id + '', location.protocol + '//' + location.host);\n};\n\n// Node.js 0.9+ & IE10+ has setImmediate, otherwise:\nif (!set || !clear) {\n  set = function setImmediate(fn) {\n    var args = [];\n    var i = 1;\n    while (arguments.length > i) args.push(arguments[i++]);\n    queue[++counter] = function () {\n      // eslint-disable-next-line no-new-func\n      (typeof fn == 'function' ? fn : Function(fn)).apply(undefined, args);\n    };\n    defer(counter);\n    return counter;\n  };\n  clear = function clearImmediate(id) {\n    delete queue[id];\n  };\n  // Node.js 0.8-\n  if (classof(process) == 'process') {\n    defer = function (id) {\n      process.nextTick(runner(id));\n    };\n  // Sphere (JS game engine) Dispatch API\n  } else if (Dispatch && Dispatch.now) {\n    defer = function (id) {\n      Dispatch.now(runner(id));\n    };\n  // Browsers with MessageChannel, includes WebWorkers\n  // except iOS - https://github.com/zloirock/core-js/issues/624\n  } else if (MessageChannel && !IS_IOS) {\n    channel = new MessageChannel();\n    port = channel.port2;\n    channel.port1.onmessage = listener;\n    defer = bind(port.postMessage, port, 1);\n  // Browsers with postMessage, skip WebWorkers\n  // IE8 has postMessage, but it's sync & typeof its postMessage is 'object'\n  } else if (\n    global.addEventListener &&\n    typeof postMessage == 'function' &&\n    !global.importScripts &&\n    !fails(post) &&\n    location.protocol !== 'file:'\n  ) {\n    defer = post;\n    global.addEventListener('message', listener, false);\n  // IE8-\n  } else if (ONREADYSTATECHANGE in createElement('script')) {\n    defer = function (id) {\n      html.appendChild(createElement('script'))[ONREADYSTATECHANGE] = function () {\n        html.removeChild(this);\n        run(id);\n      };\n    };\n  // Rest old browsers\n  } else {\n    defer = function (id) {\n      setTimeout(runner(id), 0);\n    };\n  }\n}\n\nmodule.exports = {\n  set: set,\n  clear: clear\n};\n","var $ = require('../internals/export');\nvar fails = require('../internals/fails');\nvar toIndexedObject = require('../internals/to-indexed-object');\nvar nativeGetOwnPropertyDescriptor = require('../internals/object-get-own-property-descriptor').f;\nvar DESCRIPTORS = require('../internals/descriptors');\n\nvar FAILS_ON_PRIMITIVES = fails(function () { nativeGetOwnPropertyDescriptor(1); });\nvar FORCED = !DESCRIPTORS || FAILS_ON_PRIMITIVES;\n\n// `Object.getOwnPropertyDescriptor` method\n// https://tc39.github.io/ecma262/#sec-object.getownpropertydescriptor\n$({ target: 'Object', stat: true, forced: FORCED, sham: !DESCRIPTORS }, {\n  getOwnPropertyDescriptor: function getOwnPropertyDescriptor(it, key) {\n    return nativeGetOwnPropertyDescriptor(toIndexedObject(it), key);\n  }\n});\n","var $ = require('../internals/export');\nvar fails = require('../internals/fails');\nvar toObject = require('../internals/to-object');\nvar nativeGetPrototypeOf = require('../internals/object-get-prototype-of');\nvar CORRECT_PROTOTYPE_GETTER = require('../internals/correct-prototype-getter');\n\nvar FAILS_ON_PRIMITIVES = fails(function () { nativeGetPrototypeOf(1); });\n\n// `Object.getPrototypeOf` method\n// https://tc39.github.io/ecma262/#sec-object.getprototypeof\n$({ target: 'Object', stat: true, forced: FAILS_ON_PRIMITIVES, sham: !CORRECT_PROTOTYPE_GETTER }, {\n  getPrototypeOf: function getPrototypeOf(it) {\n    return nativeGetPrototypeOf(toObject(it));\n  }\n});\n\n","'use strict';\nvar $ = require('../internals/export');\nvar IS_PURE = require('../internals/is-pure');\nvar global = require('../internals/global');\nvar getBuiltIn = require('../internals/get-built-in');\nvar NativePromise = require('../internals/native-promise-constructor');\nvar redefine = require('../internals/redefine');\nvar redefineAll = require('../internals/redefine-all');\nvar setToStringTag = require('../internals/set-to-string-tag');\nvar setSpecies = require('../internals/set-species');\nvar isObject = require('../internals/is-object');\nvar aFunction = require('../internals/a-function');\nvar anInstance = require('../internals/an-instance');\nvar classof = require('../internals/classof-raw');\nvar inspectSource = require('../internals/inspect-source');\nvar iterate = require('../internals/iterate');\nvar checkCorrectnessOfIteration = require('../internals/check-correctness-of-iteration');\nvar speciesConstructor = require('../internals/species-constructor');\nvar task = require('../internals/task').set;\nvar microtask = require('../internals/microtask');\nvar promiseResolve = require('../internals/promise-resolve');\nvar hostReportErrors = require('../internals/host-report-errors');\nvar newPromiseCapabilityModule = require('../internals/new-promise-capability');\nvar perform = require('../internals/perform');\nvar InternalStateModule = require('../internals/internal-state');\nvar isForced = require('../internals/is-forced');\nvar wellKnownSymbol = require('../internals/well-known-symbol');\nvar V8_VERSION = require('../internals/engine-v8-version');\n\nvar SPECIES = wellKnownSymbol('species');\nvar PROMISE = 'Promise';\nvar getInternalState = InternalStateModule.get;\nvar setInternalState = InternalStateModule.set;\nvar getInternalPromiseState = InternalStateModule.getterFor(PROMISE);\nvar PromiseConstructor = NativePromise;\nvar TypeError = global.TypeError;\nvar document = global.document;\nvar process = global.process;\nvar $fetch = getBuiltIn('fetch');\nvar newPromiseCapability = newPromiseCapabilityModule.f;\nvar newGenericPromiseCapability = newPromiseCapability;\nvar IS_NODE = classof(process) == 'process';\nvar DISPATCH_EVENT = !!(document && document.createEvent && global.dispatchEvent);\nvar UNHANDLED_REJECTION = 'unhandledrejection';\nvar REJECTION_HANDLED = 'rejectionhandled';\nvar PENDING = 0;\nvar FULFILLED = 1;\nvar REJECTED = 2;\nvar HANDLED = 1;\nvar UNHANDLED = 2;\nvar Internal, OwnPromiseCapability, PromiseWrapper, nativeThen;\n\nvar FORCED = isForced(PROMISE, function () {\n  var GLOBAL_CORE_JS_PROMISE = inspectSource(PromiseConstructor) !== String(PromiseConstructor);\n  if (!GLOBAL_CORE_JS_PROMISE) {\n    // V8 6.6 (Node 10 and Chrome 66) have a bug with resolving custom thenables\n    // https://bugs.chromium.org/p/chromium/issues/detail?id=830565\n    // We can't detect it synchronously, so just check versions\n    if (V8_VERSION === 66) return true;\n    // Unhandled rejections tracking support, NodeJS Promise without it fails @@species test\n    if (!IS_NODE && typeof PromiseRejectionEvent != 'function') return true;\n  }\n  // We need Promise#finally in the pure version for preventing prototype pollution\n  if (IS_PURE && !PromiseConstructor.prototype['finally']) return true;\n  // We can't use @@species feature detection in V8 since it causes\n  // deoptimization and performance degradation\n  // https://github.com/zloirock/core-js/issues/679\n  if (V8_VERSION >= 51 && /native code/.test(PromiseConstructor)) return false;\n  // Detect correctness of subclassing with @@species support\n  var promise = PromiseConstructor.resolve(1);\n  var FakePromise = function (exec) {\n    exec(function () { /* empty */ }, function () { /* empty */ });\n  };\n  var constructor = promise.constructor = {};\n  constructor[SPECIES] = FakePromise;\n  return !(promise.then(function () { /* empty */ }) instanceof FakePromise);\n});\n\nvar INCORRECT_ITERATION = FORCED || !checkCorrectnessOfIteration(function (iterable) {\n  PromiseConstructor.all(iterable)['catch'](function () { /* empty */ });\n});\n\n// helpers\nvar isThenable = function (it) {\n  var then;\n  return isObject(it) && typeof (then = it.then) == 'function' ? then : false;\n};\n\nvar notify = function (promise, state, isReject) {\n  if (state.notified) return;\n  state.notified = true;\n  var chain = state.reactions;\n  microtask(function () {\n    var value = state.value;\n    var ok = state.state == FULFILLED;\n    var index = 0;\n    // variable length - can't use forEach\n    while (chain.length > index) {\n      var reaction = chain[index++];\n      var handler = ok ? reaction.ok : reaction.fail;\n      var resolve = reaction.resolve;\n      var reject = reaction.reject;\n      var domain = reaction.domain;\n      var result, then, exited;\n      try {\n        if (handler) {\n          if (!ok) {\n            if (state.rejection === UNHANDLED) onHandleUnhandled(promise, state);\n            state.rejection = HANDLED;\n          }\n          if (handler === true) result = value;\n          else {\n            if (domain) domain.enter();\n            result = handler(value); // can throw\n            if (domain) {\n              domain.exit();\n              exited = true;\n            }\n          }\n          if (result === reaction.promise) {\n            reject(TypeError('Promise-chain cycle'));\n          } else if (then = isThenable(result)) {\n            then.call(result, resolve, reject);\n          } else resolve(result);\n        } else reject(value);\n      } catch (error) {\n        if (domain && !exited) domain.exit();\n        reject(error);\n      }\n    }\n    state.reactions = [];\n    state.notified = false;\n    if (isReject && !state.rejection) onUnhandled(promise, state);\n  });\n};\n\nvar dispatchEvent = function (name, promise, reason) {\n  var event, handler;\n  if (DISPATCH_EVENT) {\n    event = document.createEvent('Event');\n    event.promise = promise;\n    event.reason = reason;\n    event.initEvent(name, false, true);\n    global.dispatchEvent(event);\n  } else event = { promise: promise, reason: reason };\n  if (handler = global['on' + name]) handler(event);\n  else if (name === UNHANDLED_REJECTION) hostReportErrors('Unhandled promise rejection', reason);\n};\n\nvar onUnhandled = function (promise, state) {\n  task.call(global, function () {\n    var value = state.value;\n    var IS_UNHANDLED = isUnhandled(state);\n    var result;\n    if (IS_UNHANDLED) {\n      result = perform(function () {\n        if (IS_NODE) {\n          process.emit('unhandledRejection', value, promise);\n        } else dispatchEvent(UNHANDLED_REJECTION, promise, value);\n      });\n      // Browsers should not trigger `rejectionHandled` event if it was handled here, NodeJS - should\n      state.rejection = IS_NODE || isUnhandled(state) ? UNHANDLED : HANDLED;\n      if (result.error) throw result.value;\n    }\n  });\n};\n\nvar isUnhandled = function (state) {\n  return state.rejection !== HANDLED && !state.parent;\n};\n\nvar onHandleUnhandled = function (promise, state) {\n  task.call(global, function () {\n    if (IS_NODE) {\n      process.emit('rejectionHandled', promise);\n    } else dispatchEvent(REJECTION_HANDLED, promise, state.value);\n  });\n};\n\nvar bind = function (fn, promise, state, unwrap) {\n  return function (value) {\n    fn(promise, state, value, unwrap);\n  };\n};\n\nvar internalReject = function (promise, state, value, unwrap) {\n  if (state.done) return;\n  state.done = true;\n  if (unwrap) state = unwrap;\n  state.value = value;\n  state.state = REJECTED;\n  notify(promise, state, true);\n};\n\nvar internalResolve = function (promise, state, value, unwrap) {\n  if (state.done) return;\n  state.done = true;\n  if (unwrap) state = unwrap;\n  try {\n    if (promise === value) throw TypeError(\"Promise can't be resolved itself\");\n    var then = isThenable(value);\n    if (then) {\n      microtask(function () {\n        var wrapper = { done: false };\n        try {\n          then.call(value,\n            bind(internalResolve, promise, wrapper, state),\n            bind(internalReject, promise, wrapper, state)\n          );\n        } catch (error) {\n          internalReject(promise, wrapper, error, state);\n        }\n      });\n    } else {\n      state.value = value;\n      state.state = FULFILLED;\n      notify(promise, state, false);\n    }\n  } catch (error) {\n    internalReject(promise, { done: false }, error, state);\n  }\n};\n\n// constructor polyfill\nif (FORCED) {\n  // 25.4.3.1 Promise(executor)\n  PromiseConstructor = function Promise(executor) {\n    anInstance(this, PromiseConstructor, PROMISE);\n    aFunction(executor);\n    Internal.call(this);\n    var state = getInternalState(this);\n    try {\n      executor(bind(internalResolve, this, state), bind(internalReject, this, state));\n    } catch (error) {\n      internalReject(this, state, error);\n    }\n  };\n  // eslint-disable-next-line no-unused-vars\n  Internal = function Promise(executor) {\n    setInternalState(this, {\n      type: PROMISE,\n      done: false,\n      notified: false,\n      parent: false,\n      reactions: [],\n      rejection: false,\n      state: PENDING,\n      value: undefined\n    });\n  };\n  Internal.prototype = redefineAll(PromiseConstructor.prototype, {\n    // `Promise.prototype.then` method\n    // https://tc39.github.io/ecma262/#sec-promise.prototype.then\n    then: function then(onFulfilled, onRejected) {\n      var state = getInternalPromiseState(this);\n      var reaction = newPromiseCapability(speciesConstructor(this, PromiseConstructor));\n      reaction.ok = typeof onFulfilled == 'function' ? onFulfilled : true;\n      reaction.fail = typeof onRejected == 'function' && onRejected;\n      reaction.domain = IS_NODE ? process.domain : undefined;\n      state.parent = true;\n      state.reactions.push(reaction);\n      if (state.state != PENDING) notify(this, state, false);\n      return reaction.promise;\n    },\n    // `Promise.prototype.catch` method\n    // https://tc39.github.io/ecma262/#sec-promise.prototype.catch\n    'catch': function (onRejected) {\n      return this.then(undefined, onRejected);\n    }\n  });\n  OwnPromiseCapability = function () {\n    var promise = new Internal();\n    var state = getInternalState(promise);\n    this.promise = promise;\n    this.resolve = bind(internalResolve, promise, state);\n    this.reject = bind(internalReject, promise, state);\n  };\n  newPromiseCapabilityModule.f = newPromiseCapability = function (C) {\n    return C === PromiseConstructor || C === PromiseWrapper\n      ? new OwnPromiseCapability(C)\n      : newGenericPromiseCapability(C);\n  };\n\n  if (!IS_PURE && typeof NativePromise == 'function') {\n    nativeThen = NativePromise.prototype.then;\n\n    // wrap native Promise#then for native async functions\n    redefine(NativePromise.prototype, 'then', function then(onFulfilled, onRejected) {\n      var that = this;\n      return new PromiseConstructor(function (resolve, reject) {\n        nativeThen.call(that, resolve, reject);\n      }).then(onFulfilled, onRejected);\n    // https://github.com/zloirock/core-js/issues/640\n    }, { unsafe: true });\n\n    // wrap fetch result\n    if (typeof $fetch == 'function') $({ global: true, enumerable: true, forced: true }, {\n      // eslint-disable-next-line no-unused-vars\n      fetch: function fetch(input /* , init */) {\n        return promiseResolve(PromiseConstructor, $fetch.apply(global, arguments));\n      }\n    });\n  }\n}\n\n$({ global: true, wrap: true, forced: FORCED }, {\n  Promise: PromiseConstructor\n});\n\nsetToStringTag(PromiseConstructor, PROMISE, false, true);\nsetSpecies(PROMISE);\n\nPromiseWrapper = getBuiltIn(PROMISE);\n\n// statics\n$({ target: PROMISE, stat: true, forced: FORCED }, {\n  // `Promise.reject` method\n  // https://tc39.github.io/ecma262/#sec-promise.reject\n  reject: function reject(r) {\n    var capability = newPromiseCapability(this);\n    capability.reject.call(undefined, r);\n    return capability.promise;\n  }\n});\n\n$({ target: PROMISE, stat: true, forced: IS_PURE || FORCED }, {\n  // `Promise.resolve` method\n  // https://tc39.github.io/ecma262/#sec-promise.resolve\n  resolve: function resolve(x) {\n    return promiseResolve(IS_PURE && this === PromiseWrapper ? PromiseConstructor : this, x);\n  }\n});\n\n$({ target: PROMISE, stat: true, forced: INCORRECT_ITERATION }, {\n  // `Promise.all` method\n  // https://tc39.github.io/ecma262/#sec-promise.all\n  all: function all(iterable) {\n    var C = this;\n    var capability = newPromiseCapability(C);\n    var resolve = capability.resolve;\n    var reject = capability.reject;\n    var result = perform(function () {\n      var $promiseResolve = aFunction(C.resolve);\n      var values = [];\n      var counter = 0;\n      var remaining = 1;\n      iterate(iterable, function (promise) {\n        var index = counter++;\n        var alreadyCalled = false;\n        values.push(undefined);\n        remaining++;\n        $promiseResolve.call(C, promise).then(function (value) {\n          if (alreadyCalled) return;\n          alreadyCalled = true;\n          values[index] = value;\n          --remaining || resolve(values);\n        }, reject);\n      });\n      --remaining || resolve(values);\n    });\n    if (result.error) reject(result.value);\n    return capability.promise;\n  },\n  // `Promise.race` method\n  // https://tc39.github.io/ecma262/#sec-promise.race\n  race: function race(iterable) {\n    var C = this;\n    var capability = newPromiseCapability(C);\n    var reject = capability.reject;\n    var result = perform(function () {\n      var $promiseResolve = aFunction(C.resolve);\n      iterate(iterable, function (promise) {\n        $promiseResolve.call(C, promise).then(capability.resolve, reject);\n      });\n    });\n    if (result.error) reject(result.value);\n    return capability.promise;\n  }\n});\n","var $ = require('../internals/export');\nvar getBuiltIn = require('../internals/get-built-in');\nvar aFunction = require('../internals/a-function');\nvar anObject = require('../internals/an-object');\nvar isObject = require('../internals/is-object');\nvar create = require('../internals/object-create');\nvar bind = require('../internals/function-bind');\nvar fails = require('../internals/fails');\n\nvar nativeConstruct = getBuiltIn('Reflect', 'construct');\n\n// `Reflect.construct` method\n// https://tc39.github.io/ecma262/#sec-reflect.construct\n// MS Edge supports only 2 arguments and argumentsList argument is optional\n// FF Nightly sets third argument as `new.target`, but does not create `this` from it\nvar NEW_TARGET_BUG = fails(function () {\n  function F() { /* empty */ }\n  return !(nativeConstruct(function () { /* empty */ }, [], F) instanceof F);\n});\nvar ARGS_BUG = !fails(function () {\n  nativeConstruct(function () { /* empty */ });\n});\nvar FORCED = NEW_TARGET_BUG || ARGS_BUG;\n\n$({ target: 'Reflect', stat: true, forced: FORCED, sham: FORCED }, {\n  construct: function construct(Target, args /* , newTarget */) {\n    aFunction(Target);\n    anObject(args);\n    var newTarget = arguments.length < 3 ? Target : aFunction(arguments[2]);\n    if (ARGS_BUG && !NEW_TARGET_BUG) return nativeConstruct(Target, args, newTarget);\n    if (Target == newTarget) {\n      // w/o altered newTarget, optimization for 0-4 arguments\n      switch (args.length) {\n        case 0: return new Target();\n        case 1: return new Target(args[0]);\n        case 2: return new Target(args[0], args[1]);\n        case 3: return new Target(args[0], args[1], args[2]);\n        case 4: return new Target(args[0], args[1], args[2], args[3]);\n      }\n      // w/o altered newTarget, lot of arguments case\n      var $args = [null];\n      $args.push.apply($args, args);\n      return new (bind.apply(Target, $args))();\n    }\n    // with altered newTarget, not support built-in constructors\n    var proto = newTarget.prototype;\n    var instance = create(isObject(proto) ? proto : Object.prototype);\n    var result = Function.apply.call(Target, instance, args);\n    return isObject(result) ? result : instance;\n  }\n});\n","var $ = require('../internals/export');\nvar isObject = require('../internals/is-object');\nvar anObject = require('../internals/an-object');\nvar has = require('../internals/has');\nvar getOwnPropertyDescriptorModule = require('../internals/object-get-own-property-descriptor');\nvar getPrototypeOf = require('../internals/object-get-prototype-of');\n\n// `Reflect.get` method\n// https://tc39.github.io/ecma262/#sec-reflect.get\nfunction get(target, propertyKey /* , receiver */) {\n  var receiver = arguments.length < 3 ? target : arguments[2];\n  var descriptor, prototype;\n  if (anObject(target) === receiver) return target[propertyKey];\n  if (descriptor = getOwnPropertyDescriptorModule.f(target, propertyKey)) return has(descriptor, 'value')\n    ? descriptor.value\n    : descriptor.get === undefined\n      ? undefined\n      : descriptor.get.call(receiver);\n  if (isObject(prototype = getPrototypeOf(target))) return get(prototype, propertyKey, receiver);\n}\n\n$({ target: 'Reflect', stat: true }, {\n  get: get\n});\n"],"sourceRoot":""}