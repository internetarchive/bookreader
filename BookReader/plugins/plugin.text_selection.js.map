{"version":3,"sources":["webpack://@internetarchive/bookreader/./src/util/strings.js","webpack://@internetarchive/bookreader/./src/js/plugins/plugin.text_selection.js","webpack://@internetarchive/bookreader/./src/util/browserSniffing.js","webpack://@internetarchive/bookreader/./node_modules/core-js/internals/engine-is-ios.js","webpack://@internetarchive/bookreader/./node_modules/core-js/internals/function-bind.js","webpack://@internetarchive/bookreader/./node_modules/core-js/internals/host-report-errors.js","webpack://@internetarchive/bookreader/./node_modules/core-js/internals/iterate.js","webpack://@internetarchive/bookreader/./node_modules/core-js/internals/microtask.js","webpack://@internetarchive/bookreader/./node_modules/core-js/internals/native-promise-constructor.js","webpack://@internetarchive/bookreader/./node_modules/core-js/internals/new-promise-capability.js","webpack://@internetarchive/bookreader/./node_modules/core-js/internals/perform.js","webpack://@internetarchive/bookreader/./node_modules/core-js/internals/promise-resolve.js","webpack://@internetarchive/bookreader/./node_modules/core-js/internals/set-species.js","webpack://@internetarchive/bookreader/./node_modules/core-js/internals/string-trim-forced.js","webpack://@internetarchive/bookreader/./node_modules/core-js/internals/string-trim.js","webpack://@internetarchive/bookreader/./node_modules/core-js/internals/task.js","webpack://@internetarchive/bookreader/./node_modules/core-js/internals/whitespaces.js","webpack://@internetarchive/bookreader/./node_modules/core-js/modules/es.object.get-own-property-descriptor.js","webpack://@internetarchive/bookreader/./node_modules/core-js/modules/es.object.get-prototype-of.js","webpack://@internetarchive/bookreader/./node_modules/core-js/modules/es.promise.js","webpack://@internetarchive/bookreader/./node_modules/core-js/modules/es.reflect.construct.js","webpack://@internetarchive/bookreader/./node_modules/core-js/modules/es.reflect.get.js","webpack://@internetarchive/bookreader/./node_modules/core-js/modules/es.string.trim.js"],"names":["applyVariables","template","vars","overrides","possibleFilters","APPLY_FILTERS","replace","$0","$1","split","map","x","trim","varName","filterNames","value","n","reduce","acc","cur","toString","urlencode","encodeURIComponent","BookReader","window","DEFAULT_OPTIONS","enabled","fullDjvuXmlUrl","singlePageDjvuXmlUrl","TextSelectionPlugin","options","optionVariables","avoidTspans","isFirefox","pointerEventsOnParagraph","isSafari","this","djvuPagesPromise","svgParagraphElement","svgWordElement","insertNewlines","$","ajax","type","url","dataType","error","e","then","xmlMap","find","index","XMLpagesArr","pageIndex","xmlDoc","$container","addEventListener","event","selection","document","getSelection","clipboardData","setData","preventDefault","svg","classList","remove","on","target","is","stopPropagation","add","one","off","textSelectingMode","removeAllRanges","defaultMode","$svg","length","each","i","s","interceptCopy","getPageText","XMLpage","XMLwidth","attr","XMLheight","createElementNS","setAttribute","append","css","paragraph","words","paragSvg","style","pointerEvents","wordHeightArr","currWord","parseFloat","left","bottom","right","wordHeight","push","wordTspan","textContent","appendChild","nextWord","leftNext","spaceTspan","createTextNode","sort","paragWordHeight","Math","floor","stopPageFlip","BookreaderWithTextSelection","Object","assign","plugins","textSelection","textSelectionPlugin","init","styles","mode","constModeThumb","createTextLayer","isChrome","userAgent","navigator","vendor","test","module","exports","aFunction","isObject","slice","factories","construct","C","argsLength","args","list","Function","join","bind","that","fn","partArgs","call","arguments","boundFunction","concat","apply","prototype","global","a","b","console","anObject","isArrayIteratorMethod","toLength","getIteratorMethod","callWithSafeIterationClosing","Result","stopped","result","iterable","AS_ENTRIES","IS_ITERATOR","iterator","iterFn","next","step","TypeError","done","stop","flush","head","last","notify","toggle","node","promise","getOwnPropertyDescriptor","classof","macrotask","IS_IOS","MutationObserver","WebKitMutationObserver","process","Promise","IS_NODE","queueMicrotaskDescriptor","queueMicrotask","parent","domain","exit","undefined","enter","nextTick","observe","characterData","data","resolve","task","PromiseCapability","reject","$$resolve","$$reject","f","exec","newPromiseCapability","constructor","promiseCapability","getBuiltIn","definePropertyModule","wellKnownSymbol","DESCRIPTORS","SPECIES","CONSTRUCTOR_NAME","Constructor","defineProperty","configurable","get","fails","whitespaces","METHOD_NAME","name","requireObjectCoercible","whitespace","ltrim","RegExp","rtrim","createMethod","TYPE","$this","string","String","start","end","defer","channel","port","html","createElement","location","set","setImmediate","clear","clearImmediate","MessageChannel","Dispatch","counter","queue","run","id","hasOwnProperty","runner","listener","post","postMessage","protocol","host","now","port2","port1","onmessage","importScripts","removeChild","setTimeout","toIndexedObject","nativeGetOwnPropertyDescriptor","FAILS_ON_PRIMITIVES","stat","forced","sham","it","key","toObject","nativeGetPrototypeOf","CORRECT_PROTOTYPE_GETTER","getPrototypeOf","Internal","OwnPromiseCapability","PromiseWrapper","nativeThen","IS_PURE","NativePromise","redefine","redefineAll","setToStringTag","setSpecies","anInstance","inspectSource","iterate","checkCorrectnessOfIteration","speciesConstructor","microtask","promiseResolve","hostReportErrors","newPromiseCapabilityModule","perform","InternalStateModule","isForced","V8_VERSION","PROMISE","getInternalState","setInternalState","getInternalPromiseState","getterFor","PromiseConstructor","$fetch","newGenericPromiseCapability","DISPATCH_EVENT","createEvent","dispatchEvent","UNHANDLED_REJECTION","FORCED","PromiseRejectionEvent","FakePromise","INCORRECT_ITERATION","all","isThenable","state","isReject","notified","chain","reactions","ok","exited","reaction","handler","fail","rejection","onHandleUnhandled","onUnhandled","reason","initEvent","isUnhandled","emit","unwrap","internalReject","internalResolve","wrapper","executor","onFulfilled","onRejected","unsafe","enumerable","fetch","input","wrap","r","capability","$promiseResolve","values","remaining","alreadyCalled","race","create","nativeConstruct","NEW_TARGET_BUG","F","ARGS_BUG","Target","newTarget","$args","proto","instance","has","getOwnPropertyDescriptorModule","propertyKey","descriptor","receiver","$trim","forcedStringTrimMethod"],"mappings":"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","file":"plugins/plugin.text_selection.js","sourcesContent":["/**\n * @typedef {String} StringWithVars\n * A template string with {{foo}} style variables\n * Also supports filters, like {{bookPath|urlencode}} (See APPLY_FILTERS for the\n * supported list of filters)\n **/\n\n/**\n * @param {StringWithVars|String} template\n * @param { {[varName: string]: { toString: () => string} } } vars\n * @param { {[varName: string]: { toString: () => string} } } [overrides]\n */\nexport function applyVariables(template, vars, overrides={}, possibleFilters=APPLY_FILTERS) {\n  return template?.replace(/\\{\\{([^}]*?)\\}\\}/g, ($0, $1) => {\n    if (!$1) return $0;\n    /** @type {string} */\n    const expression = $1;\n    const [varName, ...filterNames] = expression.split('|').map(x => x.trim());\n    const defined = varName in overrides || varName in vars;\n\n    // If it's not defined, don't expand it at all\n    if (!defined) return $0;\n    \n    const value = varName in overrides ? overrides[varName]\n    : varName in vars ? vars[varName] : null;\n    const filters = filterNames.map(n => possibleFilters[n]);\n    return filters.reduce((acc, cur) => cur(acc), value && value.toString());\n  });\n}\n\n/** @type { {[filterName: String]:( string => string)} } */\nexport const APPLY_FILTERS = {\n  urlencode: encodeURIComponent,\n};\n","//@ts-check\nimport { isFirefox, isSafari } from '../../util/browserSniffing.js';\nimport { applyVariables } from '../../util/strings.js';\n/** @typedef {import('../../util/strings.js').StringWithVars} StringWithVars */\n\nconst BookReader = /** @type {typeof import('../BookReader').default} */(window.BookReader);\n\nexport const DEFAULT_OPTIONS = {\n  enabled: true,\n  /** @type {StringWithVars} The URL to fetch the entire DJVU xml. Supports options.vars */\n  fullDjvuXmlUrl: null,\n  /** @type {StringWithVars} The URL to fetch a single page of the DJVU xml. Supports options.vars. Also has {{pageIndex}} */\n  singlePageDjvuXmlUrl: null,\n};\n/** @typedef {typeof DEFAULT_OPTIONS} TextSelectionPluginOptions */\n\nexport class TextSelectionPlugin {\n\n  constructor(options = DEFAULT_OPTIONS, optionVariables, avoidTspans = isFirefox(), pointerEventsOnParagraph = isSafari()) {\n    this.options = options;\n    this.optionVariables = optionVariables;\n    /**@type {PromiseLike<JQuery<HTMLElement>|undefined>} */\n    this.djvuPagesPromise = null;\n    // Using text elements insted of tspans for words because Firefox does not allow svg tspan strech.\n    // Tspans are necessary on Chrome because they prevent newline character after every word when copying\n    this.svgParagraphElement = \"text\";\n    this.svgWordElement = \"tspan\";\n    this.insertNewlines = avoidTspans\n    // Safari has a bug where `pointer-events` doesn't work on `<tspans>`. So\n    // there we will set `pointer-events: all` on the paragraph element. We don't\n    // do this everywhere, because it's a worse experience. Thanks Safari :/\n    this.pointerEventsOnParagraph = pointerEventsOnParagraph;\n    if (avoidTspans) {\n      this.svgParagraphElement = \"g\";\n      this.svgWordElement = \"text\";\n    }\n  }\n\n  init() {\n    // Only fetch the full djvu xml if the single page url isn't there\n    if (this.options.singlePageDjvuXmlUrl) return;\n    this.djvuPagesPromise = $.ajax({\n      type: \"GET\",\n      url: applyVariables(this.options.fullDjvuXmlUrl, this.optionVariables),\n      dataType: \"xml\",\n\n      error: function (e) {\n        return undefined;\n      }\n    }).then(xmlMap  => xmlMap && $(xmlMap).find(\"OBJECT\"));\n  }\n\n  /**\n   * @param {number} index\n   * @returns {Promise<HTMLElement|undefined>}\n   */\n  async getPageText(index) {\n    if (this.options.fullDjvuXmlUrl) {\n      const XMLpagesArr = await this.djvuPagesPromise;\n      if (XMLpagesArr) return XMLpagesArr[index];\n    } else {\n      return $.ajax({\n        type: \"GET\",\n        url: applyVariables(this.options.singlePageDjvuXmlUrl, this.optionVariables, { pageIndex: index }),\n        dataType: \"xml\",\n        error: (e) => undefined,\n      }).then(xmlDoc  => xmlDoc && $(xmlDoc).find(\"OBJECT\")[0]);\n    }\n  }\n\n  /**\n   * Intercept copied text to remove any styling applied to it\n   * @param {JQuery} $container\n   */\n  interceptCopy($container) {\n    $container[0].addEventListener('copy', (event) => {\n      const selection = document.getSelection();\n      event.clipboardData.setData('text/plain', selection.toString());\n      event.preventDefault();\n    });\n  }\n\n  /**\n   * Applies mouse events when in default mode\n   * @param {SVGElement} svg\n   */\n  defaultMode(svg) {\n    svg.classList.remove(\"selectingSVG\");\n    $(svg).on(\"mousedown.textSelectPluginHandler\", (event) => {\n      if (!$(event.target).is(\".BRwordElement\")) return;\n      event.stopPropagation();\n      svg.classList.add(\"selectingSVG\");\n      $(svg).one(\"mouseup.textSelectPluginHandler\", (event) => {\n        if (window.getSelection().toString() != \"\") {\n          event.stopPropagation();\n          $(svg).off(\".textSelectPluginHandler\");\n          this.textSelectingMode(svg);\n        }\n        else svg.classList.remove(\"selectingSVG\");\n      })\n    })\n  }\n\n  /**\n   * Applies mouse events when in textSelecting mode\n   * @param {SVGElement} svg\n   */\n  textSelectingMode(svg) {\n    $(svg).on('mousedown.textSelectPluginHandler', (event) => {\n      if (!$(event.target).is(\".BRwordElement\")) {\n        if (window.getSelection().toString() != \"\") window.getSelection().removeAllRanges();\n      }\n      event.stopPropagation();\n    })\n    $(svg).on('mouseup.textSelectPluginHandler', (event) => {\n      event.stopPropagation();\n      if (window.getSelection().toString() == \"\") {\n        $(svg).off(\".textSelectPluginHandler\");\n        this.defaultMode(svg);      }\n    })\n  }\n\n  /**\n   * Initializes text selection modes if there is an svg on the page\n   * @param {JQuery} $container\n   */\n  stopPageFlip($container) {\n    /** @type {JQuery<SVGElement>} */\n    const $svg = $container.find('svg.textSelectionSVG');\n    if (!$svg.length) return;\n    $svg.each((i, s) => this.defaultMode(s))\n    this.interceptCopy($container);\n  }\n\n  /**\n   * @param {number} pageIndex\n   * @param {JQuery} $container\n   */\n  async createTextLayer(pageIndex, $container) {\n    const $svgLayers = $container.find('.textSelectionSVG');\n    if ($svgLayers.length) return;\n    const XMLpage = await this.getPageText(pageIndex);\n    if (!XMLpage) return;\n    const XMLwidth = $(XMLpage).attr(\"width\");\n    const XMLheight = $(XMLpage).attr(\"height\");\n\n    const svg = document.createElementNS(\"http://www.w3.org/2000/svg\", \"svg\");\n    svg.setAttribute(\"xmlns\", \"http://www.w3.org/2000/svg\");\n    svg.setAttribute(\"viewBox\", `0 0 ${XMLwidth} ${XMLheight}`);\n    $container.append(svg);\n    svg.setAttribute('class', 'textSelectionSVG');\n    svg.setAttribute('preserveAspectRatio', 'none');\n    $(svg).css({\n      \"width\": \"100%\",\n      \"position\": \"absolute\",\n      \"height\": \"100%\",\n      \"top\": \"0\",\n      \"left\": \"0\",\n    });\n\n    $(XMLpage).find(\"PARAGRAPH\").each((i, paragraph) => {\n      // Adding text element for each paragraph in the page\n      const words = $(paragraph).find(\"WORD\");\n      if (!words.length) return;\n      const paragSvg = document.createElementNS(\"http://www.w3.org/2000/svg\", this.svgParagraphElement);\n      paragSvg.setAttribute(\"class\", \"BRparagElement\");\n      if (this.pointerEventsOnParagraph) {\n        paragSvg.style.pointerEvents = \"all\";\n      }\n\n      const wordHeightArr = [];\n\n      for (let i = 0; i < words.length; i++) {\n        // Adding tspan for each word in paragraph\n        const currWord = words[i];\n        // eslint-disable-next-line no-unused-vars\n        const [left, bottom, right, top] = $(currWord).attr(\"coords\").split(',').map(parseFloat);\n        const wordHeight = bottom - top;\n        wordHeightArr.push(wordHeight);\n\n        const wordTspan = document.createElementNS(\"http://www.w3.org/2000/svg\", this.svgWordElement);\n        wordTspan.setAttribute(\"class\", \"BRwordElement\");\n        wordTspan.setAttribute(\"x\", left.toString());\n        wordTspan.setAttribute(\"y\", bottom.toString());\n        wordTspan.setAttribute(\"textLength\", (right - left).toString());\n        wordTspan.setAttribute(\"lengthAdjust\", \"spacingAndGlyphs\");\n        wordTspan.textContent = currWord.textContent;\n        paragSvg.appendChild(wordTspan);\n\n        // Adding spaces after words except at the end of the paragraph\n        // TODO: assumes left-to-right text\n        if (i < words.length - 1) {\n          const nextWord = words[i + 1];\n          // eslint-disable-next-line no-unused-vars\n          const [leftNext, bottomNext, rightNext, topNext] = $(nextWord).attr(\"coords\").split(',').map(parseFloat);\n          const spaceTspan = document.createElementNS(\"http://www.w3.org/2000/svg\", this.svgWordElement);\n          spaceTspan.setAttribute(\"class\", \"BRwordElement\");\n          spaceTspan.setAttribute(\"x\", right.toString());\n          spaceTspan.setAttribute(\"y\", bottom.toString());\n          if ((leftNext - right) > 0) spaceTspan.setAttribute(\"textLength\", (leftNext - right).toString());\n          spaceTspan.setAttribute(\"lengthAdjust\", \"spacingAndGlyphs\");\n          spaceTspan.textContent = \" \";\n          paragSvg.appendChild(spaceTspan);\n        }\n\n        // Adds newline at the end of paragraph on Firefox\n        if ((i ==  words.length - 1 && (this.insertNewlines))) {\n          paragSvg.appendChild(document.createTextNode(\"\\n\"));\n        }\n      }\n\n      wordHeightArr.sort();\n      const paragWordHeight = wordHeightArr[Math.floor(wordHeightArr.length * 0.85)];\n      paragSvg.setAttribute(\"font-size\", paragWordHeight.toString());\n      svg.appendChild(paragSvg);\n    })\n    this.stopPageFlip($container);\n  }\n}\n\nexport class BookreaderWithTextSelection extends BookReader {\n  init() {\n    const options = Object.assign({}, DEFAULT_OPTIONS, this.options.plugins.textSelection);\n    if (options.enabled) {\n      this.textSelectionPlugin = new TextSelectionPlugin(options, this.options.vars);\n      // Write this back; this way the plugin is the source of truth, and BR just\n      // contains a reference to it.\n      this.options.plugins.textSelection = options;\n      this.textSelectionPlugin.init();\n    }\n    super.init();\n  }\n\n  /**\n   * @param {number} index\n   */\n  _createPageContainer(index, styles = {}) {\n    const $container = super._createPageContainer(index, styles);\n    // Disable if thumb mode; it's too janky\n    if (this.mode != this.constModeThumb) {\n      this.textSelectionPlugin?.createTextLayer(index, $container);\n    }\n    return $container;\n  }\n}\nwindow.BookReader = BookreaderWithTextSelection;\nexport default BookreaderWithTextSelection;\n","\n/**\n * Checks whether the current browser is a Chrome/Chromium browser\n * Code from https://stackoverflow.com/a/4565120/2317712\n * @param {string} [userAgent]\n * @param {string} [vendor]\n * @return {boolean}\n */\nexport function isChrome(userAgent = navigator.userAgent, vendor = navigator.vendor) {\n  return /chrome/i.test(userAgent) && /google inc/i.test(vendor);\n}\n\n/**\n * Checks whether the current browser is firefox\n * @param {string} [userAgent]\n * @return {boolean}\n */\nexport function isFirefox(userAgent = navigator.userAgent) {\n  return /firefox/i.test(userAgent);\n}\n\n/**\n * Checks whether the current browser is safari\n * https://developer.mozilla.org/en-US/docs/Web/HTTP/Browser_detection_using_the_user_agent#Browser_Name\n * @param {string} [userAgent]\n * @return {boolean}\n */\nexport function isSafari(userAgent = navigator.userAgent) {\n  return /safari/i.test(userAgent) && !/chrome|chromium/i.test(userAgent);\n}\n","var userAgent = require('../internals/engine-user-agent');\n\nmodule.exports = /(iphone|ipod|ipad).*applewebkit/i.test(userAgent);\n","'use strict';\nvar aFunction = require('../internals/a-function');\nvar isObject = require('../internals/is-object');\n\nvar slice = [].slice;\nvar factories = {};\n\nvar construct = function (C, argsLength, args) {\n  if (!(argsLength in factories)) {\n    for (var list = [], i = 0; i < argsLength; i++) list[i] = 'a[' + i + ']';\n    // eslint-disable-next-line no-new-func\n    factories[argsLength] = Function('C,a', 'return new C(' + list.join(',') + ')');\n  } return factories[argsLength](C, args);\n};\n\n// `Function.prototype.bind` method implementation\n// https://tc39.github.io/ecma262/#sec-function.prototype.bind\nmodule.exports = Function.bind || function bind(that /* , ...args */) {\n  var fn = aFunction(this);\n  var partArgs = slice.call(arguments, 1);\n  var boundFunction = function bound(/* args... */) {\n    var args = partArgs.concat(slice.call(arguments));\n    return this instanceof boundFunction ? construct(fn, args.length, args) : fn.apply(that, args);\n  };\n  if (isObject(fn.prototype)) boundFunction.prototype = fn.prototype;\n  return boundFunction;\n};\n","var global = require('../internals/global');\n\nmodule.exports = function (a, b) {\n  var console = global.console;\n  if (console && console.error) {\n    arguments.length === 1 ? console.error(a) : console.error(a, b);\n  }\n};\n","var anObject = require('../internals/an-object');\nvar isArrayIteratorMethod = require('../internals/is-array-iterator-method');\nvar toLength = require('../internals/to-length');\nvar bind = require('../internals/function-bind-context');\nvar getIteratorMethod = require('../internals/get-iterator-method');\nvar callWithSafeIterationClosing = require('../internals/call-with-safe-iteration-closing');\n\nvar Result = function (stopped, result) {\n  this.stopped = stopped;\n  this.result = result;\n};\n\nvar iterate = module.exports = function (iterable, fn, that, AS_ENTRIES, IS_ITERATOR) {\n  var boundFunction = bind(fn, that, AS_ENTRIES ? 2 : 1);\n  var iterator, iterFn, index, length, result, next, step;\n\n  if (IS_ITERATOR) {\n    iterator = iterable;\n  } else {\n    iterFn = getIteratorMethod(iterable);\n    if (typeof iterFn != 'function') throw TypeError('Target is not iterable');\n    // optimisation for array iterators\n    if (isArrayIteratorMethod(iterFn)) {\n      for (index = 0, length = toLength(iterable.length); length > index; index++) {\n        result = AS_ENTRIES\n          ? boundFunction(anObject(step = iterable[index])[0], step[1])\n          : boundFunction(iterable[index]);\n        if (result && result instanceof Result) return result;\n      } return new Result(false);\n    }\n    iterator = iterFn.call(iterable);\n  }\n\n  next = iterator.next;\n  while (!(step = next.call(iterator)).done) {\n    result = callWithSafeIterationClosing(iterator, boundFunction, step.value, AS_ENTRIES);\n    if (typeof result == 'object' && result && result instanceof Result) return result;\n  } return new Result(false);\n};\n\niterate.stop = function (result) {\n  return new Result(true, result);\n};\n","var global = require('../internals/global');\nvar getOwnPropertyDescriptor = require('../internals/object-get-own-property-descriptor').f;\nvar classof = require('../internals/classof-raw');\nvar macrotask = require('../internals/task').set;\nvar IS_IOS = require('../internals/engine-is-ios');\n\nvar MutationObserver = global.MutationObserver || global.WebKitMutationObserver;\nvar process = global.process;\nvar Promise = global.Promise;\nvar IS_NODE = classof(process) == 'process';\n// Node.js 11 shows ExperimentalWarning on getting `queueMicrotask`\nvar queueMicrotaskDescriptor = getOwnPropertyDescriptor(global, 'queueMicrotask');\nvar queueMicrotask = queueMicrotaskDescriptor && queueMicrotaskDescriptor.value;\n\nvar flush, head, last, notify, toggle, node, promise, then;\n\n// modern engines have queueMicrotask method\nif (!queueMicrotask) {\n  flush = function () {\n    var parent, fn;\n    if (IS_NODE && (parent = process.domain)) parent.exit();\n    while (head) {\n      fn = head.fn;\n      head = head.next;\n      try {\n        fn();\n      } catch (error) {\n        if (head) notify();\n        else last = undefined;\n        throw error;\n      }\n    } last = undefined;\n    if (parent) parent.enter();\n  };\n\n  // Node.js\n  if (IS_NODE) {\n    notify = function () {\n      process.nextTick(flush);\n    };\n  // browsers with MutationObserver, except iOS - https://github.com/zloirock/core-js/issues/339\n  } else if (MutationObserver && !IS_IOS) {\n    toggle = true;\n    node = document.createTextNode('');\n    new MutationObserver(flush).observe(node, { characterData: true });\n    notify = function () {\n      node.data = toggle = !toggle;\n    };\n  // environments with maybe non-completely correct, but existent Promise\n  } else if (Promise && Promise.resolve) {\n    // Promise.resolve without an argument throws an error in LG WebOS 2\n    promise = Promise.resolve(undefined);\n    then = promise.then;\n    notify = function () {\n      then.call(promise, flush);\n    };\n  // for other environments - macrotask based on:\n  // - setImmediate\n  // - MessageChannel\n  // - window.postMessag\n  // - onreadystatechange\n  // - setTimeout\n  } else {\n    notify = function () {\n      // strange IE + webpack dev server bug - use .call(global)\n      macrotask.call(global, flush);\n    };\n  }\n}\n\nmodule.exports = queueMicrotask || function (fn) {\n  var task = { fn: fn, next: undefined };\n  if (last) last.next = task;\n  if (!head) {\n    head = task;\n    notify();\n  } last = task;\n};\n","var global = require('../internals/global');\n\nmodule.exports = global.Promise;\n","'use strict';\nvar aFunction = require('../internals/a-function');\n\nvar PromiseCapability = function (C) {\n  var resolve, reject;\n  this.promise = new C(function ($$resolve, $$reject) {\n    if (resolve !== undefined || reject !== undefined) throw TypeError('Bad Promise constructor');\n    resolve = $$resolve;\n    reject = $$reject;\n  });\n  this.resolve = aFunction(resolve);\n  this.reject = aFunction(reject);\n};\n\n// 25.4.1.5 NewPromiseCapability(C)\nmodule.exports.f = function (C) {\n  return new PromiseCapability(C);\n};\n","module.exports = function (exec) {\n  try {\n    return { error: false, value: exec() };\n  } catch (error) {\n    return { error: true, value: error };\n  }\n};\n","var anObject = require('../internals/an-object');\nvar isObject = require('../internals/is-object');\nvar newPromiseCapability = require('../internals/new-promise-capability');\n\nmodule.exports = function (C, x) {\n  anObject(C);\n  if (isObject(x) && x.constructor === C) return x;\n  var promiseCapability = newPromiseCapability.f(C);\n  var resolve = promiseCapability.resolve;\n  resolve(x);\n  return promiseCapability.promise;\n};\n","'use strict';\nvar getBuiltIn = require('../internals/get-built-in');\nvar definePropertyModule = require('../internals/object-define-property');\nvar wellKnownSymbol = require('../internals/well-known-symbol');\nvar DESCRIPTORS = require('../internals/descriptors');\n\nvar SPECIES = wellKnownSymbol('species');\n\nmodule.exports = function (CONSTRUCTOR_NAME) {\n  var Constructor = getBuiltIn(CONSTRUCTOR_NAME);\n  var defineProperty = definePropertyModule.f;\n\n  if (DESCRIPTORS && Constructor && !Constructor[SPECIES]) {\n    defineProperty(Constructor, SPECIES, {\n      configurable: true,\n      get: function () { return this; }\n    });\n  }\n};\n","var fails = require('../internals/fails');\nvar whitespaces = require('../internals/whitespaces');\n\nvar non = '\\u200B\\u0085\\u180E';\n\n// check that a method works with the correct list\n// of whitespaces and has a correct name\nmodule.exports = function (METHOD_NAME) {\n  return fails(function () {\n    return !!whitespaces[METHOD_NAME]() || non[METHOD_NAME]() != non || whitespaces[METHOD_NAME].name !== METHOD_NAME;\n  });\n};\n","var requireObjectCoercible = require('../internals/require-object-coercible');\nvar whitespaces = require('../internals/whitespaces');\n\nvar whitespace = '[' + whitespaces + ']';\nvar ltrim = RegExp('^' + whitespace + whitespace + '*');\nvar rtrim = RegExp(whitespace + whitespace + '*$');\n\n// `String.prototype.{ trim, trimStart, trimEnd, trimLeft, trimRight }` methods implementation\nvar createMethod = function (TYPE) {\n  return function ($this) {\n    var string = String(requireObjectCoercible($this));\n    if (TYPE & 1) string = string.replace(ltrim, '');\n    if (TYPE & 2) string = string.replace(rtrim, '');\n    return string;\n  };\n};\n\nmodule.exports = {\n  // `String.prototype.{ trimLeft, trimStart }` methods\n  // https://tc39.github.io/ecma262/#sec-string.prototype.trimstart\n  start: createMethod(1),\n  // `String.prototype.{ trimRight, trimEnd }` methods\n  // https://tc39.github.io/ecma262/#sec-string.prototype.trimend\n  end: createMethod(2),\n  // `String.prototype.trim` method\n  // https://tc39.github.io/ecma262/#sec-string.prototype.trim\n  trim: createMethod(3)\n};\n","var global = require('../internals/global');\nvar fails = require('../internals/fails');\nvar classof = require('../internals/classof-raw');\nvar bind = require('../internals/function-bind-context');\nvar html = require('../internals/html');\nvar createElement = require('../internals/document-create-element');\nvar IS_IOS = require('../internals/engine-is-ios');\n\nvar location = global.location;\nvar set = global.setImmediate;\nvar clear = global.clearImmediate;\nvar process = global.process;\nvar MessageChannel = global.MessageChannel;\nvar Dispatch = global.Dispatch;\nvar counter = 0;\nvar queue = {};\nvar ONREADYSTATECHANGE = 'onreadystatechange';\nvar defer, channel, port;\n\nvar run = function (id) {\n  // eslint-disable-next-line no-prototype-builtins\n  if (queue.hasOwnProperty(id)) {\n    var fn = queue[id];\n    delete queue[id];\n    fn();\n  }\n};\n\nvar runner = function (id) {\n  return function () {\n    run(id);\n  };\n};\n\nvar listener = function (event) {\n  run(event.data);\n};\n\nvar post = function (id) {\n  // old engines have not location.origin\n  global.postMessage(id + '', location.protocol + '//' + location.host);\n};\n\n// Node.js 0.9+ & IE10+ has setImmediate, otherwise:\nif (!set || !clear) {\n  set = function setImmediate(fn) {\n    var args = [];\n    var i = 1;\n    while (arguments.length > i) args.push(arguments[i++]);\n    queue[++counter] = function () {\n      // eslint-disable-next-line no-new-func\n      (typeof fn == 'function' ? fn : Function(fn)).apply(undefined, args);\n    };\n    defer(counter);\n    return counter;\n  };\n  clear = function clearImmediate(id) {\n    delete queue[id];\n  };\n  // Node.js 0.8-\n  if (classof(process) == 'process') {\n    defer = function (id) {\n      process.nextTick(runner(id));\n    };\n  // Sphere (JS game engine) Dispatch API\n  } else if (Dispatch && Dispatch.now) {\n    defer = function (id) {\n      Dispatch.now(runner(id));\n    };\n  // Browsers with MessageChannel, includes WebWorkers\n  // except iOS - https://github.com/zloirock/core-js/issues/624\n  } else if (MessageChannel && !IS_IOS) {\n    channel = new MessageChannel();\n    port = channel.port2;\n    channel.port1.onmessage = listener;\n    defer = bind(port.postMessage, port, 1);\n  // Browsers with postMessage, skip WebWorkers\n  // IE8 has postMessage, but it's sync & typeof its postMessage is 'object'\n  } else if (\n    global.addEventListener &&\n    typeof postMessage == 'function' &&\n    !global.importScripts &&\n    !fails(post) &&\n    location.protocol !== 'file:'\n  ) {\n    defer = post;\n    global.addEventListener('message', listener, false);\n  // IE8-\n  } else if (ONREADYSTATECHANGE in createElement('script')) {\n    defer = function (id) {\n      html.appendChild(createElement('script'))[ONREADYSTATECHANGE] = function () {\n        html.removeChild(this);\n        run(id);\n      };\n    };\n  // Rest old browsers\n  } else {\n    defer = function (id) {\n      setTimeout(runner(id), 0);\n    };\n  }\n}\n\nmodule.exports = {\n  set: set,\n  clear: clear\n};\n","// a string of all valid unicode whitespaces\n// eslint-disable-next-line max-len\nmodule.exports = '\\u0009\\u000A\\u000B\\u000C\\u000D\\u0020\\u00A0\\u1680\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200A\\u202F\\u205F\\u3000\\u2028\\u2029\\uFEFF';\n","var $ = require('../internals/export');\nvar fails = require('../internals/fails');\nvar toIndexedObject = require('../internals/to-indexed-object');\nvar nativeGetOwnPropertyDescriptor = require('../internals/object-get-own-property-descriptor').f;\nvar DESCRIPTORS = require('../internals/descriptors');\n\nvar FAILS_ON_PRIMITIVES = fails(function () { nativeGetOwnPropertyDescriptor(1); });\nvar FORCED = !DESCRIPTORS || FAILS_ON_PRIMITIVES;\n\n// `Object.getOwnPropertyDescriptor` method\n// https://tc39.github.io/ecma262/#sec-object.getownpropertydescriptor\n$({ target: 'Object', stat: true, forced: FORCED, sham: !DESCRIPTORS }, {\n  getOwnPropertyDescriptor: function getOwnPropertyDescriptor(it, key) {\n    return nativeGetOwnPropertyDescriptor(toIndexedObject(it), key);\n  }\n});\n","var $ = require('../internals/export');\nvar fails = require('../internals/fails');\nvar toObject = require('../internals/to-object');\nvar nativeGetPrototypeOf = require('../internals/object-get-prototype-of');\nvar CORRECT_PROTOTYPE_GETTER = require('../internals/correct-prototype-getter');\n\nvar FAILS_ON_PRIMITIVES = fails(function () { nativeGetPrototypeOf(1); });\n\n// `Object.getPrototypeOf` method\n// https://tc39.github.io/ecma262/#sec-object.getprototypeof\n$({ target: 'Object', stat: true, forced: FAILS_ON_PRIMITIVES, sham: !CORRECT_PROTOTYPE_GETTER }, {\n  getPrototypeOf: function getPrototypeOf(it) {\n    return nativeGetPrototypeOf(toObject(it));\n  }\n});\n\n","'use strict';\nvar $ = require('../internals/export');\nvar IS_PURE = require('../internals/is-pure');\nvar global = require('../internals/global');\nvar getBuiltIn = require('../internals/get-built-in');\nvar NativePromise = require('../internals/native-promise-constructor');\nvar redefine = require('../internals/redefine');\nvar redefineAll = require('../internals/redefine-all');\nvar setToStringTag = require('../internals/set-to-string-tag');\nvar setSpecies = require('../internals/set-species');\nvar isObject = require('../internals/is-object');\nvar aFunction = require('../internals/a-function');\nvar anInstance = require('../internals/an-instance');\nvar classof = require('../internals/classof-raw');\nvar inspectSource = require('../internals/inspect-source');\nvar iterate = require('../internals/iterate');\nvar checkCorrectnessOfIteration = require('../internals/check-correctness-of-iteration');\nvar speciesConstructor = require('../internals/species-constructor');\nvar task = require('../internals/task').set;\nvar microtask = require('../internals/microtask');\nvar promiseResolve = require('../internals/promise-resolve');\nvar hostReportErrors = require('../internals/host-report-errors');\nvar newPromiseCapabilityModule = require('../internals/new-promise-capability');\nvar perform = require('../internals/perform');\nvar InternalStateModule = require('../internals/internal-state');\nvar isForced = require('../internals/is-forced');\nvar wellKnownSymbol = require('../internals/well-known-symbol');\nvar V8_VERSION = require('../internals/engine-v8-version');\n\nvar SPECIES = wellKnownSymbol('species');\nvar PROMISE = 'Promise';\nvar getInternalState = InternalStateModule.get;\nvar setInternalState = InternalStateModule.set;\nvar getInternalPromiseState = InternalStateModule.getterFor(PROMISE);\nvar PromiseConstructor = NativePromise;\nvar TypeError = global.TypeError;\nvar document = global.document;\nvar process = global.process;\nvar $fetch = getBuiltIn('fetch');\nvar newPromiseCapability = newPromiseCapabilityModule.f;\nvar newGenericPromiseCapability = newPromiseCapability;\nvar IS_NODE = classof(process) == 'process';\nvar DISPATCH_EVENT = !!(document && document.createEvent && global.dispatchEvent);\nvar UNHANDLED_REJECTION = 'unhandledrejection';\nvar REJECTION_HANDLED = 'rejectionhandled';\nvar PENDING = 0;\nvar FULFILLED = 1;\nvar REJECTED = 2;\nvar HANDLED = 1;\nvar UNHANDLED = 2;\nvar Internal, OwnPromiseCapability, PromiseWrapper, nativeThen;\n\nvar FORCED = isForced(PROMISE, function () {\n  var GLOBAL_CORE_JS_PROMISE = inspectSource(PromiseConstructor) !== String(PromiseConstructor);\n  if (!GLOBAL_CORE_JS_PROMISE) {\n    // V8 6.6 (Node 10 and Chrome 66) have a bug with resolving custom thenables\n    // https://bugs.chromium.org/p/chromium/issues/detail?id=830565\n    // We can't detect it synchronously, so just check versions\n    if (V8_VERSION === 66) return true;\n    // Unhandled rejections tracking support, NodeJS Promise without it fails @@species test\n    if (!IS_NODE && typeof PromiseRejectionEvent != 'function') return true;\n  }\n  // We need Promise#finally in the pure version for preventing prototype pollution\n  if (IS_PURE && !PromiseConstructor.prototype['finally']) return true;\n  // We can't use @@species feature detection in V8 since it causes\n  // deoptimization and performance degradation\n  // https://github.com/zloirock/core-js/issues/679\n  if (V8_VERSION >= 51 && /native code/.test(PromiseConstructor)) return false;\n  // Detect correctness of subclassing with @@species support\n  var promise = PromiseConstructor.resolve(1);\n  var FakePromise = function (exec) {\n    exec(function () { /* empty */ }, function () { /* empty */ });\n  };\n  var constructor = promise.constructor = {};\n  constructor[SPECIES] = FakePromise;\n  return !(promise.then(function () { /* empty */ }) instanceof FakePromise);\n});\n\nvar INCORRECT_ITERATION = FORCED || !checkCorrectnessOfIteration(function (iterable) {\n  PromiseConstructor.all(iterable)['catch'](function () { /* empty */ });\n});\n\n// helpers\nvar isThenable = function (it) {\n  var then;\n  return isObject(it) && typeof (then = it.then) == 'function' ? then : false;\n};\n\nvar notify = function (promise, state, isReject) {\n  if (state.notified) return;\n  state.notified = true;\n  var chain = state.reactions;\n  microtask(function () {\n    var value = state.value;\n    var ok = state.state == FULFILLED;\n    var index = 0;\n    // variable length - can't use forEach\n    while (chain.length > index) {\n      var reaction = chain[index++];\n      var handler = ok ? reaction.ok : reaction.fail;\n      var resolve = reaction.resolve;\n      var reject = reaction.reject;\n      var domain = reaction.domain;\n      var result, then, exited;\n      try {\n        if (handler) {\n          if (!ok) {\n            if (state.rejection === UNHANDLED) onHandleUnhandled(promise, state);\n            state.rejection = HANDLED;\n          }\n          if (handler === true) result = value;\n          else {\n            if (domain) domain.enter();\n            result = handler(value); // can throw\n            if (domain) {\n              domain.exit();\n              exited = true;\n            }\n          }\n          if (result === reaction.promise) {\n            reject(TypeError('Promise-chain cycle'));\n          } else if (then = isThenable(result)) {\n            then.call(result, resolve, reject);\n          } else resolve(result);\n        } else reject(value);\n      } catch (error) {\n        if (domain && !exited) domain.exit();\n        reject(error);\n      }\n    }\n    state.reactions = [];\n    state.notified = false;\n    if (isReject && !state.rejection) onUnhandled(promise, state);\n  });\n};\n\nvar dispatchEvent = function (name, promise, reason) {\n  var event, handler;\n  if (DISPATCH_EVENT) {\n    event = document.createEvent('Event');\n    event.promise = promise;\n    event.reason = reason;\n    event.initEvent(name, false, true);\n    global.dispatchEvent(event);\n  } else event = { promise: promise, reason: reason };\n  if (handler = global['on' + name]) handler(event);\n  else if (name === UNHANDLED_REJECTION) hostReportErrors('Unhandled promise rejection', reason);\n};\n\nvar onUnhandled = function (promise, state) {\n  task.call(global, function () {\n    var value = state.value;\n    var IS_UNHANDLED = isUnhandled(state);\n    var result;\n    if (IS_UNHANDLED) {\n      result = perform(function () {\n        if (IS_NODE) {\n          process.emit('unhandledRejection', value, promise);\n        } else dispatchEvent(UNHANDLED_REJECTION, promise, value);\n      });\n      // Browsers should not trigger `rejectionHandled` event if it was handled here, NodeJS - should\n      state.rejection = IS_NODE || isUnhandled(state) ? UNHANDLED : HANDLED;\n      if (result.error) throw result.value;\n    }\n  });\n};\n\nvar isUnhandled = function (state) {\n  return state.rejection !== HANDLED && !state.parent;\n};\n\nvar onHandleUnhandled = function (promise, state) {\n  task.call(global, function () {\n    if (IS_NODE) {\n      process.emit('rejectionHandled', promise);\n    } else dispatchEvent(REJECTION_HANDLED, promise, state.value);\n  });\n};\n\nvar bind = function (fn, promise, state, unwrap) {\n  return function (value) {\n    fn(promise, state, value, unwrap);\n  };\n};\n\nvar internalReject = function (promise, state, value, unwrap) {\n  if (state.done) return;\n  state.done = true;\n  if (unwrap) state = unwrap;\n  state.value = value;\n  state.state = REJECTED;\n  notify(promise, state, true);\n};\n\nvar internalResolve = function (promise, state, value, unwrap) {\n  if (state.done) return;\n  state.done = true;\n  if (unwrap) state = unwrap;\n  try {\n    if (promise === value) throw TypeError(\"Promise can't be resolved itself\");\n    var then = isThenable(value);\n    if (then) {\n      microtask(function () {\n        var wrapper = { done: false };\n        try {\n          then.call(value,\n            bind(internalResolve, promise, wrapper, state),\n            bind(internalReject, promise, wrapper, state)\n          );\n        } catch (error) {\n          internalReject(promise, wrapper, error, state);\n        }\n      });\n    } else {\n      state.value = value;\n      state.state = FULFILLED;\n      notify(promise, state, false);\n    }\n  } catch (error) {\n    internalReject(promise, { done: false }, error, state);\n  }\n};\n\n// constructor polyfill\nif (FORCED) {\n  // 25.4.3.1 Promise(executor)\n  PromiseConstructor = function Promise(executor) {\n    anInstance(this, PromiseConstructor, PROMISE);\n    aFunction(executor);\n    Internal.call(this);\n    var state = getInternalState(this);\n    try {\n      executor(bind(internalResolve, this, state), bind(internalReject, this, state));\n    } catch (error) {\n      internalReject(this, state, error);\n    }\n  };\n  // eslint-disable-next-line no-unused-vars\n  Internal = function Promise(executor) {\n    setInternalState(this, {\n      type: PROMISE,\n      done: false,\n      notified: false,\n      parent: false,\n      reactions: [],\n      rejection: false,\n      state: PENDING,\n      value: undefined\n    });\n  };\n  Internal.prototype = redefineAll(PromiseConstructor.prototype, {\n    // `Promise.prototype.then` method\n    // https://tc39.github.io/ecma262/#sec-promise.prototype.then\n    then: function then(onFulfilled, onRejected) {\n      var state = getInternalPromiseState(this);\n      var reaction = newPromiseCapability(speciesConstructor(this, PromiseConstructor));\n      reaction.ok = typeof onFulfilled == 'function' ? onFulfilled : true;\n      reaction.fail = typeof onRejected == 'function' && onRejected;\n      reaction.domain = IS_NODE ? process.domain : undefined;\n      state.parent = true;\n      state.reactions.push(reaction);\n      if (state.state != PENDING) notify(this, state, false);\n      return reaction.promise;\n    },\n    // `Promise.prototype.catch` method\n    // https://tc39.github.io/ecma262/#sec-promise.prototype.catch\n    'catch': function (onRejected) {\n      return this.then(undefined, onRejected);\n    }\n  });\n  OwnPromiseCapability = function () {\n    var promise = new Internal();\n    var state = getInternalState(promise);\n    this.promise = promise;\n    this.resolve = bind(internalResolve, promise, state);\n    this.reject = bind(internalReject, promise, state);\n  };\n  newPromiseCapabilityModule.f = newPromiseCapability = function (C) {\n    return C === PromiseConstructor || C === PromiseWrapper\n      ? new OwnPromiseCapability(C)\n      : newGenericPromiseCapability(C);\n  };\n\n  if (!IS_PURE && typeof NativePromise == 'function') {\n    nativeThen = NativePromise.prototype.then;\n\n    // wrap native Promise#then for native async functions\n    redefine(NativePromise.prototype, 'then', function then(onFulfilled, onRejected) {\n      var that = this;\n      return new PromiseConstructor(function (resolve, reject) {\n        nativeThen.call(that, resolve, reject);\n      }).then(onFulfilled, onRejected);\n    // https://github.com/zloirock/core-js/issues/640\n    }, { unsafe: true });\n\n    // wrap fetch result\n    if (typeof $fetch == 'function') $({ global: true, enumerable: true, forced: true }, {\n      // eslint-disable-next-line no-unused-vars\n      fetch: function fetch(input /* , init */) {\n        return promiseResolve(PromiseConstructor, $fetch.apply(global, arguments));\n      }\n    });\n  }\n}\n\n$({ global: true, wrap: true, forced: FORCED }, {\n  Promise: PromiseConstructor\n});\n\nsetToStringTag(PromiseConstructor, PROMISE, false, true);\nsetSpecies(PROMISE);\n\nPromiseWrapper = getBuiltIn(PROMISE);\n\n// statics\n$({ target: PROMISE, stat: true, forced: FORCED }, {\n  // `Promise.reject` method\n  // https://tc39.github.io/ecma262/#sec-promise.reject\n  reject: function reject(r) {\n    var capability = newPromiseCapability(this);\n    capability.reject.call(undefined, r);\n    return capability.promise;\n  }\n});\n\n$({ target: PROMISE, stat: true, forced: IS_PURE || FORCED }, {\n  // `Promise.resolve` method\n  // https://tc39.github.io/ecma262/#sec-promise.resolve\n  resolve: function resolve(x) {\n    return promiseResolve(IS_PURE && this === PromiseWrapper ? PromiseConstructor : this, x);\n  }\n});\n\n$({ target: PROMISE, stat: true, forced: INCORRECT_ITERATION }, {\n  // `Promise.all` method\n  // https://tc39.github.io/ecma262/#sec-promise.all\n  all: function all(iterable) {\n    var C = this;\n    var capability = newPromiseCapability(C);\n    var resolve = capability.resolve;\n    var reject = capability.reject;\n    var result = perform(function () {\n      var $promiseResolve = aFunction(C.resolve);\n      var values = [];\n      var counter = 0;\n      var remaining = 1;\n      iterate(iterable, function (promise) {\n        var index = counter++;\n        var alreadyCalled = false;\n        values.push(undefined);\n        remaining++;\n        $promiseResolve.call(C, promise).then(function (value) {\n          if (alreadyCalled) return;\n          alreadyCalled = true;\n          values[index] = value;\n          --remaining || resolve(values);\n        }, reject);\n      });\n      --remaining || resolve(values);\n    });\n    if (result.error) reject(result.value);\n    return capability.promise;\n  },\n  // `Promise.race` method\n  // https://tc39.github.io/ecma262/#sec-promise.race\n  race: function race(iterable) {\n    var C = this;\n    var capability = newPromiseCapability(C);\n    var reject = capability.reject;\n    var result = perform(function () {\n      var $promiseResolve = aFunction(C.resolve);\n      iterate(iterable, function (promise) {\n        $promiseResolve.call(C, promise).then(capability.resolve, reject);\n      });\n    });\n    if (result.error) reject(result.value);\n    return capability.promise;\n  }\n});\n","var $ = require('../internals/export');\nvar getBuiltIn = require('../internals/get-built-in');\nvar aFunction = require('../internals/a-function');\nvar anObject = require('../internals/an-object');\nvar isObject = require('../internals/is-object');\nvar create = require('../internals/object-create');\nvar bind = require('../internals/function-bind');\nvar fails = require('../internals/fails');\n\nvar nativeConstruct = getBuiltIn('Reflect', 'construct');\n\n// `Reflect.construct` method\n// https://tc39.github.io/ecma262/#sec-reflect.construct\n// MS Edge supports only 2 arguments and argumentsList argument is optional\n// FF Nightly sets third argument as `new.target`, but does not create `this` from it\nvar NEW_TARGET_BUG = fails(function () {\n  function F() { /* empty */ }\n  return !(nativeConstruct(function () { /* empty */ }, [], F) instanceof F);\n});\nvar ARGS_BUG = !fails(function () {\n  nativeConstruct(function () { /* empty */ });\n});\nvar FORCED = NEW_TARGET_BUG || ARGS_BUG;\n\n$({ target: 'Reflect', stat: true, forced: FORCED, sham: FORCED }, {\n  construct: function construct(Target, args /* , newTarget */) {\n    aFunction(Target);\n    anObject(args);\n    var newTarget = arguments.length < 3 ? Target : aFunction(arguments[2]);\n    if (ARGS_BUG && !NEW_TARGET_BUG) return nativeConstruct(Target, args, newTarget);\n    if (Target == newTarget) {\n      // w/o altered newTarget, optimization for 0-4 arguments\n      switch (args.length) {\n        case 0: return new Target();\n        case 1: return new Target(args[0]);\n        case 2: return new Target(args[0], args[1]);\n        case 3: return new Target(args[0], args[1], args[2]);\n        case 4: return new Target(args[0], args[1], args[2], args[3]);\n      }\n      // w/o altered newTarget, lot of arguments case\n      var $args = [null];\n      $args.push.apply($args, args);\n      return new (bind.apply(Target, $args))();\n    }\n    // with altered newTarget, not support built-in constructors\n    var proto = newTarget.prototype;\n    var instance = create(isObject(proto) ? proto : Object.prototype);\n    var result = Function.apply.call(Target, instance, args);\n    return isObject(result) ? result : instance;\n  }\n});\n","var $ = require('../internals/export');\nvar isObject = require('../internals/is-object');\nvar anObject = require('../internals/an-object');\nvar has = require('../internals/has');\nvar getOwnPropertyDescriptorModule = require('../internals/object-get-own-property-descriptor');\nvar getPrototypeOf = require('../internals/object-get-prototype-of');\n\n// `Reflect.get` method\n// https://tc39.github.io/ecma262/#sec-reflect.get\nfunction get(target, propertyKey /* , receiver */) {\n  var receiver = arguments.length < 3 ? target : arguments[2];\n  var descriptor, prototype;\n  if (anObject(target) === receiver) return target[propertyKey];\n  if (descriptor = getOwnPropertyDescriptorModule.f(target, propertyKey)) return has(descriptor, 'value')\n    ? descriptor.value\n    : descriptor.get === undefined\n      ? undefined\n      : descriptor.get.call(receiver);\n  if (isObject(prototype = getPrototypeOf(target))) return get(prototype, propertyKey, receiver);\n}\n\n$({ target: 'Reflect', stat: true }, {\n  get: get\n});\n","'use strict';\nvar $ = require('../internals/export');\nvar $trim = require('../internals/string-trim').trim;\nvar forcedStringTrimMethod = require('../internals/string-trim-forced');\n\n// `String.prototype.trim` method\n// https://tc39.github.io/ecma262/#sec-string.prototype.trim\n$({ target: 'String', proto: true, forced: forcedStringTrimMethod('trim') }, {\n  trim: function trim() {\n    return $trim(this);\n  }\n});\n"],"sourceRoot":""}