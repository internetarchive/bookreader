{"version":3,"sources":["webpack://@internetarchive/bookreader/./src/js/plugins/plugin.mobile_nav.js","webpack://@internetarchive/bookreader/./node_modules/core-js/internals/array-for-each.js","webpack://@internetarchive/bookreader/./node_modules/core-js/modules/es.array.for-each.js"],"names":["super_","FILTERLIST","filter","label","jQuery","extend","BookReader","defaultOptions","enableMobileNav","mobileNavTitle","mobileNavFullscreenOnly","prototype","setup","options","call","this","refs","$mmenu","initToolbar","mode","ui","$mmenuEl","$drawerEl","buildMobileDrawerElement","$br","append","buildInfoDiv","$","buildShareDiv","mmenu","navbars","navbar","add","title","titleLink","extensions","offCanvas","wrapPageIfNeeded","zposition","pageSelector","el","$BRpageviewField","find","data","bind","length","val","window","location","href","click","applyFilters","switchMode","constMode1up","constMode2up","constModeThumb","document","body","addClass","apply","arguments","getInstance","vars","opened","close","open","trigger","closeMobileMenu","e","width","addEventListener","utils","buildToolbarElement","$el","escapedTitle","util","escapeHTML","bookTitle","toolbar","prepend","experimentalHtml","enableExperimentalControls","forEach","i","checkboxHtml","concat","settingsSection","imagesBaseURL","moreInfo","share","navMenu","arg","$results","drawerEl","br","filterStr","each","removeClass","is","attr","filtersSheet","createElement","id","innerHTML","appendChild","$forEach","arrayMethodIsStrict","arrayMethodUsesToLength","STRICT_METHOD","USES_TO_LENGTH","module","exports","callbackfn","undefined","target","proto","forced"],"mappings":"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","file":"plugins/plugin.mobile_nav.js","sourcesContent":["/* global BookReader */\r\n/**\r\n * Adds mobile navigation at responsive breakpoint\r\n * NOTE additional script and style tags must be included.\r\n *\r\n * <script src=\"../BookReader/mmenu/dist/js/jquery.mmenu.min.js\"></script>\r\n * <script src=\"../BookReader/mmenu/dist/addons/navbars/jquery.mmenu.navbars.min.js\"></script>\r\n * <link rel=\"stylesheet\" href=\"../BookReader/mmenu/dist/css/jquery.mmenu.css\" />\r\n * <link rel=\"stylesheet\" href=\"../BookReader/mmenu/dist/addons/navbars/jquery.mmenu.navbars.css\" />\r\n */\r\n\r\nimport * as utils from '../BookReader/utils.js';\r\n\r\n//contains all filters and labels for checkboxs\r\nconst FILTERLIST = [\r\n  {\r\n    filter: \"grayscale(100%)\",\r\n    label: \"Grayscale\"\r\n  },\r\n  {\r\n    filter: \"brightness(120%)\",\r\n    label: \"High brightness\"\r\n  },\r\n  {\r\n    filter: \"invert(100%)\",\r\n    label: \"Inverted (dark mode)\"\r\n  },\r\n  {\r\n    filter: \"contrast(120%)\",\r\n    label: \"High contrast\"\r\n  },\r\n]\r\n\r\njQuery.extend(BookReader.defaultOptions, {\r\n  enableMobileNav: true,\r\n  mobileNavTitle: 'Internet Archive',\r\n  mobileNavFullscreenOnly: false,\r\n});\r\n\r\nBookReader.prototype.setup = (function(super_) {\r\n  return function (options) {\r\n    super_.call(this, options);\r\n\r\n    this.enableMobileNav = options.enableMobileNav;\r\n    this.mobileNavTitle = options.mobileNavTitle;\r\n    this.mobileNavFullscreenOnly = options.mobileNavFullscreenOnly;\r\n\r\n    this.refs.$mmenu = null;\r\n  };\r\n})(BookReader.prototype.setup);\r\n\r\n\r\n// Extend initToolbar\r\nBookReader.prototype.initToolbar = (function (super_) {\r\n  return function (mode, ui) {\r\n    let $mmenuEl;\r\n    if (this.enableMobileNav) {\r\n      const $drawerEl = this.buildMobileDrawerElement();\r\n      this.refs.$br.append($drawerEl);\r\n\r\n      // Render info into mobile info before mmenu\r\n      this.buildInfoDiv(this.$('.BRmobileInfo'));\r\n      this.buildShareDiv(this.$('.BRmobileShare'));\r\n\r\n      $mmenuEl = $drawerEl;\r\n      $mmenuEl.mmenu({\r\n        navbars: [\r\n          { \"position\": \"top\" },\r\n        ],\r\n        navbar: {\r\n          add: true,\r\n          title: this.mobileNavTitle,\r\n          titleLink: 'panel'\r\n        },\r\n        extensions: [ \"panelshadow\" ],\r\n      }, {\r\n        offCanvas: {\r\n          wrapPageIfNeeded: false,\r\n          zposition: 'next',\r\n          pageSelector: this.el,\r\n        }\r\n      });\r\n\r\n      const $BRpageviewField = $mmenuEl.find('.BRpageviewValue');\r\n      $mmenuEl.data('mmenu').bind('opened', () => {\r\n        // Update \"Link to this page view\" link\r\n        if ($BRpageviewField.length) {\r\n          $BRpageviewField.val(window.location.href);\r\n        }\r\n      });\r\n\r\n      //apply filters when checkboxs clicked\r\n      $drawerEl.find('.BRcheckbox-filters').click(() => applyFilters($drawerEl, this));\r\n\r\n      // Bind mobile switch buttons\r\n      $drawerEl.find('.DrawerLayoutButton.one_page_mode').click(\r\n        () => this.switchMode(this.constMode1up));\r\n      $drawerEl.find('.DrawerLayoutButton.two_page_mode').click(\r\n        () => this.switchMode(this.constMode2up));\r\n      $drawerEl.find('.DrawerLayoutButton.thumbnail_mode').click(\r\n        () => this.switchMode(this.constModeThumb));\r\n\r\n      if (this.mobileNavFullscreenOnly) {\r\n        $(document.body).addClass('BRbodyMobileNavEnabledFullscreen');\r\n      } else {\r\n        $(document.body).addClass('BRbodyMobileNavEnabled');\r\n      }\r\n\r\n      this.refs.$mmenu = $mmenuEl;\r\n\r\n    }\r\n\r\n    // Call the parent method at the end, because it binds events to DOM\r\n    super_.apply(this, arguments);\r\n\r\n\r\n    if (this.enableMobileNav) {\r\n      // Need to bind more, console after toolbar is initialized\r\n      this.$('.BRmobileHamburger').click(() => {\r\n        if ($mmenuEl.data('mmenu').getInstance().vars.opened) {\r\n          $mmenuEl.data('mmenu').close();\r\n        } else {\r\n          $mmenuEl.data('mmenu').open();\r\n          this.trigger(\"mobileNavOpen\");\r\n        }\r\n      });\r\n\r\n\r\n      const closeMobileMenu = (e) => {\r\n        // Need to close the mobile menu to reset DOM & Style\r\n        // driven by menu plugin\r\n        const width = $( window ).width();\r\n        const mobileMenuIsOpen = $mmenuEl.data('mmenu').getInstance().vars.opened;\r\n        // $brBreakPointMobile: 800px;\r\n        if (mobileMenuIsOpen && (width >= 800)) {\r\n          $mmenuEl.data('mmenu').close ();\r\n        }\r\n      };\r\n\r\n      window.addEventListener('resize', utils.debounce(closeMobileMenu, 900));\r\n    }\r\n  };\r\n})(BookReader.prototype.initToolbar);\r\n\r\n\r\nBookReader.prototype.buildToolbarElement = (function (super_) {\r\n  return function () {\r\n    const $el = super_.call(this);\r\n    if (this.enableMobileNav) {\r\n      const escapedTitle = BookReader.util.escapeHTML(this.bookTitle);\r\n      const toolbar = `\r\n        <span class=\"BRmobileHamburgerWrapper\">\r\n          <button class=\"BRmobileHamburger\"></button>\r\n          <span class=\"BRtoolbarMobileTitle\" title=\"${escapedTitle}\">${escapedTitle}</span>\r\n        </span>\r\n      `;\r\n      $el\r\n        .addClass('responsive')\r\n        .prepend($(toolbar));\r\n    }\r\n    return $el;\r\n  };\r\n})(BookReader.prototype.buildToolbarElement);\r\n\r\n/**\r\n * This method builds the html for the mobile drawer. It can be decorated to\r\n * extend the default drawer.\r\n * @return {jqueryElement}\r\n */\r\nBookReader.prototype.buildMobileDrawerElement = function() {\r\n  let experimentalHtml = '';\r\n  //builds filters checkbox html\r\n  if (this.enableExperimentalControls) {\r\n    experimentalHtml = `\r\n        <p class=\"DrawerSettingsTitle\">Visual Adjustment</p>\r\n        <div class=\"BRcheckbox-group-filters\">\r\n        `;\r\n    FILTERLIST.forEach( (el, i) => {\r\n      const checkboxHtml = `\r\n          <input type=\"checkbox\" class=\"BRcheckbox-filters\" id=\"filter${i}\">\r\n          <label for=\"filter${i}\" class=\"BRcheckbox-label-filters\">${el.label}</label><br>\r\n        \r\n      `;\r\n      experimentalHtml = experimentalHtml.concat(checkboxHtml);\r\n    })\r\n    experimentalHtml = experimentalHtml.concat(\"</div>\");\r\n  }\r\n\r\n\r\n  const settingsSection = `\r\n    <span>\r\n        <span class=\"DrawerIconWrapper\">\r\n          <img class=\"DrawerIcon\" src=\"${`${this.imagesBaseURL}icon_gear.svg`}\" alt=\"settings-icon\"/>\r\n        </span>\r\n        Settings\r\n    </span>\r\n    <div class=DrawerSettingsWrapper>\r\n        <div class=\"DrawerSettingsLayoutWrapper\">\r\n          <button class=\"DrawerLayoutButton one_page_mode\">\r\n            <img src=\"${this.imagesBaseURL}icon_one_page.svg\" alt=\"Single Page\"/>\r\n            <br>\r\n            One Page\r\n          </button>\r\n          <button class=\"DrawerLayoutButton two_page_mode TwoPagesButton\">\r\n            <img src=\"${this.imagesBaseURL}icon_two_pages.svg\" alt=\"Two Pages\"/>\r\n            <br>\r\n            Two Pages\r\n          </button>\r\n          <button class=\"DrawerLayoutButton thumbnail_mode\">\r\n            <img src=\"${this.imagesBaseURL}icon_thumbnails.svg\" alt=\"Thumbnails\"/>\r\n            <br>\r\n            Thumbnails\r\n          </button>\r\n        </div>\r\n        <br>\r\n        <div class=\"DrawerSettingsTitle\">Zoom</div>\r\n        <button class='BRicon zoom_out'></button>\r\n        <button class='BRicon zoom_in'></button>\r\n        <br style=\"clear:both\"><br><br>\r\n        ${experimentalHtml}\r\n    </div>\r\n  `;\r\n  const moreInfo = `\r\n    <span>\r\n        <span class=\"DrawerIconWrapper \">\r\n            <img class=\"DrawerIcon\" src=\"${this.imagesBaseURL}icon_info.svg\" alt=\"info-icon\"/>\r\n        </span>\r\n        About This Book\r\n    </span>\r\n    <div class=\"BRmobileInfo\"></div>\r\n  `;\r\n  const share = `\r\n    <span>\r\n      <span class=\"DrawerIconWrapper\">\r\n        <img class=\"DrawerIcon\" src=\"${this.imagesBaseURL}icon_share.svg\" alt=\"info-share\"/>\r\n      </span>\r\n      Share This Book\r\n    </span>\r\n    <div class=\"BRmobileShare\"></div>\r\n  `;\r\n  const navMenu = `\r\n    <nav id=\"BRmobileMenu\" class=\"BRmobileMenu\">\r\n      <ul>\r\n        <li class=\"BRmobileMenu__settings\">${settingsSection}</li>\r\n        <li class=\"BRmobileMenu__moreInfoRow\">${moreInfo}</li>\r\n        <li class=\"BRmobileMenu__share\">${share}</li>\r\n      </ul>\r\n    </nav>\r\n  `;\r\n\r\n  const $el = $(navMenu);\r\n  return $el;\r\n};\r\n\r\n/**\r\n * Mmenu moves itself out side of the root BookReader element, so we need to\r\n * include it in the scoped $ function.\r\n */\r\nBookReader.prototype.$ = (function (super_) {\r\n  return function (arg) {\r\n    let $results = super_.call(this, arg);\r\n    if (this.refs.$mmenu) {\r\n      $results = $results.add(this.refs.$mmenu.find(arg));\r\n    }\r\n    return $results;\r\n  };\r\n})(BookReader.prototype.$);\r\n\r\n/**\r\n* Dynamically creates styles combining different filters for BookReaders imgs\r\n* based on filters checkbox\r\n*/\r\nconst applyFilters = (drawerEl, br) => {\r\n  let filterStr = \"\";\r\n\r\n  $('.BRcheckbox-filters').each(\r\n    (i, el) => {\r\n      br.refs.$br.removeClass(\"filter-applied\");\r\n      if($(el).is(':checked')){\r\n        br.refs.$br.addClass($(el).attr(\"filter-applied\"));\r\n        filterStr = filterStr + FILTERLIST[i].filter;\r\n      }\r\n    }\r\n  );\r\n  const filtersSheet = $(\"#filtersStyle\")[0] || document.createElement('style');\r\n  filtersSheet.id = \"filtersStyle\";\r\n  filtersSheet.innerHTML = `.BRpagecontainer  img {\r\n            filter: ${filterStr};\r\n            -webkit-filter: ${filterStr};}`;\r\n  document.body.appendChild(filtersSheet);\r\n}\r\n","'use strict';\nvar $forEach = require('../internals/array-iteration').forEach;\nvar arrayMethodIsStrict = require('../internals/array-method-is-strict');\nvar arrayMethodUsesToLength = require('../internals/array-method-uses-to-length');\n\nvar STRICT_METHOD = arrayMethodIsStrict('forEach');\nvar USES_TO_LENGTH = arrayMethodUsesToLength('forEach');\n\n// `Array.prototype.forEach` method implementation\n// https://tc39.github.io/ecma262/#sec-array.prototype.foreach\nmodule.exports = (!STRICT_METHOD || !USES_TO_LENGTH) ? function forEach(callbackfn /* , thisArg */) {\n  return $forEach(this, callbackfn, arguments.length > 1 ? arguments[1] : undefined);\n} : [].forEach;\n","'use strict';\nvar $ = require('../internals/export');\nvar forEach = require('../internals/array-for-each');\n\n// `Array.prototype.forEach` method\n// https://tc39.github.io/ecma262/#sec-array.prototype.foreach\n$({ target: 'Array', proto: true, forced: [].forEach != forEach }, {\n  forEach: forEach\n});\n"],"sourceRoot":""}