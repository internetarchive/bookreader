{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/js/plugins/tts/AsyncStream.js","webpack:///./src/js/plugins/tts/plugin.tts.js","webpack:///./src/js/plugins/tts/FestivalTTSEngine.js","webpack:///./src/js/plugins/tts/AbstractTTSEngine.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","AsyncStream","mapper","MappingAsyncStream","this","predicate","FilteringAsyncStream","bufferSize","BufferingAsyncStream","FlatteningAsyncStream","start","end","RangeAsyncStream","cur","Promise","resolve","done","parent","pull","then","item","mapped","_lastResult","_inProgress","length","shift","_bufferSize","_promiseBuffer","toFetch","Math","max","push","super_","FestivalTTSEngine","options","audioFormat","$","browser","mozilla","isSupported","soundManager","supported","setup","debugMode","preferFlash","url","useHTML5Audio","flashVersion","leafIndex","numLeafs","navigator","userAgent","match","createSound","getSoundUrl","play","playStream","stopAll","chunkStream","map","fetchChunkSound","buffer","chunk","res","sound","onfinish","destruct","pageChunk","extend","text","onload","onready","onbufferchange","isBuffering","load","dataString","opts","server","encodeURIComponent","playing","onLoadingStart","range","fetchPageChunks","flatten","step","getPlayStream","stop","onDone","onLoadingComplete","beforeChunkPlay","playChunk","ajax","type","dataType","data","path","bookPath","page","chunks","lineRects","slice","jQuery","BookReader","defaultOptions","enableTtsPlugin","ttsEngine","showProgressPopup","removeProgressPopup","ttsStop","ttsBeforeChunkPlay","ttsHilites","init","eventNames","PostInit","e","br","click","ttsToggle","buildMobileDrawerElement","$el","find","after","imagesBaseURL","initNavbar","insertAfter","autoStop","ttsStart","constModeThumb","switchMode","constMode1up","addClass","currentIndex","getNumLeafs","removeClass","ttsRemoveHilites","ttsMaybeFlipToIndex","ttsHighlightChunk","ttsScrollToChunk","in2PageMode","constMode2up","promise","twoPage","currentIndexR","currentIndexL","animationFinishedCallback","next","jumpToIndex","ttsHilite2UP","ttsHilite1UP","leafTop","parseInt","_getPageHeight","reduce","padding","chunkTop","chunkBot","topOfFirstChunk","botOfLastChunk","console","log","containerTop","refs","$brContainer","prop","containerBot","height","animate","scrollTop","b","div","document","createElement","appendTo","css","width","left","top","$brTwoPageView","setHilightCss2UP","remove"],"mappings":"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","file":"plugin.tts.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","/**\n * @export\n * The underlying object wrapped each stream's elements. (Based on\n * JavaScript Generators; see\n * https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Generator/next )\n * @template T\n * @typedef {Object} TStreamItem\n * @property {T} value\n * @property {Boolean} done\n */\n\n/**\n * @abstract\n * Class that makes it easier to deal with a series of async events\n * (represented as Promises). All the function let you interact with\n * the promise's value instead of the promise itself, letting you \n * treat it as a stream of synchronuous values. The notable exception\n * being the `pull` method, which should be used to consume the stream,\n * and hence must return the promise directly.\n * @template T\n */\nexport default class AsyncStream {\n    /** @typedef {TStreamItem<T>} TItem */\n\n    /**\n     * @abstract\n     * Take the next item off the stream\n     * @return {PromiseLike<TItem>}\n     */\n    pull() { return null; }\n\n    /**\n     * Transform the stream's items\n     * @template B\n     * @param {function(T): B | PromiseLike<B>} mapper \n     * @return {AsyncStream<B>}\n     */\n    map(mapper) {\n        return new MappingAsyncStream(this, mapper);\n    }\n\n    /**\n     * Select only the stream items for which `predicate` returns true\n     * @param {function(T): Boolean} predicate \n     * @return {AsyncStream<T>}\n     */\n    filter(predicate) {\n        return new FilteringAsyncStream(this, predicate);\n    }\n\n    /**\n     * Load multiple items of the stream at the time to avoid long wait\n     * times between `pull`s. Starts `bufferSize` promises at a time \n     * (simultaneously).\n     * @param {Number} bufferSize \n     * @return {AsyncStream<T>}\n     */\n    buffer(bufferSize) {\n        return new BufferingAsyncStream(this, bufferSize);\n    }\n\n    /**\n     * If the current stream is an array of items, this expands the\n     * stream into a stream such that every element of the array \n     * becomes its own item.\n     * @template T2\n     * @this {AsyncStream<T2[]>}\n     * @return {AsyncStream<T2>}\n     */\n    flatten() {\n        return new FlatteningAsyncStream(this);\n    }\n\n    /**\n     * Create a stream that iterates from `start` to `end` (inclusive)\n     * @param {number} start \n     * @param {number} end \n     * @return {AsyncStream<number>}\n     */\n    static range(start, end) {\n        return new RangeAsyncStream(start, end);\n    }\n}\n\n/**\n * @private\n * @extends AsyncStream<number>\n * An async stream the returns numbers in a range (inclusive)\n */\nclass RangeAsyncStream extends AsyncStream {\n    /**\n     * @param {number} start \n     * @param {number} end \n     */\n    constructor(start, end) {\n        super();\n        this.start = start;\n        this.end = end;\n        this.cur = start;\n    }\n\n    pull() {\n        if (this.cur <= this.end) {\n            return Promise.resolve({ value: this.cur++, done: false });\n        } else {\n            return Promise.resolve({ value: null, done: true });\n        }\n    }\n}\n\n/**\n * @private\n * @template T1, T2\n * @extends AsyncStream<T2>\n */\nclass MappingAsyncStream extends AsyncStream {\n    /**\n     * \n     * @param {AsyncStream<T1>} parent \n     * @param {(x: T1) => T2 | PromiseLike<T2>} mapper \n     */\n    constructor(parent, mapper) {\n        super();\n        this.parent = parent;\n        this.mapper = mapper;\n    }\n\n    pull() {\n        return this.parent.pull()\n        .then(item => {\n            if (item.done) {\n                return Promise.resolve({ value: null, done: true });\n            }\n\n            var mapped = this.mapper(item.value);\n            if (!(mapped instanceof Promise)) {\n                mapped = Promise.resolve(mapped);\n            }\n            return /** @type {PromiseLike<T2>} */(mapped).then(value => {\n                return { value, done: false }\n            });\n        });\n    }\n}\n\n/**\n * @private\n * @template T\n * @extends AsyncStream<T>\n */\nclass FlatteningAsyncStream extends AsyncStream {\n    /**\n     * @param {AsyncStream<T[]>} parent \n     */\n    constructor(parent) {\n        super();\n        this.parent = parent;\n        /** @type {Array<T>} */\n        this._lastResult = [];\n        /** @type {PromiseLike<T[]>} */\n        this._inProgress = null;\n    }\n\n    pull() {\n        if (this._lastResult.length) {\n            return Promise.resolve({ value: this._lastResult.shift(), done: false });\n        } else if (this._inProgress) {\n            this._inProgress = this._inProgress.then(() => this.pull());\n            return this._inProgress;\n        } else {\n            this._inProgress = this.parent.pull()\n            .then(item => {\n                if (item.done) {\n                    return Promise.resolve({ value: null, done: true });\n                }\n\n                this._lastResult = item.value;\n                this._inProgress = null;\n                return this.pull();\n            });\n            return this._inProgress;\n        }\n    }\n}\n\n/**\n * @private\n * @template T\n * @extends AsyncStream<T>\n */\nclass BufferingAsyncStream extends AsyncStream {\n    /**\n     * @param {AsyncStream<T>} parent\n     * @param {Number} bufferSize\n     */\n    constructor(parent, bufferSize) {\n        super();\n        this.parent = parent;\n        this._bufferSize = bufferSize;\n        /** @type {PromiseLike<TStreamItem<T>>[]} */\n        this._promiseBuffer = [];\n    }\n\n    pull() {\n        var toFetch = Math.max(0, this._bufferSize - this._promiseBuffer.length + 1);\n        for (var i = 0; i < toFetch; i++) {\n            this._promiseBuffer.push(this.parent.pull());\n        }\n\n        return this._promiseBuffer.shift();;\n    }\n}\n","/**\n * Plugin for Text to Speech in BookReader\n */\n\nimport FestivalTTSEngine from './FestivalTTSEngine.js';\n\n// Default options for TTS\njQuery.extend(BookReader.defaultOptions, {\n    server: 'ia600609.us.archive.org',\n    bookPath: '',\n    enableTtsPlugin: true,\n});\n\n// Extend the constructor to add TTS properties\nBookReader.prototype.setup = (function (super_) {\n    return function (options) {\n        super_.call(this, options);\n\n        if (this.options.enableTtsPlugin) {\n            this.ttsEngine = new FestivalTTSEngine({\n                server: options.server,\n                bookPath: options.bookPath,\n                onLoadingStart: this.showProgressPopup.bind(this, 'Loading audio...'),\n                onLoadingComplete: this.removeProgressPopup.bind(this),\n                onDone: this.ttsStop.bind(this),\n                beforeChunkPlay: this.ttsBeforeChunkPlay.bind(this)\n            });\n            this.ttsHilites = [];\n        }\n    };\n})(BookReader.prototype.setup);\n\nBookReader.prototype.init = (function(super_) {\n    return function() {\n        if (this.options.enableTtsPlugin) {\n            // Bind to events\n            this.bind(BookReader.eventNames.PostInit, function(e, br) {\n                br.$('.BRicon.read').click(function(e) {\n                    br.ttsToggle();\n                    return false;\n                });\n                br.ttsEngine.init();\n            });\n\n            // This is fired when the hash changes by one of the other plugins!\n            // i.e. it will fire every time the page changes -_-\n            // this.bind(BookReader.eventNames.stop, function(e, br) {\n            //     this.ttsStop();\n            // }.bind(this));\n        }\n        super_.call(this);\n    };\n})(BookReader.prototype.init);\n\n\n// Extend buildMobileDrawerElement\nBookReader.prototype.buildMobileDrawerElement = (function (super_) {\n    return function () {\n        var $el = super_.call(this);\n        if (this.options.enableTtsPlugin && this.ttsEngine.isSupported) {\n            $el.find('.BRmobileMenu__moreInfoRow').after($(\n                \"    <li>\"\n                +\"      <span>\"\n                +\"        <span class=\\\"DrawerIconWrapper \\\"><img class=\\\"DrawerIcon\\\" src=\\\"\"+this.imagesBaseURL+\"icon_speaker_open.svg\\\" alt=\\\"info-speaker\\\"/></span>\"\n                +\"        Read Aloud\"\n                +\"      </span>\"\n                +\"      <div>\"\n                +\"        <span class='larger'>Press to toggle read aloud</span> <br/>\"\n                +\"        <button class='BRicon read'></button>\"\n                +\"      </div>\"\n                +\"    </li>\"\n            ));\n        };\n        return $el;\n    };\n})(BookReader.prototype.buildMobileDrawerElement);\n\n// Extend initNavbar\nBookReader.prototype.initNavbar = (function (super_) {\n    return function () {\n        var $el = super_.call(this);\n        var readIcon = '';\n        if (this.options.enableTtsPlugin && this.ttsEngine.isSupported) {\n            $(\"<button class='BRicon read js-tooltip'></button>\").insertAfter($el.find('.BRpage .BRicon.thumb'));\n        }\n        return $el;\n    };\n})(BookReader.prototype.initNavbar);\n\n// ttsToggle()\n//______________________________________________________________________________\nBookReader.prototype.ttsToggle = function () {\n    if (this.autoStop) this.autoStop();\n    if (this.ttsEngine.playing) {\n        this.ttsStop();\n    } else {\n        this.ttsStart();\n    }\n};\n\n// ttsStart(\n//______________________________________________________________________________\nBookReader.prototype.ttsStart = function () {\n    if (this.constModeThumb == this.mode)\n        this.switchMode(this.constMode1up);\n\n    this.$('.BRicon.read').addClass('unread');\n    this.ttsEngine.start(this.currentIndex(), this.getNumLeafs());\n};\n\n// ttsStop()\n//______________________________________________________________________________\nBookReader.prototype.ttsStop = function () {\n    this.$('.BRicon.read').removeClass('unread');\n    this.ttsEngine.stop();\n    this.ttsRemoveHilites();\n    this.removeProgressPopup();\n};\n\n/**\n * @param {PageChunk} chunk\n * @return {PromiseLike<void>} returns once the flip is done\n */\nBookReader.prototype.ttsBeforeChunkPlay = function(chunk) {\n    return this.ttsMaybeFlipToIndex(chunk.leafIndex)\n    .then(() => {\n        this.ttsHighlightChunk(chunk);\n        this.ttsScrollToChunk(chunk);\n    });\n};\n\n/**\n * Flip the page if the provided leaf index is not visible\n * @param {Number} leafIndex\n * @return {PromiseLike<void>} resolves once the flip animation has completed\n */\nBookReader.prototype.ttsMaybeFlipToIndex = function (leafIndex) {\n    var in2PageMode = this.constMode2up == this.mode;\n    var resolve = null;\n    var promise = new Promise(res => resolve = res);\n    \n    if (!in2PageMode) {\n        this.jumpToIndex(leafIndex);\n        resolve();\n    } else {\n        var leafVisible = leafIndex == this.twoPage.currentIndexR || leafIndex == this.twoPage.currentIndexL;\n        if (leafVisible) {\n            resolve();\n        } else {\n            this.animationFinishedCallback = resolve;\n            this.next();\n            promise.then(this.ttsMaybeFlipToIndex.bind(this, leafIndex));\n        }\n    }\n        \n    return promise;\n}\n\n/**\n * @param {PageChunk} chunk\n */\nBookReader.prototype.ttsHighlightChunk = function(chunk) {\n    this.ttsRemoveHilites();\n\n    if (this.constMode2up == this.mode) {\n        this.ttsHilite2UP(chunk);\n    } else {\n        this.ttsHilite1UP(chunk);\n    }\n};\n\n/**\n * @param {PageChunk} chunk\n */\nBookReader.prototype.ttsScrollToChunk = function(chunk) {\n    if (this.constMode1up != this.mode) return;\n\n    var leafTop = 0;\n    var h;\n    var i;\n    for (i=0; i<chunk.leafIndex; i++) {\n        h = parseInt(this._getPageHeight(i)/this.reduce);\n        leafTop += h + this.padding;\n    }\n\n    var chunkTop = chunk.lineRects[0][3]; //coords are in l,b,r,t order\n    var chunkBot = chunk.lineRects[chunk.lineRects.length-1][1];\n\n    var topOfFirstChunk = leafTop + chunkTop/this.reduce;\n    var botOfLastChunk  = leafTop + chunkBot/this.reduce;\n\n    if (soundManager.debugMode) console.log('leafTop = ' + leafTop + ' topOfFirstChunk = ' + topOfFirstChunk + ' botOfLastChunk = ' + botOfLastChunk);\n\n    var containerTop = this.refs.$brContainer.prop('scrollTop');\n    var containerBot = containerTop + this.refs.$brContainer.height();\n    if (soundManager.debugMode) console.log('containerTop = ' + containerTop + ' containerBot = ' + containerBot);\n\n    if ((topOfFirstChunk < containerTop) || (botOfLastChunk > containerBot)) {\n        this.refs.$brContainer.stop(true).animate({scrollTop: topOfFirstChunk},'fast');\n    }\n};\n\n/**\n * @param {PageChunk} chunk\n */\nBookReader.prototype.ttsHilite1UP = function(chunk) {\n    for (var i = 0; i < chunk.lineRects.length; i++) {\n        //each rect is an array of l,b,r,t coords (djvu.xml ordering...)\n        var l = chunk.lineRects[i][0];\n        var b = chunk.lineRects[i][1];\n        var r = chunk.lineRects[i][2];\n        var t = chunk.lineRects[i][3];\n\n        var div = document.createElement('div');\n        this.ttsHilites.push(div);\n        $(div).prop('className', 'BookReaderSearchHilite').appendTo(\n            this.$('.pagediv'+chunk.leafIndex)\n        );\n\n        $(div).css({\n            width:  (r-l)/this.reduce + 'px',\n            height: (b-t)/this.reduce + 'px',\n            left:   l/this.reduce + 'px',\n            top:    t/this.reduce +'px'\n        });\n    }\n\n};\n\n/**\n * @param {PageChunk} chunk\n */\nBookReader.prototype.ttsHilite2UP = function (chunk) {\n    for (var i = 0; i < chunk.lineRects.length; i++) {\n        //each rect is an array of l,b,r,t coords (djvu.xml ordering...)\n        var l = chunk.lineRects[i][0];\n        var b = chunk.lineRects[i][1];\n        var r = chunk.lineRects[i][2];\n        var t = chunk.lineRects[i][3];\n\n        var div = document.createElement('div');\n        this.ttsHilites.push(div);\n        $(div).prop('className', 'BookReaderSearchHilite').css('zIndex', 3).appendTo(this.refs.$brTwoPageView);\n        this.setHilightCss2UP(div, chunk.leafIndex, l, r, t, b);\n    }\n};\n\n// ttsRemoveHilites()\n//______________________________________________________________________________\nBookReader.prototype.ttsRemoveHilites = function () {\n    $(this.ttsHilites).remove();\n    this.ttsHilites = [];\n};\n","import AbstractTTSEngine from './AbstractTTSEngine.js';\n\n/**\n * @extends AbstractTTSEngine<{ sound: SMSound }>\n * TTS using Festival endpoint\n **/\nexport default class FestivalTTSEngine extends AbstractTTSEngine {\n    /**\n     * @param {TTSEngineOptions} options \n     */\n    constructor(options) {\n        super(options);\n        /** @type {'mp3' | 'ogg'} format of audio to get */\n        this.audioFormat = $.browser.mozilla ? 'ogg' : 'mp3';\n        /** @type {Boolean} Whether this tts engine can run */\n        this.isSupported = typeof(soundManager) !== 'undefined' && soundManager.supported();\n    }\n\n    /** @override */\n    init() {\n        if (this.isSupported) {\n            // setup sound manager\n            soundManager.setup({\n                debugMode: false,\n                // Note, there's a bug in Chrome regarding range requests.\n                // Flash is used as a workaround.\n                // See https://bugs.chromium.org/p/chromium/issues/detail?id=505707\n                preferFlash: true,\n                url: '/bookreader/BookReader/soundmanager/swf',\n                useHTML5Audio: true,\n                //flash 8 version of swf is buggy when calling play() on a sound that is still loading\n                flashVersion: 9\n            });\n        }\n    }\n\n    /**\n     * @override\n     * @param {number} leafIndex\n     * @param {number} numLeafs total number of leafs in the current book\n     */\n    start(leafIndex, numLeafs) {\n        if (navigator.userAgent.match(/mobile/i)) {\n            // HACK for iOS. Security restrictions require playback to be triggered\n            // by a user click/touch. This intention gets lost in the ajax callback\n            // above, but for some reason, if we start the audio here, it works\n            soundManager.createSound({url: this.getSoundUrl(' ')}).play();\n        }\n        \n        super.start(leafIndex, numLeafs);\n    }\n\n    /** @override */\n    stop() {\n        this.playStream = null;\n        soundManager.stopAll();\n        super.stop();\n    }\n\n    /** @override */\n    getPlayStream() {\n        this.playStream = this.playStream || this.chunkStream\n        .map(this.fetchChunkSound.bind(this))\n        .buffer(2);\n\n        return this.playStream;\n    }\n\n    /**\n     * @override\n     * @param {PageChunk & { sound: SMSound }} chunk\n     * @return {PromiseLike}\n     */\n    playChunk(chunk) {\n        return new Promise(res => chunk.sound.play({ onfinish: res }))\n        .then(() => chunk.sound.destruct());\n    }\n\n    /**\n     * @private\n     * @param {PageChunk} pageChunk\n     * @return {PromiseLike<PageChunk & { sound: SMSound }>}\n     */\n    fetchChunkSound(pageChunk) {\n        return new Promise(res => {\n            function resolve(sound) {\n                res($.extend(pageChunk, { sound }))\n            }\n            soundManager.createSound({\n                url: this.getSoundUrl(pageChunk.text),\n\n                // Many soundManger2 callbacks are broken when using HTML5 audio.\n                // whileloading: broken on safari, worked in FF4, but broken on FireFox 5\n                // onload: fires on safari, but *after* the sound starts playing, and does not fire in FF or IE9\n                // onbufferchange: fires in FF5 using HTML5 audio, but not in safari using flash audio\n                // whileplaying: fires everywhere\n                onload: function() { resolve(this); },\n                //fires in FF and IE9\n                onready: function() { resolve(this); },\n                //fires in safari...\n                onbufferchange: function() {\n                    if (!this.isBuffering) {\n                        resolve(this);\n                    }\n                }\n            }).load();\n        });\n    }\n\n    /**\n     * @private\n     * Get URL for audio that says this text\n     * @param {String} dataString the thing to say\n     * @return {String} url\n     */\n    getSoundUrl(dataString) {\n        return 'https://'+this.opts.server+'/BookReader/BookReaderGetTTS.php?string='\n                  + encodeURIComponent(dataString)\n                  + '&format=.'+this.audioFormat;\n    }\n}","import AsyncStream from './AsyncStream.js';\n\n/**\n * @export\n * @typedef {Object} PageChunk\n * @property {Number} leafIndex\n * @property {String} text\n * @property {DJVURect[]} lineRects\n */\n\n/**\n * @export\n * @typedef {Object} TTSEngineOptions \n * @property {String} server\n * @property {String} bookPath\n * @property {Function} onLoadingStart\n * @property {Function} onLoadingComplete\n * @property {Function} onDone called when the entire book is done\n * @property {function(PageChunk): PromiseLike} beforeChunkPlay will delay the playing of the chunk\n */\n\n/**\n * @typedef {[number, number, number, number]} DJVURect\n * coords are in l,b,r,t order\n */\n\n/**\n * @template TSound extra properties added to PageChunk to allow playing\n */\nexport default class AbstractTTSEngine {\n    /**\n     * @protected\n     * @param {TTSEngineOptions} options \n     */\n    constructor(options) {\n        this.playing = false;\n        this.opts = options;\n        /** @type {AsyncStream<PageChunk>} */\n        this.chunkStream = null;\n        /** Different engines should overwrite this */\n        this.isSupported = false;\n    }\n\n    /** @abstract */\n    init() { return null; }\n\n    /**\n     * @param {number} leafIndex\n     * @param {number} numLeafs total number of leafs in the current book\n     */\n    start(leafIndex, numLeafs) {\n        this.playing = true;\n        this.opts.onLoadingStart();\n\n        /** @type {AsyncStream<PageChunk>} */\n        this.chunkStream = AsyncStream.range(leafIndex, numLeafs-1)\n        .map(this.fetchPageChunks.bind(this))\n        .buffer(2)\n        .flatten();\n\n        this.step();\n    }\n\n    stop() {\n        this.playing = false;\n        this.chunkStream = null;\n    }\n\n    /**\n     * @private\n     */\n    step() {\n        this.getPlayStream().pull()\n        .then(item => {\n            if (item.done) {\n                this.stop();\n                this.opts.onDone();\n                return;\n            }\n            this.opts.onLoadingComplete();\n            return this.opts.beforeChunkPlay(item.value).then(() => item)\n        })\n        .then(item => {\n            if (this.playing) {\n                return this.playChunk(item.value);\n            }\n        })\n        .then(() => {\n            if (this.playing) return this.step();\n        });\n    }\n\n    /**\n\n     * @abstract\n     * @return {AbstractStream<PageChunk & TSound>}\n     */\n    getPlayStream() { return null; }\n\n    /**\n     * @abstract\n     * @param {PageChunk & TSound} chunk\n     * @return {PromiseLike} promise called once playing finished\n     */\n    playChunk(chunk) { return null; }\n\n    /**\n     * @private\n     * Gets the text on a page with given index\n     * @param {Number} leafIndex\n     * @return {PromiseLike<Array<PageChunk>>}\n     */\n    fetchPageChunks(leafIndex) {\n        return $.ajax({\n            type: 'GET',\n            url: 'https://'+this.opts.server+'/BookReader/BookReaderGetTextWrapper.php',\n            dataType:'jsonp',\n            data: {\n                path: this.opts.bookPath+'_djvu.xml',\n                page: leafIndex\n            }\n        })\n        .then(\n            /** @param {Array<[String, ...Array<DJVURect>]>} chunks */\n            function (chunks) {\n                return chunks.map(c => {\n                    return {\n                        leafIndex,\n                        text: c[0],\n                        lineRects: c.slice(1)\n                    };\n                });\n            }\n        );\n    }\n}"],"sourceRoot":""}