{"version":3,"sources":["webpack://@internetarchive/bookreader/./src/js/plugins/plugin.autoplay.js"],"names":["super_","jQuery","extend","BookReader","defaultOptions","enableAutoPlayPlugin","prototype","setup","options","call","this","auto","autoTimer","flipDelay","init","bind","eventNames","stop","autoStop","bindNavigationHandlers","jIcons","$","add","filter","click","autoToggle","overrides","flipSpeed","trigger","bComingFrom1up","constMode2up","mode","switchMode","reduce","twoPageGetAutofitReduce","zoom2up","pageProgression","flipFwdToIndex","hide","show","setInterval","animating","Math","max","twoPage","currentIndexL","currentIndexR","lastDisplayableIndex","flipBackToIndex","clearInterval"],"mappings":"mJAYuCA,E,gBAPvCC,OAAOC,OAAOC,WAAWC,eAAgB,CACvCC,sBAAsB,IAMxBF,WAAWG,UAAUC,OAAkBP,EAQpCG,WAAWG,UAAUC,MAPf,SAAUC,GACfR,EAAOS,KAAKC,KAAMF,GAElBE,KAAKC,MAAY,EACjBD,KAAKE,UAAY,KACjBF,KAAKG,UAAY,MAOrBV,WAAWG,UAAUQ,KAAQ,SAASd,GACpC,OAAO,SAAUQ,GAAS,WACxBR,EAAOS,KAAKC,KAAMF,GAEbE,KAAKF,QAAQH,sBAClBK,KAAKK,KAAKZ,WAAWa,WAAWC,MAAM,kBAAM,EAAKC,eALxB,CAO1Bf,WAAWG,UAAUQ,MAKxBX,WAAWG,UAAUa,uBAA0B,SAASnB,GACtD,OAAO,WAAW,WAGhB,GAFAA,EAAOS,KAAKC,MAEPA,KAAKF,QAAQH,qBAAlB,CAGA,IAAMe,EAASV,KAAKW,EAAE,WAAWC,IAAI,yBAErCF,EAAOG,OAAO,SAASC,OAAM,WAE3B,OADA,EAAKC,cACE,KAGTL,EAAOG,OAAO,UAAUC,OAAM,WAE5B,OADA,EAAKC,cACE,OAhBkC,CAmB5CtB,WAAWG,UAAUa,wBAQxBhB,WAAWG,UAAUmB,WAAa,SAASC,GAAW,WACpD,GAAKhB,KAAKF,QAAQH,qBAAlB,CAEA,IAAMG,EAAUa,EAAEnB,OAAO,CACvByB,UAAWjB,KAAKiB,UAChBd,UAAWH,KAAKG,WACfa,GAEHhB,KAAKiB,UAAyC,iBAAtBnB,EAAQmB,UAAyBnB,EAAQmB,UAAYjB,KAAKiB,UAClFjB,KAAKG,UAAyC,iBAAtBL,EAAQK,UAAyBL,EAAQK,UAAYH,KAAKG,UAClFH,KAAKkB,QAAQzB,WAAWa,WAAWC,MAEnC,IAAIY,GAAiB,EACjBnB,KAAKoB,cAAgBpB,KAAKqB,OAC5BF,GAAiB,EACjBnB,KAAKsB,WAAWtB,KAAKoB,eAInBpB,KAAKuB,OAASvB,KAAKwB,2BACrBxB,KAAKyB,QAAQ,QAGX,MAAQzB,KAAKE,WAKV,MAAQF,KAAK0B,iBAAoBP,GAIpCnB,KAAK2B,iBAGP3B,KAAKW,EAAE,SAASiB,OAChB5B,KAAKW,EAAE,UAAUkB,OACjB7B,KAAKE,UAAY4B,aAAY,WACvB,EAAKC,YAELC,KAAKC,IAAI,EAAKC,QAAQC,cAAe,EAAKD,QAAQE,gBAAkB,EAAKC,uBAC3E,EAAKC,gBAAgB,GAErB,EAAKX,oBAEN3B,KAAKG,YAERH,KAAKQ,aAOTf,WAAWG,UAAUY,SAAW,WACzBR,KAAKF,QAAQH,sBAEd,MAAQK,KAAKE,YACfqC,cAAcvC,KAAKE,WACnBF,KAAKiB,UAAY,OACjBjB,KAAKW,EAAE,UAAUiB,OACjB5B,KAAKW,EAAE,SAASkB,OAChB7B,KAAKE,UAAY,S","file":"plugins/plugin.autoplay.js","sourcesContent":["/*global BookReader */\r\n\r\n/**\r\n * Plugin which adds an autoplay feature. Useful for kiosk situations.\r\n */\r\njQuery.extend(BookReader.defaultOptions, {\r\n  enableAutoPlayPlugin: true\r\n});\r\n\r\n/**\r\n * @override BookReader.setup\r\n */\r\nBookReader.prototype.setup = (function(super_) {\r\n  return function (options) {\r\n    super_.call(this, options);\r\n\r\n    this.auto      = false;\r\n    this.autoTimer = null;\r\n    this.flipDelay = 5000;\r\n  };\r\n})(BookReader.prototype.setup);\r\n\r\n/**\r\n * @override BookReader.init\r\n */\r\nBookReader.prototype.init = (function(super_) {\r\n  return function (options) {\r\n    super_.call(this, options);\r\n\r\n    if (!this.options.enableAutoPlayPlugin) return;\r\n    this.bind(BookReader.eventNames.stop, () => this.autoStop());\r\n  };\r\n})(BookReader.prototype.init);\r\n\r\n/**\r\n * @override BookReader.bindNavigationHandlers\r\n */\r\nBookReader.prototype.bindNavigationHandlers = (function(super_) {\r\n  return function() {\r\n    super_.call(this);\r\n\r\n    if (!this.options.enableAutoPlayPlugin) return;\r\n\r\n    // Note the mobile plugin attaches itself to body, so we need to select outside\r\n    const jIcons = this.$('.BRicon').add('.BRmobileMenu .BRicon');\r\n\r\n    jIcons.filter('.play').click(() => {\r\n      this.autoToggle();\r\n      return false;\r\n    });\r\n\r\n    jIcons.filter('.pause').click(() => {\r\n      this.autoToggle();\r\n      return false;\r\n    });\r\n  };\r\n})(BookReader.prototype.bindNavigationHandlers);\r\n\r\n/**\r\n * Starts autoplay mode\r\n * @param {object} overrides\r\n * @param {number} overrides.flipSpeed\r\n * @param {number} overrides.flipDelay\r\n */\r\nBookReader.prototype.autoToggle = function(overrides) {\r\n  if (!this.options.enableAutoPlayPlugin) return;\r\n\r\n  const options = $.extend({\r\n    flipSpeed: this.flipSpeed,\r\n    flipDelay: this.flipDelay\r\n  }, overrides);\r\n\r\n  this.flipSpeed = typeof options.flipSpeed === \"number\" ? options.flipSpeed : this.flipSpeed;\r\n  this.flipDelay = typeof options.flipDelay === \"number\" ? options.flipDelay : this.flipDelay;\r\n  this.trigger(BookReader.eventNames.stop);\r\n\r\n  let bComingFrom1up = false;\r\n  if (this.constMode2up != this.mode) {\r\n    bComingFrom1up = true;\r\n    this.switchMode(this.constMode2up);\r\n  }\r\n\r\n  // Change to autofit if book is too large\r\n  if (this.reduce < this.twoPageGetAutofitReduce()) {\r\n    this.zoom2up('auto');\r\n  }\r\n\r\n  if (null == this.autoTimer) {\r\n    // $$$ Draw events currently cause layout problems when they occur during animation.\r\n    //     There is a specific problem when changing from 1-up immediately to autoplay in RTL so\r\n    //     we workaround for now by not triggering immediate animation in that case.\r\n    //     See https://bugs.launchpad.net/gnubook/+bug/328327\r\n    if (('rl' == this.pageProgression) && bComingFrom1up) {\r\n      // don't flip immediately -- wait until timer fires\r\n    } else {\r\n      // flip immediately\r\n      this.flipFwdToIndex();\r\n    }\r\n\r\n    this.$('.play').hide();\r\n    this.$('.pause').show();\r\n    this.autoTimer = setInterval(() => {\r\n      if (this.animating) return;\r\n\r\n      if (Math.max(this.twoPage.currentIndexL, this.twoPage.currentIndexR) >= this.lastDisplayableIndex()) {\r\n        this.flipBackToIndex(1); // $$$ really what we want?\r\n      } else {\r\n        this.flipFwdToIndex();\r\n      }\r\n    }, this.flipDelay);\r\n  } else {\r\n    this.autoStop();\r\n  }\r\n};\r\n\r\n/**\r\n * Stop autoplay mode, allowing animations to finish\r\n */\r\nBookReader.prototype.autoStop = function() {\r\n  if (!this.options.enableAutoPlayPlugin) return;\r\n\r\n  if (null != this.autoTimer) {\r\n    clearInterval(this.autoTimer);\r\n    this.flipSpeed = 'fast';\r\n    this.$('.pause').hide();\r\n    this.$('.play').show();\r\n    this.autoTimer = null;\r\n  }\r\n};\r\n"],"sourceRoot":""}