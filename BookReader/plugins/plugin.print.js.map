{"version":3,"sources":["webpack://@internetarchive/bookreader/./src/js/plugins/plugin.print.js","webpack://@internetarchive/bookreader/./node_modules/core-js/internals/inherit-if-required.js","webpack://@internetarchive/bookreader/./node_modules/core-js/internals/set-species.js","webpack://@internetarchive/bookreader/./node_modules/core-js/modules/es.regexp.constructor.js","webpack://@internetarchive/bookreader/./node_modules/core-js/modules/es.string.match.js"],"names":["super_","jQuery","extend","BookReader","defaultOptions","imageFormat","subPrefix","server","zip","prototype","setup","options","call","this","printPage","window","open","getPrintURI","indexToPrint","constMode2up","mode","twoPage","currentIndexL","firstIndex","getPageFile","_getPageWidth","_getPageHeight","currentIndexR","encodeURIComponent","shortTitle","getPageNum","index","imgStr","String","re","RegExp","length","insideZipPrefix","match","replace","isObject","setPrototypeOf","module","exports","$this","dummy","Wrapper","NewTarget","NewTargetPrototype","constructor","getBuiltIn","definePropertyModule","wellKnownSymbol","DESCRIPTORS","SPECIES","CONSTRUCTOR_NAME","Constructor","defineProperty","f","configurable","get","global","isForced","inheritIfRequired","getOwnPropertyNames","isRegExp","getFlags","stickyHelpers","redefine","fails","setInternalState","setSpecies","MATCH","NativeRegExp","RegExpPrototype","re1","re2","CORRECT_NEW","UNSUPPORTED_Y","RegExpWrapper","pattern","flags","sticky","thisIsRegExp","patternIsRegExp","flagsAreUndefined","undefined","source","indexOf","result","proxy","key","set","it","keys","fixRegExpWellKnownSymbolLogic","anObject","toLength","requireObjectCoercible","advanceStringIndex","regExpExec","nativeMatch","maybeCallNative","regexp","O","matcher","res","done","value","rx","S","fullUnicode","unicode","lastIndex","A","n","matchStr"],"mappings":"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","file":"plugins/plugin.print.js","sourcesContent":["/* global BookReader */\r\n\r\n/**\r\n * Plugin which used to print book images.\r\n */\r\njQuery.extend(BookReader.defaultOptions, {\r\n  imageFormat: 'jp2',\r\n  subPrefix: '',\r\n  server: '',\r\n  zip: '',\r\n});\r\n\r\n/** @override */\r\nBookReader.prototype.setup = (function (super_) {\r\n  return function (options) {\r\n    super_.call(this, options);\r\n\r\n    this.imageFormat = options.imageFormat;\r\n    this.subPrefix = options.subPrefix;\r\n    this.server = options.server;\r\n    this.zip = options.zip;\r\n  };\r\n})(BookReader.prototype.setup);\r\n\r\n/**\r\n * Print page of any book item\r\n */\r\nBookReader.prototype.printPage = function() {\r\n  window.open(\r\n    this.getPrintURI(),\r\n    'printpage',\r\n    'width=400, height=500, resizable=yes, scrollbars=no, toolbar=no, location=no'\r\n  );\r\n};\r\n\r\n/**\r\n * Generate print URL from current indices and mode\r\n *\r\n * @returns {string} URL\r\n */\r\nBookReader.prototype.getPrintURI = function() {\r\n  let indexToPrint;\r\n  if (this.constMode2up === this.mode) {\r\n    indexToPrint = this.twoPage.currentIndexL;\r\n  } else {\r\n    indexToPrint = this.firstIndex; // $$$ the index in the middle of the viewport would make more sense\r\n  }\r\n\r\n  let options = 'id=' + this.subPrefix + '&server=' + this.server + '&zip=' + this.zip\r\n    + '&format=' + this.imageFormat + '&file=' + this.getPageFile(indexToPrint)\r\n    + '&width=' + this._getPageWidth(indexToPrint) + '&height=' + this._getPageHeight(indexToPrint);\r\n\r\n  if (this.constMode2up === this.mode) {\r\n    options += '&file2=' + this.getPageFile(this.twoPage.currentIndexR) + '&width2=' + this._getPageWidth(this.twoPage.currentIndexR);\r\n    options += '&height2=' + this._getPageHeight(this.twoPage.currentIndexR);\r\n    options += '&title=' + encodeURIComponent(this.shortTitle(50) + ' - Pages ' + this.getPageNum(this.twoPage.currentIndexL) + ', ' + this.getPageNum(this.twoPage.currentIndexR));\r\n  } else {\r\n    options += '&title=' + encodeURIComponent(this.shortTitle(50) + ' - Page ' + this.getPageNum(indexToPrint));\r\n  }\r\n\r\n  return '/bookreader/print.php?' + options;\r\n};\r\n\r\n/**\r\n * Get file from lead index to create print URL\r\n *\r\n * @returns {null|string}\r\n */\r\nBookReader.prototype.getPageFile = function(index) {\r\n  if (index === null) {\r\n    return '';\r\n  }\r\n  const leafStr = '0000';\r\n  const imgStr = String(index); // String(this._leafMap[index]); // if index != leafNum\r\n  const re = new RegExp(\"0{\" + imgStr.length + \"}$\");\r\n  const insideZipPrefix = this.subPrefix.match('[^/]+$');\r\n  const file = insideZipPrefix + '_' + this.imageFormat + '/' + insideZipPrefix + '_' + leafStr.replace(re, imgStr) + '.' + this.imageFormat;\r\n  return file;\r\n}\r\n","var isObject = require('../internals/is-object');\nvar setPrototypeOf = require('../internals/object-set-prototype-of');\n\n// makes subclassing work correct for wrapped built-ins\nmodule.exports = function ($this, dummy, Wrapper) {\n  var NewTarget, NewTargetPrototype;\n  if (\n    // it can work only with native `setPrototypeOf`\n    setPrototypeOf &&\n    // we haven't completely correct pre-ES6 way for getting `new.target`, so use this\n    typeof (NewTarget = dummy.constructor) == 'function' &&\n    NewTarget !== Wrapper &&\n    isObject(NewTargetPrototype = NewTarget.prototype) &&\n    NewTargetPrototype !== Wrapper.prototype\n  ) setPrototypeOf($this, NewTargetPrototype);\n  return $this;\n};\n","'use strict';\nvar getBuiltIn = require('../internals/get-built-in');\nvar definePropertyModule = require('../internals/object-define-property');\nvar wellKnownSymbol = require('../internals/well-known-symbol');\nvar DESCRIPTORS = require('../internals/descriptors');\n\nvar SPECIES = wellKnownSymbol('species');\n\nmodule.exports = function (CONSTRUCTOR_NAME) {\n  var Constructor = getBuiltIn(CONSTRUCTOR_NAME);\n  var defineProperty = definePropertyModule.f;\n\n  if (DESCRIPTORS && Constructor && !Constructor[SPECIES]) {\n    defineProperty(Constructor, SPECIES, {\n      configurable: true,\n      get: function () { return this; }\n    });\n  }\n};\n","var DESCRIPTORS = require('../internals/descriptors');\nvar global = require('../internals/global');\nvar isForced = require('../internals/is-forced');\nvar inheritIfRequired = require('../internals/inherit-if-required');\nvar defineProperty = require('../internals/object-define-property').f;\nvar getOwnPropertyNames = require('../internals/object-get-own-property-names').f;\nvar isRegExp = require('../internals/is-regexp');\nvar getFlags = require('../internals/regexp-flags');\nvar stickyHelpers = require('../internals/regexp-sticky-helpers');\nvar redefine = require('../internals/redefine');\nvar fails = require('../internals/fails');\nvar setInternalState = require('../internals/internal-state').set;\nvar setSpecies = require('../internals/set-species');\nvar wellKnownSymbol = require('../internals/well-known-symbol');\n\nvar MATCH = wellKnownSymbol('match');\nvar NativeRegExp = global.RegExp;\nvar RegExpPrototype = NativeRegExp.prototype;\nvar re1 = /a/g;\nvar re2 = /a/g;\n\n// \"new\" should create a new object, old webkit bug\nvar CORRECT_NEW = new NativeRegExp(re1) !== re1;\n\nvar UNSUPPORTED_Y = stickyHelpers.UNSUPPORTED_Y;\n\nvar FORCED = DESCRIPTORS && isForced('RegExp', (!CORRECT_NEW || UNSUPPORTED_Y || fails(function () {\n  re2[MATCH] = false;\n  // RegExp constructor can alter flags and IsRegExp works correct with @@match\n  return NativeRegExp(re1) != re1 || NativeRegExp(re2) == re2 || NativeRegExp(re1, 'i') != '/a/i';\n})));\n\n// `RegExp` constructor\n// https://tc39.github.io/ecma262/#sec-regexp-constructor\nif (FORCED) {\n  var RegExpWrapper = function RegExp(pattern, flags) {\n    var thisIsRegExp = this instanceof RegExpWrapper;\n    var patternIsRegExp = isRegExp(pattern);\n    var flagsAreUndefined = flags === undefined;\n    var sticky;\n\n    if (!thisIsRegExp && patternIsRegExp && pattern.constructor === RegExpWrapper && flagsAreUndefined) {\n      return pattern;\n    }\n\n    if (CORRECT_NEW) {\n      if (patternIsRegExp && !flagsAreUndefined) pattern = pattern.source;\n    } else if (pattern instanceof RegExpWrapper) {\n      if (flagsAreUndefined) flags = getFlags.call(pattern);\n      pattern = pattern.source;\n    }\n\n    if (UNSUPPORTED_Y) {\n      sticky = !!flags && flags.indexOf('y') > -1;\n      if (sticky) flags = flags.replace(/y/g, '');\n    }\n\n    var result = inheritIfRequired(\n      CORRECT_NEW ? new NativeRegExp(pattern, flags) : NativeRegExp(pattern, flags),\n      thisIsRegExp ? this : RegExpPrototype,\n      RegExpWrapper\n    );\n\n    if (UNSUPPORTED_Y && sticky) setInternalState(result, { sticky: sticky });\n\n    return result;\n  };\n  var proxy = function (key) {\n    key in RegExpWrapper || defineProperty(RegExpWrapper, key, {\n      configurable: true,\n      get: function () { return NativeRegExp[key]; },\n      set: function (it) { NativeRegExp[key] = it; }\n    });\n  };\n  var keys = getOwnPropertyNames(NativeRegExp);\n  var index = 0;\n  while (keys.length > index) proxy(keys[index++]);\n  RegExpPrototype.constructor = RegExpWrapper;\n  RegExpWrapper.prototype = RegExpPrototype;\n  redefine(global, 'RegExp', RegExpWrapper);\n}\n\n// https://tc39.github.io/ecma262/#sec-get-regexp-@@species\nsetSpecies('RegExp');\n","'use strict';\nvar fixRegExpWellKnownSymbolLogic = require('../internals/fix-regexp-well-known-symbol-logic');\nvar anObject = require('../internals/an-object');\nvar toLength = require('../internals/to-length');\nvar requireObjectCoercible = require('../internals/require-object-coercible');\nvar advanceStringIndex = require('../internals/advance-string-index');\nvar regExpExec = require('../internals/regexp-exec-abstract');\n\n// @@match logic\nfixRegExpWellKnownSymbolLogic('match', 1, function (MATCH, nativeMatch, maybeCallNative) {\n  return [\n    // `String.prototype.match` method\n    // https://tc39.github.io/ecma262/#sec-string.prototype.match\n    function match(regexp) {\n      var O = requireObjectCoercible(this);\n      var matcher = regexp == undefined ? undefined : regexp[MATCH];\n      return matcher !== undefined ? matcher.call(regexp, O) : new RegExp(regexp)[MATCH](String(O));\n    },\n    // `RegExp.prototype[@@match]` method\n    // https://tc39.github.io/ecma262/#sec-regexp.prototype-@@match\n    function (regexp) {\n      var res = maybeCallNative(nativeMatch, regexp, this);\n      if (res.done) return res.value;\n\n      var rx = anObject(regexp);\n      var S = String(this);\n\n      if (!rx.global) return regExpExec(rx, S);\n\n      var fullUnicode = rx.unicode;\n      rx.lastIndex = 0;\n      var A = [];\n      var n = 0;\n      var result;\n      while ((result = regExpExec(rx, S)) !== null) {\n        var matchStr = String(result[0]);\n        A[n] = matchStr;\n        if (matchStr === '') rx.lastIndex = advanceStringIndex(S, toLength(rx.lastIndex), fullUnicode);\n        n++;\n      }\n      return n === 0 ? null : A;\n    }\n  ];\n});\n"],"sourceRoot":""}